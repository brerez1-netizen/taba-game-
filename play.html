<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“± ×©×œ×˜ ×©×—×§×Ÿ - ×ª×›× ×•×Ÿ ×”×¢×™×¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root { --blue: #38bdf8; --dark: #020617; --gold: #facc15; }
    body { font-family: system-ui, sans-serif; background: var(--dark); color: white; text-align: center; margin: 0; padding: 15px; }
    .card { background: rgba(255,255,255,0.05); border: 1px solid var(--blue); border-radius: 20px; padding: 20px; margin-bottom: 20px; }
    .avatar-preview { font-size: 5rem; width: 120px; height: 120px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; border: 4px solid var(--blue); }
    .control-group { margin-bottom: 15px; text-align: right; }
    .control-group label { display: block; margin-bottom: 5px; opacity: 0.8; font-size: 0.9rem; }
    input, select { width: 100%; padding: 12px; border-radius: 10px; border: none; background: #1e293b; color: white; font-size: 1rem; }
    .btn { background: var(--blue); color: var(--dark); padding: 18px; border-radius: 15px; border: none; font-weight: bold; width: 100%; font-size: 1.2rem; cursor: pointer; }
    .dice-btn { width: 130px; height: 130px; font-size: 4rem; border-radius: 35px; border: none; background: linear-gradient(135deg, var(--blue), #6366f1); color: white; margin: 20px 0; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
    .dice-btn:disabled { opacity: 0.3; filter: grayscale(1); }
  </style>
</head>
<body>

<div id="setup" class="screen active">
  <h2 style="color:var(--blue)">×¢×™×¦×•×‘ ×§×‘×•×¦×”</h2>
  <div class="card">
    <div class="avatar-preview" id="preview">ğŸ‘·â€â™‚ï¸</div>
    <div class="control-group">
      <label>×©× ×”×§×‘×•×¦×”:</label>
      <input type="text" id="pName" placeholder="×”×›× ×™×¡×• ×©×...">
    </div>
    <div class="control-group">
      <label>×“××•×ª:</label>
      <select id="role" onchange="updatePreview()">
        <option value="ğŸ‘·â€â™‚ï¸">××“×¨×™×›×œ/×™×ª</option>
        <option value="ğŸ—ï¸">×™×–×/×™×ª</option>
        <option value="âš–ï¸">×¢×•×¨×š/×ª ×“×™×Ÿ</option>
        <option value="ğŸ›ï¸">× ×¦×™×’/×ª ×•×¢×“×”</option>
        <option value="ğŸ¨">××¢×¦×‘/×ª ×¤× ×™×</option>
      </select>
    </div>
    <div class="control-group">
      <label>×¦×‘×¢ ×§×‘×•×¦×”:</label>
      <select id="color" onchange="updatePreview()">
        <option value="#38bdf8">×ª×›×œ×ª</option>
        <option value="#facc15">×–×”×‘</option>
        <option value="#4ade80">×™×¨×•×§</option>
        <option value="#f472b6">×•×¨×•×“</option>
      </select>
    </div>
    <button class="btn" onclick="join()">×”×¦×˜×¨×¤×•×ª ×œ×œ×•×‘×™</button>
  </div>
</div>

<div id="play" style="display:none;">
  <h2 id="status" style="margin-bottom:10px;">×”××ª×™× ×• ×œ××¨×¦×”...</h2>
  <div class="avatar-preview" id="myAvatarDisplay" style="width:80px; height:80px; font-size:3rem;"></div>
  <button id="diceBtn" class="dice-btn" onclick="roll()" disabled>ğŸ²</button>
  
  <div id="infoModal" style="display:none; background: #1e293b; padding: 20px; border-radius: 15px; border: 2px solid var(--gold);">
    <h3 id="mTitle" style="color:var(--gold); margin-top:0;"></h3>
    <p id="mDesc" style="line-height:1.4;"></p>
    <button class="btn" onclick="next()" style="background:var(--gold)">×”××©×š ×œ×ª×•×¨ ×”×‘×</button>
  </div>
</div>

<script>
  const config = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/",
    projectId: "erez-taba-game"
  };
  firebase.initializeApp(config);
  const db = firebase.database();
  let myId, myData;

  function updatePreview() {
    const p = document.getElementById('preview');
    p.innerText = document.getElementById('role').value;
    p.style.backgroundColor = document.getElementById('color').value;
  }

  function join() {
    const name = document.getElementById('pName').value;
    if(!name) return alert("× × ×œ×”×–×™×Ÿ ×©× ×§×‘×•×¦×”");
    const pRef = db.ref('players').push();
    myId = pRef.key;
    myData = { name, avatar: document.getElementById('role').value, color: document.getElementById('color').value, pos: 0, id: myId };
    pRef.set(myData);
    
    document.getElementById('setup').style.display = 'none';
    document.getElementById('play').style.display = 'block';
    document.getElementById('myAvatarDisplay').innerText = myData.avatar;
    document.getElementById('myAvatarDisplay').style.backgroundColor = myData.color;

    db.ref('game').on('value', s => {
      const g = s.val();
      db.ref('players').once('value', psSnap => {
        const ps = psSnap.val() || {};
        const ids = Object.keys(ps);
        const isMyTurn = ids[g.turn] === myId;
        document.getElementById('diceBtn').disabled = !isMyTurn || g.modal || g.state !== 'playing';
        document.getElementById('status').innerText = isMyTurn ? "×ª×•×¨×›×! ×”×˜×™×œ×• ×§×•×‘×™×™×”" : `×ª×•×¨ ×©×œ: ${ps[ids[g.turn]]?.name || '×××ª×™×Ÿ'}`;
        document.getElementById('infoModal').style.display = (g.modal && isMyTurn) ? 'block' : 'none';
        if(g.modal) {
            document.getElementById('mTitle').innerText = "××©×‘×¦×ª " + g.activeCell;
            // ×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£ ×ª×™××•×¨ ×©×œ×‘ ×ª×‘"×¢
        }
      });
    });
  }

  function roll() {
    const steps = Math.floor(Math.random() * 6) + 1;
    document.getElementById('diceBtn').innerText = steps;
    db.ref(`players/${myId}`).once('value', s => {
      const newPos = Math.min(49, s.val().pos + steps);
      db.ref(`players/${myId}`).update({ pos: newPos });
      setTimeout(() => db.ref('game').update({ modal: true, activeCell: newPos + 1 }), 1500);
    });
  }

  function next() {
    db.ref('players').once('value', ps => {
      const count = Object.keys(ps.val()).length;
      db.ref('game').once('value', g => {
        db.ref('game').update({ turn: (g.val().turn + 1) % count, modal: false });
        document.getElementById('diceBtn').innerText = "ğŸ²";
      });
    });
  }
</script>
</body>
</html>
