<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“± ×©×œ×˜ ×©×—×§×Ÿ - ×ª×›× ×•×Ÿ ×”×¢×™×¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root { --blue: #38bdf8; --dark: #020617; --gold: #facc15; }
    body { font-family: system-ui, sans-serif; background: var(--dark); color: white; text-align: center; padding: 20px; }
    .card { background: rgba(255,255,255,0.05); border: 2px solid var(--blue); border-radius: 25px; padding: 25px; margin-bottom: 20px; }
    .avatar-preview { font-size: 5rem; width: 130px; height: 130px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; border: 4px solid var(--blue); box-shadow: 0 0 20px rgba(56, 189, 248, 0.4); }
    .input-label { display: block; text-align: right; margin-bottom: 8px; opacity: 0.8; font-size: 0.9rem; }
    input, select { width: 100%; padding: 15px; border-radius: 12px; border: none; background: #1e293b; color: white; font-size: 1.1rem; margin-bottom: 20px; }
    .btn { background: var(--blue); color: var(--dark); padding: 20px; border-radius: 15px; border: none; font-weight: bold; width: 100%; font-size: 1.3rem; cursor: pointer; }
    .dice-btn { width: 140px; height: 140px; font-size: 4.5rem; border-radius: 40px; border: none; background: linear-gradient(135deg, var(--blue), #6366f1); color: white; margin: 30px 0; transition: 0.2s; }
    .dice-btn:active { transform: scale(0.9); }
    .dice-btn:disabled { opacity: 0.2; filter: grayscale(1); }
    #infoModal { position: fixed; inset: 0; background: var(--dark); padding: 30px; display: none; flex-direction: column; justify-content: center; z-index: 2000; }
  </style>
</head>
<body>

<div id="setup" class="screen active">
  <h1 style="color:var(--blue)">×¢×™×¦×•×‘ ×”×§×‘×•×¦×”</h1>
  <div class="card">
    <div class="avatar-preview" id="preview">ğŸ‘·â€â™‚ï¸</div>
    <span class="input-label">×©× ×”×§×‘×•×¦×”:</span>
    <input type="text" id="pName" placeholder="×œ××©×œ: ××“×¨×™×›×œ×™ ×”×¢×ª×™×“">
    <span class="input-label">×‘×—×¨×• ×“××•×ª:</span>
    <select id="role" onchange="updatePreview()">
      <option value="ğŸ‘·â€â™‚ï¸">××“×¨×™×›×œ/×™×ª</option>
      <option value="ğŸ—ï¸">×™×–×/×™×ª</option>
      <option value="âš–ï¸">×¢×•×¨×š/×ª ×“×™×Ÿ</option>
      <option value="ğŸ›ï¸">× ×¦×™×’/×ª ×•×¢×“×”</option>
      <option value="ğŸ¢">××”× ×“×¡/×ª</option>
    </select>
    <span class="input-label">×¦×‘×¢ ×–×™×”×•×™:</span>
    <select id="color" onchange="updatePreview()">
      <option value="#38bdf8">×ª×›×œ×ª</option>
      <option value="#facc15">×–×”×‘</option>
      <option value="#4ade80">×™×¨×•×§</option>
      <option value="#f472b6">×•×¨×•×“</option>
      <option value="#a855f7">×¡×’×•×œ</option>
    </select>
    <button class="btn" onclick="join()">×”×¦×˜×¨×¤×•×ª ×œ×œ×•×‘×™</button>
  </div>
</div>

<div id="play" style="display:none;">
  <h2 id="status">×××ª×™× ×™× ×œ××¨×¦×”...</h2>
  <div class="avatar-preview" id="myDisplay" style="width:100px; height:100px; font-size:4rem;"></div>
  <button id="diceBtn" class="dice-btn" onclick="roll()" disabled>ğŸ²</button>
</div>

<div id="infoModal">
  <h1 id="mTitle" style="color:var(--gold)"></h1>
  <p id="mDesc" style="font-size:1.5rem; line-height:1.4; margin:30px 0;"></p>
  <button class="btn" onclick="next()" style="background:var(--gold)">×”××©×š ×œ×ª×•×¨ ×”×‘×</button>
</div>

<script>
  const config = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/",
    projectId: "erez-taba-game"
  };
  firebase.initializeApp(config);
  const db = firebase.database();
  let myId, myData;

  const tabaInfo = {
    1: "×™×•×–××” ×•×ª×›× ×•×Ÿ ×¨×¢×™×•× ×™: ×›××Ÿ ×”×›×œ ××ª×—×™×œ. ×”×¨×¢×™×•×Ÿ ×©×œ×›× ×™×•×¦× ×œ×“×¨×š!",
    7: "×‘×“×™×§×ª ×ª× ××™ ×¡×£: ×”×•×•×¢×“×” ×‘×•×—× ×ª ×× ×›×œ ×”××¡××›×™× ×©×”×’×©×ª× ×ª×§×™× ×™×.",
    15: "×”×—×œ×˜×” ×¢×œ ×”××œ×¦×” ×œ×”×¤×§×“×”: ×”×•×•×¢×“×” ×”××§×•××™×ª ×××œ×™×¦×” ×œ×§×“× ××ª ×”×ª×›× ×™×ª ×©×œ×›×.",
    30: "××™× ×•×™ ×—×•×§×¨: ×”×•×•×¢×“×” ××× ×” ××™×© ××§×¦×•×¢ ×œ×©××•×¢ ××ª ×”×”×ª× ×’×“×•×™×•×ª ×œ×ª×›× ×™×ª.",
    50: "××–×œ ×˜×•×‘! ×”×’×¢×ª× ×œ×¡×•×£ ×”×ª×”×œ×™×š. ×”×ª×›× ×™×ª ×××•×©×¨×ª ×•× ×™×ª×Ÿ ×œ×‘× ×•×ª!"
  };

  function updatePreview() {
    const p = document.getElementById('preview');
    p.innerText = document.getElementById('role').value;
    p.style.backgroundColor = document.getElementById('color').value;
  }

  function join() {
    const name = document.getElementById('pName').value;
    if(!name) return alert("×—×™×™×‘×™× ×©× ×œ×§×‘×•×¦×”!");
    const pRef = db.ref('players').push();
    myId = pRef.key;
    myData = { name, avatar: document.getElementById('role').value, color: document.getElementById('color').value, pos: 0, id: myId };
    pRef.set(myData);
    
    document.getElementById('setup').style.display = 'none';
    document.getElementById('play').style.display = 'block';
    document.getElementById('myDisplay').innerText = myData.avatar;
    document.getElementById('myDisplay').style.backgroundColor = myData.color;

    db.ref('game').on('value', s => {
      const g = s.val();
      db.ref('players').once('value', psSnap => {
        const ps = psSnap.val() || {};
        const ids = Object.keys(ps);
        const isMyTurn = ids[g.turn] === myId;
        document.getElementById('diceBtn').disabled = !isMyTurn || g.modal || g.state !== 'playing';
        document.getElementById('status').innerText = isMyTurn ? "×ª×•×¨×›×! ×”×˜×™×œ×• ×§×•×‘×™×™×”" : `×ª×•×¨ ×©×œ: ${ps[ids[g.turn]]?.name || '×××ª×™×Ÿ'}`;
        
        if(g.modal && isMyTurn) {
          document.getElementById('infoModal').style.display = 'flex';
          document.getElementById('mTitle').innerText = "××©×‘×¦×ª " + g.activeCell;
          document.getElementById('mDesc').innerText = tabaInfo[g.activeCell] || "×©×œ×‘ × ×•×¡×£ ×‘×ª×”×œ×™×š ×”×ª×›× ×•×Ÿ ×”×¡×˜×˜×•×˜×•×¨×™ ×©×œ ×”×ª×‘\"×¢. ×”××©×™×›×• ×›×š!";
        } else {
          document.getElementById('infoModal').style.display = 'none';
        }
      });
    });
  }

  function roll() {
    const steps = Math.floor(Math.random() * 6) + 1;
    document.getElementById('diceBtn').innerText = steps;
    db.ref(`players/${myId}`).once('value', s => {
      const newPos = Math.min(49, s.val().pos + steps);
      db.ref(`players/${myId}`).update({ pos: newPos });
      setTimeout(() => db.ref('game').update({ modal: true, activeCell: newPos + 1 }), 1500);
    });
  }

  function next() {
    db.ref('players').once('value', ps => {
      const count = Object.keys(ps.val()).length;
      db.ref('game').once('value', g => {
        db.ref('game').update({ turn: (g.val().turn + 1) % count, modal: false });
        document.getElementById('diceBtn').innerText = "ğŸ²";
      });
    });
  }
</script>
</body>
</html>
