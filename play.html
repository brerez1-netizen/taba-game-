<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“± ×©×—×§×Ÿ - ××¡×œ×•×œ ×”×ª×‘"×¢</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root { --blue: #38bdf8; --gold: #facc15; --bg: #020617; }
    body { background: var(--bg); color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
    .btn { background: var(--blue); color: black; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; width: 100%; margin: 10px 0; cursor: pointer; }
    .opt-btn { background: #1e293b; color: white; border: 2px solid var(--blue); }
    .active-p { border: 4px solid var(--gold); }
    #status-bar { background: #1e293b; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
  </style>
</head>
<body>

<div id="setup">
  <h2>×”×¦×˜×¨×¤×•×ª ×œ××©×—×§</h2>
  <input type="text" id="pName" placeholder="×©× ×”×§×‘×•×¦×”" style="padding:10px; width:80%; border-radius:5px;"><br>
  <select id="pAvatar" style="padding:10px; width:85%; margin:10px 0; border-radius:5px;">
    <option value="ğŸ—ï¸">×× ×•×£</option><option value="ğŸ ">×‘×™×ª</option>
    <option value="ğŸ“">×¡×¨×’×œ</option><option value="ğŸ™ï¸">×¢×™×¨</option>
  </select><br>
  <button class="btn" onclick="join()">×”×¦×˜×¨×£</button>
</div>

<div id="game" style="display:none;">
  <div id="status-bar">
    <div id="myTurnInfo">×”××ª×Ÿ ×œ×ª×•×¨×š...</div>
  </div>
  
  <div id="controls">
    <button id="diceBtn" class="btn" style="display:none;" onclick="roll()">ğŸ² ×”×˜×œ ×§×•×‘×™×™×”</button>
  </div>

  <div id="quiz-ui" style="display:none;">
    <h3>×‘×—×¨ ×ª×©×•×‘×”:</h3>
    <button class="btn opt-btn" onclick="sendAns(0)">×</button>
    <button class="btn opt-btn" onclick="sendAns(1)">×‘</button>
    <button class="btn opt-btn" onclick="sendAns(2)">×’</button>
    <button class="btn opt-btn" onclick="sendAns(3)">×“</button>
  </div>
</div>

<script>
  const config = { apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0", databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/", projectId: "erez-taba-game" };
  firebase.initializeApp(config);
  const db = firebase.database();
  let myId = null;

  function join() {
    const name = document.getElementById('pName').value;
    const avatar = document.getElementById('pAvatar').value;
    if(!name) return;
    myId = Date.now().toString();
    db.ref('players/' + myId).set({ name, avatar, pos: 0, color: '#'+Math.floor(Math.random()*16777215).toString(16) });
    document.getElementById('setup').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    listen();
  }

  function listen() {
    db.ref('game').on('value', s => {
      const g = s.val();
      db.ref('players').once('value', ps => {
        const ids = Object.keys(ps.val() || {});
        const isMyTurn = ids[g.turn] === myId;
        
        document.getElementById('myTurnInfo').innerText = isMyTurn ? "×ª×•×¨×š ×œ×©×—×§!" : "×ª×•×¨ ×©×œ: " + ps.val()[ids[g.turn]]?.name;
        document.getElementById('diceBtn').style.display = (isMyTurn && !g.activeCell) ? 'block' : 'none';
        
        // ×”×¦×’×ª ×›×¤×ª×•×¨×™ ×§×•×•×™×– ×¨×§ ×× ××•×¤×¢×œ×ª ××©×‘×¦×ª ×§×•×•×™×– ×•×”×’×™×¢ ×ª×•×¨×™
        document.getElementById('quiz-ui').style.display = (isMyTurn && g.activeCell) ? 'block' : 'none';
      });
    });
  }

  function roll() {
    const r = Math.floor(Math.random() * 6) + 1;
    db.ref('game').update({ lastRoll: r, state: 'moving' });
    // ×›××Ÿ ×ª×‘×•× ×”×œ×•×’×™×§×” ×©×œ ×”×–×–×ª ×”×©×—×§×Ÿ ×‘-Firebase
  }

  function sendAns(idx) {
    db.ref('game').update({ selection: idx });
  }
</script>
</body>
</html>
