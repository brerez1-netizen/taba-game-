<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×‘×™ ×”××©×—×§ - ××¨×– ×‘×¨×•×›×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }

    /* ×¢×™×¦×•×‘ ×”×œ×•×‘×™ */
    .lobby-header {
      margin-top: 50px;
      text-align: center;
    }

    h1 { font-size: 3.5rem; color: #38bdf8; text-shadow: 0 0 20px rgba(56,189,248,0.5); margin-bottom: 10px; }
    
    .status-sub { font-size: 1.5rem; opacity: 0.8; }

    #playersContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 40px;
      max-width: 1200px;
    }

    /* ×›×¨×˜×™×¡ ×©×—×§×Ÿ ×‘×¡×’× ×•×Ÿ ×§×”×•×˜ */
    .player-bubble {
      background: white;
      color: #020617;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 1.8rem;
      font-weight: bold;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes popIn {
      0% { transform: scale(0) rotate(-10deg); opacity: 0; }
      100% { transform: scale(1) rotate(0); opacity: 1; }
    }

    /* ×ª×™×‘×ª ×”-QR ×‘×¦×“ */
    #qrContainer {
      position: fixed;
      bottom: 40px;
      right: 40px;
      background: white;
      padding: 20px;
      border-radius: 20px;
      text-align: center;
      color: black;
      box-shadow: 0 0 40px rgba(56,189,248,0.3);
    }

    /* ×××©×§ ×¡×˜×•×“× ×˜ ×‘×˜×œ×¤×•×Ÿ */
    .mobile-setup {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
    }

    input {
      padding: 20px;
      font-size: 1.2rem;
      border-radius: 15px;
      border: 2px solid #38bdf8;
      background: #0f172a;
      color: white;
      text-align: center;
    }

    .join-btn {
      background: #38bdf8;
      color: #020617;
      padding: 20px;
      font-size: 1.5rem;
      font-weight: bold;
      border: none;
      border-radius: 15px;
      cursor: pointer;
    }

    .hidden { display: none; }
  </style>
</head>
<body>

  <div id="teacherView" class="hidden">
    <div class="lobby-header">
      <h1>×××ª×™× ×™× ×œ×©×—×§× ×™×...</h1>
      <div class="status-sub" id="countText">0 ×¡×˜×•×“× ×˜×™× ×›×‘×¨ ×‘×¤× ×™×</div>
    </div>

    <div id="playersContainer">
      </div>

    <div id="qrContainer">
      <div id="qrcode"></div>
      <p style="margin-top: 10px; font-weight: bold; font-size: 1.2rem;">×¡×¨×§×• ×•×”×¦×˜×¨×¤×•!</p>
    </div>
    
    <button onclick="alert('×™×•×¦××™× ×œ×“×¨×š!')" id="startBtn" class="join-btn" style="position:fixed; bottom:40px; left:40px; display:none;">×”×ª×—×œ ××©×—×§ ğŸš€</button>
  </div>

  <div id="studentView" class="hidden">
    <div class="mobile-setup">
      <h2 style="text-align: center;">×‘×¨×•×›×™× ×”×‘××™×!</h2>
      <input type="text" id="playerName" placeholder="××™×š ×§×•×¨××™× ×œ×›×?">
      <button class="join-btn" onclick="joinLobby()">×”×¦×˜×¨×¤×•×ª ×œ×œ×•×‘×™</button>
    </div>
  </div>

  <div id="startChoice" style="margin-top: 20vh;">
    <h1>ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
    <button class="join-btn" onclick="setupView('teacher')">ğŸ–¥ï¸ ×× ×™ ×”××¨×¦×”</button>
    <button class="join-btn" onclick="setupView('student')" style="margin-top: 20px; background: #94a3b8;">ğŸ“± ×× ×™ ×¡×˜×•×“× ×˜</button>
  </div>

  <script>
    const config = {
      apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
      databaseURL: "https://erez-taba-game-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "erez-taba-game"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    function setupView(role) {
      document.getElementById('startChoice').classList.add('hidden');
      if(role === 'teacher') {
        document.getElementById('teacherView').classList.remove('hidden');
        initTeacher();
      } else {
        document.getElementById('studentView').classList.remove('hidden');
      }
    }

    // ×–×™×”×•×™ ××•×˜×•××˜×™ ××”×¡×¨×™×§×”
    if(window.location.search.includes('role=student')) {
      setupView('student');
    }

    function initTeacher() {
      // × ×™×§×•×™ ×”×œ×•×‘×™ ×”×§×•×“×
      db.ref('lobby').remove();
      
      // ×™×¦×™×¨×ª QR
      new QRCode(document.getElementById("qrcode"), {
        text: window.location.href.split('?')[0] + "?role=student",
        width: 180, height: 180
      });

      // ×”××–× ×” ×œ×©×—×§× ×™× ×—×“×©×™×
      db.ref('lobby').on('value', (snapshot) => {
        const players = snapshot.val() || {};
        const container = document.getElementById('playersContainer');
        const ids = Object.keys(players);
        
        container.innerHTML = '';
        ids.forEach(id => {
          const div = document.createElement('div');
          div.className = 'player-bubble';
          div.innerText = players[id].name;
          container.appendChild(div);
        });

        document.getElementById('countText').innerText = `${ids.length} ×¡×˜×•×“× ×˜×™× ×›×‘×¨ ×‘×¤× ×™×`;
        document.getElementById('startBtn').style.display = ids.length > 0 ? 'block' : 'none';
      });
    }

    function joinLobby() {
      const name = document.getElementById('playerName').value;
      if(!name) return alert("× × ×œ×”×–×™×Ÿ ×©×");
      
      db.ref('lobby').push({ name: name }).then(() => {
        document.getElementById('studentView').innerHTML = "<h2>××¢×•×œ×”! ×”×©× ×©×œ×›× ××•×¤×™×¢ ×¢×œ ×”×œ×•×— :)</h2>";
      });
    }
  </script>
</body>
</html>
