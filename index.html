<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×‘×™ ×”××©×—×§ - ××¨×– ×‘×¨×•×›×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background: #020617; color: white; text-align: center; }
    .screen { display: none; padding: 20px; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
    .screen.active { display: flex; }
    .btn { background: #38bdf8; color: #000; padding: 20px 40px; border-radius: 15px; border: none; font-weight: bold; font-size: 1.5rem; cursor: pointer; margin-top: 20px; width: 85%; max-width: 300px; }
    .player-card { background: white; color: black; padding: 15px 30px; border-radius: 50px; font-size: 1.8rem; margin: 10px; display: inline-block; font-weight: bold; box-shadow: 0 5px 15px rgba(56,189,248,0.4); animation: pop 0.4s ease; }
    @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    input { padding: 15px; font-size: 1.2rem; width: 85%; max-width: 300px; border-radius: 10px; border: 2px solid #38bdf8; background: #0f172a; color: white; text-align: center; }
    #qrcode { background: white; padding: 10px; display: inline-block; border-radius: 15px; }
  </style>
</head>
<body>

<div id="choiceScreen" class="screen active">
  <h1 style="font-size: 2.5rem; color: #38bdf8;">ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
  <button class="btn" onclick="initRole('teacher')">ğŸ–¥ï¸ ×¤×ª×— ×œ×•×‘×™ (××¨×¦×”)</button>
  <button class="btn" onclick="initRole('student')" style="background: #94a3b8;">ğŸ“± ×”×¦×˜×¨×¤×•×ª (×¡×˜×•×“× ×˜)</button>
</div>

<div id="teacherView" class="screen">
  <h1>×××ª×™× ×™× ×‘×œ×•×‘×™...</h1>
  <div id="qrcode"></div>
  <h2 id="countLabel">0 ×©×—×§× ×™× ××—×•×‘×¨×™×</h2>
  <div id="playersList"></div>
  <button class="btn" id="startBtn" style="display:none;" onclick="alert('×”×—×™×‘×•×¨ ×”×¦×œ×™×—!')">×”×¤×¢×œ ××©×—×§</button>
</div>

<div id="studentView" class="screen">
  <h2>××™×š ×§×•×¨××™× ×œ×›×?</h2>
  <input type="text" id="pName" placeholder="×©× ×”×§×‘×•×¦×”">
  <button class="btn" id="joinBtn" onclick="sendToLobby()">×”×¦×˜×¨×¤×•×ª ×œ×œ×•×‘×™!</button>
  <h2 id="successMsg" style="display:none; color: #38bdf8; margin-top: 30px;">× ×¨×©××ª× ×‘×”×¦×œ×—×”! ×”×©× ×¢×œ ×”××¡×š.</h2>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    authDomain: "erez-taba-game.firebaseapp.com",
    databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/",
    projectId: "erez-taba-game"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function initRole(role) {
    document.getElementById('choiceScreen').classList.remove('active');
    if(role === 'teacher') {
      document.getElementById('teacherView').classList.add('active');
      setupTeacher();
    } else {
      document.getElementById('studentView').classList.add('active');
    }
  }

  if(window.location.search.includes('role=student')) initRole('student');

  function setupTeacher() {
    db.ref('lobby_live').remove();
    new QRCode(document.getElementById("qrcode"), {
      text: window.location.href.split('?')[0] + "?role=student",
      width: 160, height: 160
    });

    db.ref('lobby_live').on('value', (snapshot) => {
      const data = snapshot.val() || {};
      const ids = Object.keys(data);
      document.getElementById('countLabel').innerText = `${ids.length} ×©×—×§× ×™× ××—×•×‘×¨×™×`;
      document.getElementById('playersList').innerHTML = ids.map(id => `<div class="player-card">${data[id].name}</div>`).join('');
      if(ids.length > 0) document.getElementById('startBtn').style.display = 'block';
    });
  }

  function sendToLobby() {
    const nameInput = document.getElementById('pName');
    const name = nameInput.value;
    if(!name) return alert("× × ×œ×”×–×™×Ÿ ×©×");
    
    document.getElementById('joinBtn').innerText = "×©×•×œ×—...";
    document.getElementById('joinBtn').disabled = true;

    db.ref('lobby_live').push({ name: name })
      .then(() => {
        document.getElementById('joinBtn').style.display = 'none';
        nameInput.style.display = 'none';
        document.getElementById('successMsg').style.display = 'block';
      })
      .catch(e => {
        alert("×©×’×™××”: " + e.message);
        document.getElementById('joinBtn').disabled = false;
        document.getElementById('joinBtn').innerText = "× ×¡×” ×©×•×‘";
      });
  }
</script>
</body>
</html>
