<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×‘×™ ×”××©×—×§ - ××¨×– ×‘×¨×•×›×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root { --blue: #38bdf8; --pink: #f472b6; --dark: #020617; }
    body { margin: 0; font-family: system-ui, sans-serif; background: radial-gradient(circle, #1e293b 0%, #020617 100%); color: white; min-height: 100vh; overflow-x: hidden; }
    .screen { display: none; padding: 20px; flex-direction: column; align-items: center; text-align: center; }
    .active { display: flex; }
    
    /* ×¢×™×¦×•×‘ ×”××¨×¦×” */
    h1 { font-size: 3rem; color: var(--blue); text-shadow: 0 0 20px rgba(56,189,248,0.4); }
    #playersList { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; margin-top: 40px; }
    .player-card { background: white; color: var(--dark); padding: 15px; border-radius: 20px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .avatar-view { font-size: 3rem; margin-bottom: 5px; }
    .player-name { font-weight: bold; font-size: 1.2rem; }
    
    /* ×¢×™×¦×•×‘ ×”×¡×˜×•×“× ×˜ */
    .customizer { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; width: 100%; max-width: 350px; border: 1px solid var(--blue); }
    .preview-box { font-size: 5rem; background: white; border-radius: 50%; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; border: 4px solid var(--blue); }
    .option-row { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; text-align: right; }
    .option-row select { padding: 10px; border-radius: 10px; background: #0f172a; color: white; border: 1px solid var(--blue); }
    
    .btn { background: var(--blue); color: var(--dark); padding: 18px 40px; border-radius: 15px; border: none; font-weight: bold; font-size: 1.3rem; cursor: pointer; transition: 0.2s; width: 100%; }
    #qrContainer { background: white; padding: 15px; border-radius: 20px; margin-bottom: 20px; display: inline-block; }
    @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
  </style>
</head>
<body>

<div id="choiceScreen" class="screen active">
  <h1>ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
  <button class="btn" onclick="initView('teacher')">ğŸ–¥ï¸ ×¤×ª×— ×œ×•×‘×™ (××¨×¦×”)</button>
  <button class="btn" onclick="initView('student')" style="background: #94a3b8; margin-top: 20px;">ğŸ“± ×”×¦×˜×¨×¤×•×ª (×¡×˜×•×“× ×˜)</button>
</div>

<div id="teacherView" class="screen">
  <h1>×××ª×™× ×™× ×œ×›×•×œ×...</h1>
  <div id="qrContainer"><div id="qrcode"></div></div>
  <h2 id="countLabel">0 ×©×—×§× ×™× ××—×•×‘×¨×™×</h2>
  <div id="playersList"></div>
  <button class="btn" id="startBtn" style="position:fixed; bottom:30px; left:30px; display:none; width:auto;" onclick="alert('×™×•×¦××™× ×œ×“×¨×š!')">×”×ª×—×œ ××©×—×§ ğŸš€</button>
</div>

<div id="studentView" class="screen">
  <h2>×¦×¨×• ××ª ×”×“××•×ª ×©×œ×›×</h2>
  <div class="customizer">
    <div class="preview-box" id="preview">ğŸ‘·â€â™‚ï¸</div>
    
    <div class="option-row">
      <label>×©× ×”×§×‘×•×¦×”:</label>
      <input type="text" id="pName" placeholder="×”×›× ×™×¡×• ×©×..." style="padding:12px; border-radius:10px; border:none; text-align:center;">
    </div>

    <div class="option-row">
      <label>×‘×—×¨×• ×ª×¤×§×™×“:</label>
      <select id="roleSel" onchange="updatePreview()">
        <option value="ğŸ‘·â€â™‚ï¸">××“×¨×™×›×œ/×™×ª</option>
        <option value="ğŸ‘©â€ğŸ’¼">×¢×•×¨×›×ª ×“×™×Ÿ</option>
        <option value="ğŸ—ï¸">×™×–×/×™×ª</option>
        <option value="ğŸ›ï¸">× ×¦×™×’/×ª ×•×¢×“×”</option>
        <option value="ğŸ¡">××ª×›× ×Ÿ/×ª ×¢×¨×™×</option>
        <option value="âš–ï¸">×™×•×¢×"×©</option>
        <option value="ğŸ“">××•×“×“/×ª</option>
        <option value="ğŸŒ³">××“×¨×™×›×œ/×™×ª × ×•×£</option>
      </select>
    </div>

    <div class="option-row">
      <label>×¦×‘×¢ ×¨×§×¢ ×“××•×ª:</label>
      <select id="colorSel" onchange="updatePreview()">
        <option value="white">×œ×‘×Ÿ</option>
        <option value="#38bdf8">×ª×›×œ×ª</option>
        <option value="#f472b6">×•×¨×•×“</option>
        <option value="#facc15">×¦×”×•×‘</option>
        <option value="#4ade80">×™×¨×•×§</option>
      </select>
    </div>

    <button class="btn" id="joinBtn" onclick="sendToLobby()">×× ×™ ××•×›×Ÿ/×”! ×”×¦×˜×¨×¤×•×ª</button>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    authDomain: "erez-taba-game.firebaseapp.com",
    databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/",
    projectId: "erez-taba-game"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function initView(role) {
    document.getElementById('choiceScreen').classList.remove('active');
    if(role === 'teacher') {
      document.getElementById('teacherView').classList.add('active');
      setupTeacher();
    } else {
      document.getElementById('studentView').classList.add('active');
    }
  }

  if(window.location.search.includes('role=student')) initView('student');

  function updatePreview() {
    const preview = document.getElementById('preview');
    preview.innerText = document.getElementById('roleSel').value;
    preview.style.backgroundColor = document.getElementById('colorSel').value;
  }

  function setupTeacher() {
    db.ref('lobby_vFinal').remove();
    new QRCode(document.getElementById("qrcode"), {
      text: window.location.href.split('?')[0] + "?role=student",
      width: 150, height: 150
    });

    db.ref('lobby_vFinal').on('value', (snapshot) => {
      const data = snapshot.val() || {};
      const ids = Object.keys(data);
      document.getElementById('countLabel').innerText = `${ids.length} ×©×—×§× ×™× ××—×•×‘×¨×™×`;
      document.getElementById('playersList').innerHTML = ids.map(id => `
        <div class="player-card">
          <div class="avatar-view" style="background:${data[id].color}; border-radius:50%; width:80px; height:80px; display:flex; align-items:center; justify-content:center;">${data[id].avatar}</div>
          <div class="player-name">${data[id].name}</div>
        </div>
      `).join('');
      document.getElementById('startBtn').style.display = ids.length > 0 ? 'block' : 'none';
    });
  }

  function sendToLobby() {
    const name = document.getElementById('pName').value;
    if(!name) return alert("× × ×œ×”×–×™×Ÿ ×©×");
    
    const btn = document.getElementById('joinBtn');
    btn.innerText = "××ª×—×‘×¨...";
    btn.disabled = true;

    const playerData = {
      name: name,
      avatar: document.getElementById('roleSel').value,
      color: document.getElementById('colorSel').value
    };

    db.ref('lobby_vFinal').push(playerData)
      .then(() => {
        document.getElementById('studentView').innerHTML = `
          <div class="preview-box" style="background:${playerData.color}">${playerData.avatar}</div>
          <h2>××¢×•×œ×”, ${name}!</h2>
          <p>×”×“××•×ª ×©×œ×›× ××•×¤×™×¢×” ×¢×œ ×”××¡×š. ×—×›×• ×©×”××¨×¦×” ×™×ª×—×™×œ ××ª ×”××©×—×§.</p>
        `;
      });
  }
</script>
</body>
</html>
