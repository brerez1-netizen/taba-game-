<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>🏙️ לוח תכנון העיר - ארז ברוכי</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root { --blue: #38bdf8; --gold: #facc15; --bg: #020617; --card: #1e293b; }
    html, body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: white; overflow: hidden; font-family: system-ui, sans-serif; }
    .main-layout { display: flex; flex-direction: row-reverse; width: 100vw; height: 100vh; }
    .board-section { flex: 3.5; display: flex; flex-direction: column-reverse; padding: 10px; gap: 8px; }
    .board-row { display: flex; flex: 1; gap: 8px; }
    .row-reverse { flex-direction: row-reverse; }
    .sidebar { flex: 1.2; background: rgba(15, 23, 42, 0.98); border-right: 3px solid var(--blue); padding: 20px; display: flex; flex-direction: column; }
    .cell { flex: 1; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); background-size: cover; background-position: center; position: relative; background-color: var(--card); overflow: hidden; cursor: pointer; }
    .milestone { border: 4px solid var(--gold); box-shadow: 0 0 15px var(--gold); z-index: 5; }
    .cell-title { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.85); font-size: 0.65rem; padding: 5px 2px; text-align: center; pointer-events: none; min-height: 28px; display: flex; align-items: center; justify-content: center; line-height: 1.1; }
    .cell-num { position: absolute; top: 3px; right: 5px; font-weight: bold; color: var(--blue); font-size: 0.9rem; text-shadow: 1px 1px 2px black; z-index: 10; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 3000; }
    .modal-content { background: var(--card); padding: 40px; border-radius: 20px; border: 3px solid var(--blue); width: 650px; text-align: center; position: relative; box-shadow: 0 0 40px rgba(56, 189, 248, 0.3); }
    .close-btn { position: absolute; top: 15px; left: 15px; background: var(--gold); color: black; border: none; padding: 8px 20px; cursor: pointer; border-radius: 8px; font-weight: bold; }
    .modal-info { font-size: 1.2rem; margin: 20px 0; color: #e2e8f0; line-height: 1.5; text-align: right; }
    .modal-question { background: rgba(250, 204, 21, 0.1); border: 2px dashed var(--gold); padding: 20px; border-radius: 12px; margin-top: 20px; text-align: right; }
    .pawn { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; z-index: 100; transition: all 0.6s ease; border: 2px solid #000; font-size: 1.8rem; box-shadow: 0 5px 10px #000; }
  </style>
</head>
<body>

<div id="gameScreen" class="main-layout">
  <div class="board-section" id="boardContainer"></div>
  <div class="sidebar">
    <h2 style="color:var(--blue); border-bottom:2px solid var(--blue); padding-bottom:10px;">🏙️ לוח תכנון העיר</h2>
    <div style="font-size: 4rem; text-align: center; margin: 10px 0;" id="mainDice">🎲</div>
    <div id="turnText" style="font-size:1.3rem; text-align:center; margin-bottom:15px; font-weight:bold; color:var(--gold);">-</div>
    <div id="playersStatusList" style="flex:1; overflow-y:auto;"></div>
    <div id="qrcode" style="background:white; padding:10px; border-radius:10px; align-self:center; margin-top:10px;"></div>
  </div>
</div>

<div id="infoModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal()">חזור ללוח X</button>
    <div id="modalBody"></div>
  </div>
</div>

<script>
  const config = { apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0", databaseURL: "https://erez-taba-game-default-rtdb.firebaseio.com/", projectId: "erez-taba-game" };
  firebase.initializeApp(config);
  const db = firebase.database();

  // מאגר התוכן המלא ל-50 משבצות
  const gameData = {
    1: { title: "יוזמה רעיונית", info: "בעל קרקע או יזם מחליטים לקדם שינוי ייעוד או תוספת זכויות.", question: "מי יכול ליזום תוכנית בסמכות וועדה מקומית?", sound: "start.mp3" },
    2: { title: "איסוף נתונים", info: "איסוף מידע תכנוני, נסחי טאבו ומצב קיים בשטח.", question: "מהו המסמך המשפטי המעיד על בעלות בקרקע?" },
    3: { title: "מדידת שטח", info: "מדידה על ידי מודד מוסמך להכנת רקע לתוכנית.", question: "לכמה זמן תקפה מדידה לצורך הגשת תוכנית?" },
    4: { title: "פרוגרמה", info: "הגדרת צרכים ושימושים לתוכנית (ציבורי, מגורים, מסחר).", question: "מהו היחס הנדרש לשטחי ציבור בשכונה חדשה?" },
    5: { title: "סקיצה ראשונית", info: "תרגום הפרוגרמה לשרטוטים אדריכליים ראשוניים.", question: "מהי המשמעות של 'קו בניין' בסקיצה?" },
    6: { title: "תיאום יועצים", info: "פגישות עם יועצי תנועה, נוף, סביבה וקונסטרוקציה.", question: "איזה יועץ נדרש לאישור פתרונות חניה?" },
    7: { title: "הכנת מסמכי תב\"ע", info: "עריכת הוראות התוכנית (תקנון) ותשריט.", question: "מה קובע במידה ויש סתירה בין התקנון לתשריט?" },
    8: { title: "הגשה למקומית", info: "הגשת התוכנית במערכת המקוונת לוועדה המקומית.", question: "מהו מספר העותקים הדיגיטליים הנדרש?" },
    9: { title: "בדיקת תנאי סף", info: "בדיקה מנהלתית של מסמכי התוכנית וחתימות.", question: "תוך כמה זמן על הוועדה להחזיר תשובה בתנאי סף?" },
    10: { title: "תיקון ליקויים", info: "ביצוע תיקונים טכניים שעלו בבדיקת תנאי הסף.", question: "האם ניתן להוסיף שטחים בשלב תיקון תנאי סף?" },
    11: { title: "חוות דעת מהנדס", info: "מהנדס הוועדה בוחן את ההיבטים התכנוניים של התוכנית.", question: "האם חוות דעת המהנדס מחייבת את הוועדה?" },
    12: { title: "דיון בוועדת משנה", info: "דיון ראשון במוסד התכנון על מהות התוכנית.", question: "האם יזם רשאי להשתתף בדיון בוועדת המשנה?" },
    13: { title: "קליטה במערכת", info: "התוכנית מקבלת סטטוס 'נקלטה' ומתחילה מניין ימים.", question: "מהי חשיבות מועד קליטת התוכנית?" },
    14: { title: "בדיקת שמאות", info: "בחינת היבטים של היטל השבחה וטבלאות איזון.", question: "מהו סעיף 197 לחוק התכנון והבנייה?" },
    15: { title: "המלצה להפקדה", info: "הוועדה המקומית ממליצה לוועדה המחוזית להפקיד.", question: "מה ההבדל בין המלצה לבין החלטה?" },
    16: { title: "העברה למחוזית", info: "מסמכי התוכנית מועברים ללשכת התכנון המחוזית.", question: "מתי תוכנית נשארת בסמכות וועדה מקומית?" },
    17: { title: "תנאי סף מחוזית", info: "בדיקת תנאי סף נוספת ברמה המחוזית.", question: "האם תנאי הסף במחוזית שונים מהמקומית?" },
    18: { title: "השלמת מסמכים", info: "דרישות להשלמת חוות דעת של משרדי ממשלה.", question: "איזה משרד ממשלתי בוחן היבטי רעש?" },
    19: { title: "חוות דעת מתכנן", info: "מתכנן המחוז מגיש את המלצתו לוועדה המחוזית.", question: "מהי המשמעות של 'תוכנית מתאר מחוזית' (תמ\"מ)?" },
    20: { title: "דיון במחוזית", info: "דיון במליאת הוועדה המחוזית לקראת הפקדה.", question: "מי יושב ראש הוועדה המחוזית?" },
    21: { title: "החלטה להפקדה", info: "החלטה רשמית של המחוזית להפקיד את התוכנית.", question: "אילו תנאים ניתן לקבוע בהחלטה להפקדה?" },
    22: { title: "מילוי תנאים", info: "ביצוע התיקונים הנדרשים בהחלטת הוועדה.", question: "כמה זמן מוקצב למילוי תנאים להפקדה?" },
    23: { title: "אישור נוסח", info: "אישור הנוסח שיפורסם בעיתונות וברשומות.", question: "מי מאשר את נוסח הפרסום?" },
    24: { title: "החתמת יו\"ר", info: "יו\"ר הוועדה חותם על מסמכי התוכנית המופקדת.", question: "האם ניתן להפקיד תוכנית ללא חתימת היו\"ר?" },
    25: { title: "שלב ההפקדה", info: "תחילת מניין הימים להגשת התנגדויות (60 יום).", question: "איפה ניתן לעיין בתוכנית המופקדת?" },
    26: { title: "פרסום עיתונים", info: "פרסום הודעה ב-3 עיתונים (נפוץ, מקומי, ערבי).", question: "מה חובה לכלול בהודעת הפרסום?" },
    27: { title: "הצבת שלטים", info: "הצבת שלטים בולטים בגבולות שטח התוכנית.", question: "מהו הגודל המינימלי של שלט הודעה?" },
    28: { title: "הודעות לשכנים", info: "שליחת הודעות בדואר רשום לבעלי נכסים גובלים.", question: "מי מוגדר כ'שכן גובל' לעניין הודעות?" },
    29: { title: "תקופת התנגדויות", info: "הזמן בו הציבור רשאי להגיש את השגותיו.", question: "האם ניתן להגיש התנגדות לאחר 60 יום?" },
    30: { title: "קבלת התנגדויות", info: "ריכוז כל הפניות שהגיעו מהציבור לוועדה.", question: "מי רשאי להגיש התנגדות?" },
    31: { title: "מינוי חוקר", info: "מינוי איש מקצוע לשמיעת התנגדויות רבות.", question: "מהו תפקידו של חוקר התנגדויות?" },
    32: { title: "דיון התנגדויות", info: "שמיעת המתנגדים בפני וועדת המשנה.", question: "האם עו\"ד חייב לייצג מתנגד בדיון?" },
    33: { title: "דו\"ח חוקר", info: "הגשת המלצות החוקר לוועדה המחוזית.", question: "האם הוועדה חייבת לקבל את המלצות החוקר?" },
    34: { title: "החלטת וועדה", info: "קבלת החלטה סופית לגבי אישור התוכנית.", question: "מהן האפשרויות: אישור, דחייה או אישור בתנאים?" },
    35: { title: "תיקון מסמכים", info: "תיקון סופי של התקנון והתשריט לפי ההחלטה.", question: "מהו 'נוסח סופי' לחתימה?" },
    36: { title: "בדיקה טכנית", info: "בדיקה אחרונה של המערך הדיגיטלי לפני תוקף.", question: "מהו קובץ המבנה האחיד (מבנ\"א)?" },
    37: { title: "מתן תוקף", info: "פרסום הודעה על אישור התוכנית ברשומות.", question: "מתי התוכנית הופכת לחוק מחייב?" },
    38: { title: "פרסום רשומות", info: "הפרסום הרשמי ב'ילקוט הפרסומים' של המדינה.", question: "כמה זמן לאחר הפרסום התוכנית נכנסת לתוקף?" },
    39: { title: "כניסה לתוקף", info: "היום ה-15 לאחר הפרסום ברשומות.", question: "האם ניתן להוציא היתר ביום ה-14?" },
    40: { title: "הפקת היתר", info: "הגשת בקשה להיתר בנייה מכוח התוכנית החדשה.", question: "מהו 'מידע להיתר'?" },
    41: { title: "החתמת מסמכים", info: "החתמת כל הגורמים הרלוונטיים על הבקשה.", question: "מי חייב לחתום על הבקשה להיתר?" },
    42: { title: "תשלום אגרות", info: "חישוב ותשלום אגרות בנייה לוועדה המקומית.", question: "מהו ההבדל בין אגרה להיטל?" },
    43: { title: "היטל השבחה", info: "תשלום בגין עליית ערך המקרקעין עקב התוכנית.", question: "מהו שיעור היטל ההשבחה מההשבחה?" },
    44: { title: "תחילת עבודות", info: "קבלת היתר בנייה פיזי ותחילת עבודה בשטח.", question: "לכמה זמן תקף היתר בנייה?" },
    45: { title: "ליווי ביצוע", info: "פיקוח עליון של האדריכל והמהנדס על הבנייה.", question: "מהו תפקידו של האחראי ל
