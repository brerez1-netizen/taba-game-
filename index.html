<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×‘×™ ×”××©×—×§ - ××¨×– ×‘×¨×•×›×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root { --blue: #38bdf8; --dark: #020617; }
    body { margin: 0; font-family: sans-serif; background: #020617; color: white; text-align: center; }
    .screen { display: none; padding: 20px; flex-direction: column; align-items: center; }
    .active { display: flex; }
    .btn { background: #38bdf8; color: #000; padding: 20px 40px; border-radius: 15px; border: none; font-weight: bold; font-size: 1.5rem; cursor: pointer; margin-top: 20px; width: 80%; max-width: 300px; }
    .player-card { background: white; color: black; padding: 15px 30px; border-radius: 50px; font-size: 1.8rem; margin: 10px; display: inline-block; font-weight: bold; }
    input { padding: 15px; font-size: 1.2rem; width: 80%; max-width: 300px; border-radius: 10px; border: 2px solid #38bdf8; margin-bottom: 10px; text-align: center; }
    #qrcode { background: white; padding: 10px; display: inline-block; border-radius: 10px; }
  </style>
</head>
<body>

<div id="choiceScreen" class="screen active">
  <h1>ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
  <button class="btn" onclick="initRole('teacher')">ğŸ–¥ï¸ ×× ×™ ×”××¨×¦×”</button>
  <button class="btn" onclick="initRole('student')" style="background: #94a3b8;">ğŸ“± ×× ×™ ×¡×˜×•×“× ×˜</button>
</div>

<div id="teacherView" class="screen">
  <h1>×××ª×™× ×™× ×‘×œ×•×‘×™...</h1>
  <div id="qrcode"></div>
  <h2 id="countLabel">0 ×©×—×§× ×™× ××—×•×‘×¨×™×</h2>
  <div id="playersList"></div>
</div>

<div id="studentView" class="screen">
  <h2>×”×¦×˜×¨×¤×•×ª ×œ××©×—×§</h2>
  <input type="text" id="pName" placeholder="×©× ×”×§×‘×•×¦×”">
  <button class="btn" id="joinBtn" onclick="sendToLobby()">×”×¦×˜×¨×¤×•×ª!</button>
  <p id="msg" style="margin-top: 20px; color: #38bdf8;"></p>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    databaseURL: "https://erez-taba-game-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "erez-taba-game"
  };

  // ××ª×—×•×œ
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function initRole(role) {
    document.getElementById('choiceScreen').style.display = 'none';
    if(role === 'teacher') {
      document.getElementById('teacherView').style.display = 'flex';
      setupTeacher();
    } else {
      document.getElementById('studentView').style.display = 'flex';
    }
  }

  // ×–×™×”×•×™ ××•×˜×•××˜×™ ××”×¡×¨×™×§×”
  if(window.location.search.includes('role=student')) {
    initRole('student');
  }

  function setupTeacher() {
    db.ref('lobby_v3').remove(); // ××™×¤×•×¡ ×œ×•×‘×™
    new QRCode(document.getElementById("qrcode"), {
      text: window.location.href.split('?')[0] + "?role=student",
      width: 150, height: 150
    });

    db.ref('lobby_v3').on('value', (snapshot) => {
      const p = snapshot.val() || {};
      const ids = Object.keys(p);
      document.getElementById('countLabel').innerText = ids.length + " ×©×—×§× ×™× ××—×•×‘×¨×™×";
      document.getElementById('playersList').innerHTML = ids.map(id => `<div class="player-card">${p[id].name}</div>`).join('');
    });
  }

  function sendToLobby() {
    const name = document.getElementById('pName').value;
    if(!name) { alert("× × ×œ×”×–×™×Ÿ ×©×"); return; }
    
    // ×—×™×•×•×™ ××™×™×“×™ ×©×”×œ×—×™×¦×” ×¢×•×‘×“×ª
    document.getElementById('joinBtn').innerText = "×©×•×œ×—...";
    document.getElementById('joinBtn').disabled = true;

    db.ref('lobby_v3').push({ name: name })
      .then(() => {
        document.getElementById('msg').innerText = "××¢×•×œ×”! ×”×©× ××•×¤×™×¢ ×‘××—×©×‘ ×”××¨×¦×”.";
        document.getElementById('joinBtn').style.display = 'none';
      })
      .catch((error) => {
        alert("×©×’×™××” ×‘×—×™×‘×•×¨: " + error.message);
        document.getElementById('joinBtn').disabled = false;
        document.getElementById('joinBtn').innerText = "× ×¡×” ×©×•×‘";
      });
  }
</script>
</body>
</html>
