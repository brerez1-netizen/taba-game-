<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨ - ×”××”×“×•×¨×” ×”××œ××” ×œ××•×‘×™×™×œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --stage1: #38bdf8; --stage2: #6366f1; --stage3: #22c55e;
      --stage4: #f97316; --stage5: #facc15;
      --bg-dark: #020617;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: system-ui, sans-serif; background: var(--bg-dark); color: #e5f4ff; overflow-x: hidden; }

    /* ××¡×›×™× */
    .screen { display: none; min-height: 100vh; padding: 15px; flex-direction: column; }
    .screen.active { display: flex; }

    /* ×œ×•×— × ×—×© */
    .board-container { width: 100%; max-width: 600px; margin: 0 auto; padding-bottom: 160px; }
    .board-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }

    .cell {
      aspect-ratio: 1; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1);
      position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
      background-size: cover; background-position: center; background-blend-mode: multiply;
      background-color: rgba(15, 23, 42, 0.7); font-size: 0.6rem; font-weight: bold; text-align: center;
      color: white; overflow: hidden;
    }
    .cell-label { z-index: 1; padding: 2px; background: rgba(0,0,0,0.5); width: 100%; position: absolute; bottom: 0; }

    /* ×©×—×§× ×™× */
    .pawn {
      width: 28px; height: 28px; border-radius: 50%; background: white;
      display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
      position: absolute; z-index: 100; transition: all 0.4s ease;
      box-shadow: 0 0 10px rgba(0,0,0,0.8); border: 2px solid #000;
    }

    /* ×‘×§×¨×ª ××©×—×§ */
    .controls {
      position: fixed; bottom: 0; left: 0; right: 0; background: #0f172a;
      padding: 15px; border-top: 3px solid var(--stage1); z-index: 200;
      display: flex; justify-content: space-between; align-items: center;
    }
    .dice-btn {
      width: 70px; height: 70px; background: linear-gradient(135deg, #0ea5e9, #2563eb);
      border-radius: 15px; border: none; font-size: 2rem; color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* ××•×“×œ×™× */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 1000; padding: 20px; }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .modal-content { background: #1e293b; width: 100%; max-height: 90vh; border-radius: 20px; padding: 24px; overflow-y: auto; border: 3px solid var(--stage1); text-align: center; }
    
    /* ×’×œ×’×œ ×”×—×œ×˜×” ××©×•×“×¨×’ */
    .wheel-container { position: relative; width: 200px; height: 200px; margin: 20px auto; }
    .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid #ef4444; z-index: 10; }
    .wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid #38bdf8; transition: transform 3s cubic-bezier(0.1, 0, 0.2, 1); background: conic-gradient(#22c55e 0deg 120deg, #fde047 120deg 240deg, #ef4444 240deg 360deg); }

    .primary-btn { background: #38bdf8; color: #020617; padding: 14px; border-radius: 12px; border: none; font-weight: bold; width: 100%; margin-top: 15px; font-size: 1.1rem; cursor: pointer; }
    .player-entry { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
    input, select { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #38bdf8; background: #020617; color: white; }
  </style>
</head>
<body>

<div id="welcomeScreen" class="screen active" style="text-align: center; justify-content: center;">
  <h1 style="color: var(--stage1); font-size: 2.5rem; margin-bottom: 15px;">ğŸ™ï¸ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
  <p style="font-size: 1.2rem; opacity: 0.8;">×§×•×¨×¡ ×ª×—×™×§×ª ×”×‘× ×™×™×” | ××¨×¦×”: ××¨×– ×‘×¨×•×›×™</p>
  <button class="primary-btn" onclick="showScreen('setupScreen')">×”×ª×—×œ ××©×—×§</button>
</div>

<div id="setupScreen" class="screen">
  <h2 style="margin-bottom: 20px;">×”×’×“×¨×ª ×§×‘×•×¦×•×ª</h2>
  <div id="playerInputs">
    <div class="player-entry">
      <input type="text" placeholder="×©× ×”×§×‘×•×¦×”">
      <select>
        <option value="ğŸ“">ğŸ“ ××“×¨×™×›×œ/×™×ª</option>
        <option value="ğŸ›ï¸">ğŸ›ï¸ ××ª×›× ×Ÿ/×ª</option>
        <option value="ğŸ—ï¸">ğŸ—ï¸ ×™×–×/×™×ª</option>
        <option value="âš–ï¸">âš–ï¸ ×¢×•"×“</option>
      </select>
    </div>
  </div>
  <button onclick="addPlayerInput()" style="background:none; color:var(--stage1); border:none; margin:15px 0; font-weight:bold;">+ ×”×•×¡×£ ×§×‘×•×¦×” / ×©×—×§×Ÿ</button>
  <button class="primary-btn" onclick="initGame()" style="margin-top: auto;">×¦××• ×œ×“×¨×š!</button>
</div>

<div id="gameScreen" class="screen">
  <div class="board-container"><div id="boardGrid" class="board-grid"></div></div>
  <div class="controls">
    <div id="turnInfo">
      <div id="activePlayerName" style="font-weight:bold; color:var(--stage1); font-size: 1.1rem;">×©×—×§×Ÿ 1</div>
      <div id="activePlayerPos" style="font-size: 0.9rem; opacity: 0.7;">××©×‘×¦×ª 1</div>
    </div>
    <button id="diceBtn" class="dice-btn" onclick="handleRoll()">ğŸ²</button>
  </div>
</div>

<div id="mainModal" class="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* × ×ª×•× ×™ ×”×œ×•×— ×”××œ××™× */
const boardData = [
  { num: 1, stage: 1, title: "×™×•×–××” ×¨××©×•× ×™×ª", type: "knowledge", text: "×‘×©×œ×‘ ×–×” × ×•×œ×“ ×”×¨×¢×™×•×Ÿ ×œ×©×™× ×•×™ ×ª×›× ×•×Ÿ. ×”×™×•×–××” ×™×›×•×œ×” ×œ×”×’×™×¢ ××¨×©×•×ª ××• ××™×–× ×¤×¨×˜×™." },
  { num: 15, stage: 2, title: "×‘×“×™×§×” ××§×“××™×ª", type: "decision", text: "×”×•×•×¢×“×” ×‘×•×—× ×ª ××ª ×©×œ××•×ª ×”×—×•××¨ ×•×”×ª×××” ×œ××“×™× ×™×•×ª.", authority: "×•×¢×“×” ××§×•××™×ª", outcomes: [{res:"××™×©×•×¨", m:2}, {res:"×ª×™×§×•× ×™×", m:0}, {res:"×“×—×™×™×”", m:-3}] },
  { num: 22, stage: 3, title: "×“×™×•×Ÿ ×‘×”×¤×§×“×”", type: "decision", text: "×”×¦×’×ª ×”×ª×›× ×™×ª ×•×¢××“×ª ××”× ×“×¡ ×”×¢×™×¨.", authority: "×•×¢×“×” ××§×•××™×ª", outcomes: [{res:"×”×¤×§×“×” ××œ××”", m:3}, {res:"×‘×ª× ××™×", m:1}, {res:"×¡×™×¨×•×‘", m:-4}] },
  { num: 30, stage: 4, title: "×“×™×•×Ÿ ×‘×”×ª× ×’×“×•×™×•×ª", type: "decision", text: "×©××™×¢×ª ×˜×¢× ×•×ª ×”×¦×™×‘×•×¨ ×•×‘×—×™× ×ª×Ÿ.", authority: "×•×¢×“×” ××§×•××™×ª", outcomes: [{res:"×“×—×™×™×ª ×”×ª× ×’×“×•×ª", m:2}, {res:"×©×™× ×•×™ ×§×œ", m:0}, {res:"×§×‘×œ×ª ×”×ª× ×’×“×•×ª", m:-3}] },
  { num: 42, stage: 5, title: "×”×—×œ×˜×ª ×©×¨ ×”×¤× ×™×", type: "decision", text: "×‘×—×™× ×ª ×”×©×œ×›×•×ª ×¨×•×—×‘ ×•×©×™×§×•×œ×™ ×¢×œ.", authority: "×©×¨ ×”×¤× ×™×", outcomes: [{res:"××™×©×•×¨ ×¡×•×¤×™", m:3}, {res:"×”×—×–×¨×” ×œ×ª×™×§×•×Ÿ", m:-1}, {res:"×“×—×™×™×”", m:-5}] }
];

// ×”×©×œ××ª 50 ××©×‘×¦×•×ª
for(let i=1; i<=50; i++) {
  if(!boardData.find(d => d.num === i)) {
    boardData.push({ num: i, stage: Math.ceil(i/10), title: `×©×œ×‘ ${i}`, type: "knowledge", text: "××™×“×¢ ×¢×œ ×ª×”×œ×™×š ×”×ª×›× ×•×Ÿ ×•×”×‘× ×™×™×”." });
  }
}
boardData.sort((a,b) => a.num - b.num);

let players = [];
let currentPlayerIdx = 0;

function addPlayerInput() {
  const div = document.createElement('div');
  div.className = 'player-entry';
  div.innerHTML = `<input type="text" placeholder="×©× ×©×—×§×Ÿ ${document.querySelectorAll('.player-entry').length + 1}">
                  <select><option value="ğŸ“">ğŸ“</option><option value="ğŸ›ï¸">ğŸ›ï¸</option><option value="ğŸ—ï¸">ğŸ—ï¸</option><option value="âš–ï¸">âš–ï¸</option></select>`;
  document.getElementById('playerInputs').appendChild(div);
}

function initGame() {
  const entries = document.querySelectorAll('.player-entry');
  players = Array.from(entries).map(e => ({
    name: e.querySelector('input').value || "×§×‘×•×¦×”",
    icon: e.querySelector('select').value,
    pos: 0
  }));
  renderBoard();
  showScreen('gameScreen');
  updateTurnUI();
}

function renderBoard() {
  const grid = document.getElementById('boardGrid');
  grid.innerHTML = '';
  boardData.forEach(cell => {
    const div = document.createElement('div');
    const row = Math.floor((cell.num-1) / 4);
    const displayIndex = (row % 2 === 0) ? cell.num : (row * 4) + (4 - ((cell.num-1) % 4));
    const data = boardData[displayIndex-1];
    
    div.className = `cell stage${data.stage}`;
    div.id = `cell-${displayIndex}`;
    // ×©×™××•×© ×‘×ª××•× ×•×ª ×”××§×•×¨×™×•×ª ×©×œ×š
    div.style.backgroundImage = `url('images/m${data.stage}-${String(displayIndex).padStart(2,'0')}.jpeg')`;
    div.innerHTML = `<span class="cell-num">${displayIndex}</span><div class="cell-label">${data.title}</div>`;
    grid.appendChild(div);
  });
  setTimeout(updatePawns, 200);
}

async function handleRoll() {
  const btn = document.getElementById('diceBtn');
  btn.disabled = true;
  const steps = Math.floor(Math.random() * 6) + 1;
  btn.textContent = steps;
  
  for(let i=0; i<steps; i++) {
    if(players[currentPlayerIdx].pos < 49) {
      players[currentPlayerIdx].pos++;
      updatePawns();
      await new Promise(r => setTimeout(r, 350));
    }
  }
  btn.disabled = false;
  handleLanding();
}

function updatePawns() {
  players.forEach((p, idx) => {
    let pElem = document.getElementById(`pawn-${idx}`);
    if(!pElem) {
      pElem = document.createElement('div');
      pElem.id = `pawn-${idx}`;
      pElem.className = 'pawn';
      pElem.textContent = p.icon;
      document.body.appendChild(pElem);
    }
    const cell = document.getElementById(`cell-${p.pos + 1}`);
    if(cell) {
      const rect = cell.getBoundingClientRect();
      pElem.style.top = `${rect.top + window.scrollY + (idx * 3)}px`;
      pElem.style.left = `${rect.left + (idx * 3)}px`;
      if(idx === currentPlayerIdx) cell.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  });
  document.getElementById('activePlayerPos').textContent = `××©×‘×¦×ª ${players[currentPlayerIdx].pos + 1}`;
}

function handleLanding() {
  const cell = boardData[players[currentPlayerIdx].pos];
  const content = document.getElementById('modalContent');
  
  if(cell.type === "decision") {
    content.innerHTML = `<h2 style="color:var(--stage${cell.stage})">âš–ï¸ ${cell.title}</h2><p style="margin:10px 0;">${cell.text}</p><p><b>×¡××›×•×ª: ${cell.authority}</b></p><div class="wheel-container"><div class="wheel-pointer"></div><div class="wheel" id="wheel"></div></div><button class="primary-btn" id="spinBtn" onclick="spinWheel(${cell.num})">×¡×•×‘×‘ ×’×œ×’×œ ×”×—×œ×˜×”</button>`;
  } else {
    content.innerHTML = `<h2 style="color:var(--stage${cell.stage})">${cell.title}</h2><p style="margin:15px 0;">${cell.text}</p><button class="primary-btn" onclick="closeModal()">×”××©×š ×‘×ª×•×¨</button>`;
  }
  document.getElementById('mainModal').classList.add('active');
}

function spinWheel(cellNum) {
  const cell = boardData.find(d => d.num === cellNum);
  const btn = document.getElementById('spinBtn');
  const wheel = document.getElementById('wheel');
  btn.disabled = true;
  
  const deg = 1080 + Math.floor(Math.random() * 360);
  wheel.style.transform = `rotate(${deg}deg)`;
  
  setTimeout(() => {
    const finalAngle = deg % 360;
    let outcome;
    // 0-120 ×™×¨×•×§, 120-240 ×¦×”×•×‘, 240-360 ××“×•×
    if(finalAngle < 120) outcome = cell.outcomes[0];
    else if(finalAngle < 240) outcome = cell.outcomes[1];
    else outcome = cell.outcomes[2];

    alert(`×”×ª×§×‘×œ×” ×”×—×œ×˜×”: ${outcome.res}! ×–×–×™× ${outcome.m} ××©×‘×¦×•×ª.`);
    players[currentPlayerIdx].pos = Math.max(0, Math.min(49, players[currentPlayerIdx].pos + outcome.m));
    updatePawns();
    closeModal();
  }, 3200);
}

function closeModal() {
  document.getElementById('mainModal').classList.remove('active');
  currentPlayerIdx = (currentPlayerIdx + 1) % players.length;
  updateTurnUI();
}

function updateTurnUI() {
  document.getElementById('activePlayerName').textContent = players[currentPlayerIdx].name;
  document.getElementById('diceBtn').textContent = "ğŸ²";
  updatePawns();
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

window.addEventListener('resize', updatePawns);
</script>
</body>
</html>
