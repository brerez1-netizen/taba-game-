<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×‘×™ ×”××©×—×§ - ××¨×– ×‘×¨×•×›×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root { --blue: #38bdf8; --dark: #020617; }
    body { margin: 0; font-family: system-ui, sans-serif; background: radial-gradient(circle, #1e293b 0%, #020617 100%); color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
    .screen { display: none; width: 100%; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    .active { display: flex; }
    h1 { font-size: 3rem; color: var(--blue); text-shadow: 0 0 20px rgba(56,189,248,0.4); margin-bottom: 10px; }
    #playersList { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; max-width: 1000px; margin-top: 30px; }
    .player-card { background: white; color: var(--dark); padding: 15px 30px; border-radius: 50px; font-size: 1.8rem; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.4); animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes pop { 0% { transform: scale(0) rotate(-10deg); } 100% { transform: scale(1) rotate(0); } }
    #qrContainer { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 0 30px rgba(56,189,248,0.3); margin-bottom: 20px; }
    .btn { background: var(--blue); color: var(--dark); padding: 20px 40px; border-radius: 15px; border: none; font-weight: bold; font-size: 1.5rem; cursor: pointer; transition: 0.2s; }
    .icon-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
    .icon-opt { font-size: 2.5rem; padding: 10px; border: 3px solid transparent; border-radius: 15px; cursor: pointer; }
    .icon-opt.selected { border-color: var(--blue); background: rgba(56,189,248,0.2); }
  </style>
</head>
<body>

<div id="choiceScreen" class="screen active">
  <h1>ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
  <button class="btn" onclick="initView('teacher')">ğŸ–¥ï¸ ×¤×ª×— ×œ×•×‘×™ (××¨×¦×”)</button>
  <button class="btn" onclick="initView('student')" style="margin-top: 20px; background: #94a3b8;">ğŸ“± ×”×¦×˜×¨×¤×•×ª (×¡×˜×•×“× ×˜)</button>
</div>

<div id="teacherView" class="screen">
  <h1>××—×›×™× ×œ×›× ×‘×œ×•×‘×™...</h1>
  <div id="qrContainer"><div id="qrcode"></div></div>
  <h2 id="countLabel">0 ×©×—×§× ×™× ××—×•×‘×¨×™×</h2>
  <div id="playersList"></div>
  <button class="btn" id="startBtn" style="position:fixed; bottom:30px; left:30px; display:none;" onclick="alert('×”×—×™×‘×•×¨ ×”×¦×œ×™×—!')">×”×ª×—×œ ××©×—×§ ğŸš€</button>
</div>

<div id="studentView" class="screen">
  <h2>×”×¦×˜×¨×¤×•×ª ×œ××©×—×§</h2>
  <input type="text" id="pName" placeholder="×©× ×”×§×‘×•×¦×”" style="width:100%; max-width:300px; padding:15px; font-size:1.2rem; border-radius:10px; border:2px solid var(--blue); background:#0f172a; color:white; text-align:center;">
  <div class="icon-grid">
    <div class="icon-opt" onclick="selIcon(this, 'ğŸ“')">ğŸ“</div><div class="icon-opt" onclick="selIcon(this, 'ğŸ›ï¸')">ğŸ›ï¸</div>
    <div class="icon-opt" onclick="selIcon(this, 'ğŸ—ï¸')">ğŸ—ï¸</div><div class="icon-opt" onclick="selIcon(this, 'âš–ï¸')">âš–ï¸</div>
    <div class="icon-opt" onclick="selectIcon(this, 'ğŸ¨')">ğŸ¨</div><div class="icon-opt" onclick="selectIcon(this, 'ğŸ¡')">ğŸ¡</div>
    <div class="icon-opt" onclick="selectIcon(this, 'ğŸ¢')">ğŸ¢</div><div class="icon-opt" onclick="selectIcon(this, 'ğŸŒ³')">ğŸŒ³</div>
  </div>
  <button class="btn" onclick="sendToLobby()">×”×¦×˜×¨×¤×•×ª!</button>
</div>

<script>
  const config = {
    apiKey: "AIzaSyDo9f15BQWkbRi99BMMOpeytdS4V8gbNg0",
    databaseURL: "https://erez-taba-game-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "erez-taba-game"
  };
  firebase.initializeApp(config);
  const db = firebase.database();
  let currentIcon = 'ğŸ“';

  function initView(role) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    if(role === 'teacher') {
      document.getElementById('teacherView').classList.add('active');
      db.ref('lobby_v2').remove();
      new QRCode(document.getElementById("qrcode"), { text: window.location.href.split('?')[0] + "?role=student", width: 160, height: 160 });
      db.ref('lobby_v2').on('value', s => {
        const p = s.val() || {};
        const ids = Object.keys(p);
        document.getElementById('playersList').innerHTML = ids.map(id => `<div class="player-card">${p[id].icon} ${p[id].name}</div>`).join('');
        document.getElementById('countLabel').innerText = `${ids.length} ×©×—×§× ×™× ××—×•×‘×¨×™×`;
        document.getElementById('startBtn').style.display = ids.length > 0 ? 'block' : 'none';
      });
    } else {
      document.getElementById('studentView').classList.add('active');
    }
  }

  // ×–×™×”×•×™ ××•×˜×•××˜×™ ××”×¡×¨×™×§×”
  if(window.location.search.includes('role=student')) initView('student');

  function selIcon(el, icon) {
    document.querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected'); currentIcon = icon;
  }

  function sendToLobby() {
    const name = document.getElementById('pName').value;
    if(!name) return alert("× × ×œ×”×–×™×Ÿ ×©×");
    db.ref('lobby_v2').push({ name: name, icon: currentIcon }).then(() => {
      document.getElementById('studentView').innerHTML = "<h1>××¢×•×œ×”! ×”×©× ×©×œ×›× ××•×¤×™×¢ ×¢×œ ×”××¡×š :)</h1>";
    });
  }
</script>
</body>
</html>
