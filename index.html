<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2933 0%, #020617 50%, #000 100%);
      color: #e5f4ff;
      direction: rtl;
    }

    .screen {
      display: none;
      min-height: 100vh;
    }

    .screen.active {
      display: flex;
    }

    .centered {
      margin: 0 auto;
      width: 100%;
      max-width: 1400px;
      padding: 16px;
    }

    /* --- ××¡×š ×¤×ª×™×—×” --- */
    .welcome-screen {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 24px;
    }

    .welcome-title {
      font-size: clamp(2.5rem, 4vw, 3.5rem);
      color: #38bdf8;
      text-shadow: 0 0 25px rgba(56,189,248,0.9);
    }

    .welcome-subtitle {
      font-size: clamp(1.2rem, 2.2vw, 1.5rem);
      color: #fde047;
    }

    .welcome-image {
      max-width: 420px;
      width: 80%;
      border-radius: 16px;
      border: 3px solid #38bdf8;
      box-shadow: 0 0 35px rgba(56,189,248,0.6);
      object-fit: cover;
    }

    .primary-btn {
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      color: #020617;
      padding: 14px 40px;
      border-radius: 999px;
      border: none;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 25px rgba(34,211,238,0.7);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .primary-btn:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 0 35px rgba(34,211,238,0.9);
    }

    /* --- ××¡×š ×”×’×“×¨×ª ×©×—×§× ×™× --- */
    .setup-screen {
      flex-direction: column;
    }

    .setup-header {
      text-align: center;
      margin-bottom: 16px;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid rgba(56,189,248,0.4);
      background: rgba(15,23,42,0.9);
      box-shadow: 0 0 25px rgba(15,23,42,0.7);
    }

    .setup-title {
      font-size: clamp(2rem, 3vw, 2.5rem);
      color: #38bdf8;
      margin-bottom: 4px;
    }

    .setup-sub {
      color: #fde047;
      font-size: 1rem;
    }

    .players-setup {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }

    .player-setup-card {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      border: 2px solid rgba(30,64,175,0.8);
      padding: 16px;
      box-shadow: 0 0 20px rgba(15,23,42,0.9);
    }

    .player-setup-card h3 {
      font-size: 1.1rem;
      color: #38bdf8;
      margin-bottom: 12px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      display: block;
      font-size: 0.9rem;
      color: #e5f4ff;
      margin-bottom: 4px;
    }

    .form-group input {
      width: 100%;
      padding: 8px 10px;
      background: rgba(15,23,42,0.9);
      border-radius: 8px;
      border: 1px solid #38bdf8;
      color: #e5f4ff;
      font-size: 0.95rem;
    }

    .gender-select {
      display: flex;
      gap: 8px;
    }

    .gender-btn {
      flex: 1;
      padding: 8px;
      font-size: 0.9rem;
      border-radius: 999px;
      border: 1px solid #38bdf8;
      background: rgba(15,23,42,0.9);
      color: #38bdf8;
      cursor: pointer;
      transition: 0.2s;
    }

    .gender-btn.selected {
      background: #38bdf8;
      color: #020617;
      font-weight: 600;
    }

    .character-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .character-option {
      aspect-ratio: 1;
      border-radius: 10px;
      border: 1px solid #38bdf8;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      background: rgba(15,23,42,0.9);
      cursor: pointer;
      transition: 0.2s;
    }

    .character-option.selected {
      background: #38bdf8;
      color: #020617;
      box-shadow: 0 0 15px rgba(56,189,248,0.9);
    }

    .character-name {
      margin-top: 4px;
      font-size: 0.8rem;
      text-align: center;
      color: #9ca3af;
    }

    .add-player-btn,
    .remove-player-btn {
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      padding: 8px 18px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 6px;
    }

    .add-player-btn {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #020617;
      box-shadow: 0 0 20px rgba(34,197,94,0.6);
    }

    .remove-player-btn {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
      color: #fee2e2;
    }

    .setup-actions {
      text-align: center;
      margin: 12px 0 8px;
    }

    .begin-game-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* --- ××¡×š ××©×—×§ --- */
    .game-screen {
      flex-direction: column;
    }

    header.game-header {
      padding: 12px 16px;
      border-radius: 16px;
      border: 2px solid rgba(56,189,248,0.5);
      background: rgba(15,23,42,0.96);
      text-align: center;
      margin-bottom: 12px;
    }

    .game-title {
      font-size: clamp(2rem, 3vw, 2.5rem);
      color: #38bdf8;
      text-shadow: 0 0 22px rgba(56,189,248,0.9);
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #fde047;
    }

    .game-layout {
      display: grid;
      grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
      gap: 12px;
      margin-top: 12px;
      align-items: start;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .panel {
      background: rgba(15,23,42,0.96);
      border-radius: 12px;
      border: 2px solid rgba(30,64,175,0.8);
      padding: 10px;
      box-shadow: 0 0 22px rgba(15,23,42,0.9);
    }

    .players-list h2 {
      font-size: 1rem;
      color: #38bdf8;
      margin-bottom: 8px;
      text-align: center;
    }

    .players-list-content {
      max-height: 320px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .player-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.8);
      margin-bottom: 6px;
      font-size: 0.8rem;
    }

    .player-item.current {
      border-color: #fde047;
      box-shadow: 0 0 14px rgba(250,204,21,0.8);
      background: linear-gradient(135deg, rgba(30,64,175,0.9), rgba(15,23,42,0.95));
    }

    .player-avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle, #0ea5e9, #1d4ed8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      border: 2px solid #e5f4ff;
      flex-shrink: 0;
    }

    .player-info-line {
      color: #e5f4ff;
    }

    .player-role {
      color: #a5b4fc;
      font-size: 0.75rem;
    }

    .player-pos {
      color: #fde047;
      font-size: 0.8rem;
    }

    .dice-container {
      text-align: center;
      margin-bottom: 8px;
    }

    .dice {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      border: 3px solid #38bdf8;
      background: radial-gradient(circle, #1d4ed8, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.4rem;
      margin: 0 auto 8px;
      cursor: pointer;
      box-shadow: 0 0 24px rgba(37,99,235,0.9);
      transition: 0.2s;
    }

    .dice.rolling {
      animation: roll 0.5s linear infinite;
    }

    @keyframes roll {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(90deg); }
      50% { transform: rotate(180deg); }
      75% { transform: rotate(270deg); }
    }

    .roll-btn {
      width: 100%;
      padding: 10px;
      font-size: 0.95rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      color: #020617;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(34,211,238,0.7);
    }

    .roll-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .sound-toggle {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.55);
      background: rgba(2,6,23,0.35);
      color: #e5f4ff;
      cursor: pointer;
      box-shadow: 0 0 14px rgba(56,189,248,0.25);
    }

    .sound-toggle:hover {
      box-shadow: 0 0 22px rgba(56,189,248,0.45);
    }


    .current-player-box {
      margin-top: 8px;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #fde047;
      background: rgba(30,64,175,0.9);
      text-align: center;
    }

    .current-player-label {
      font-size: 0.8rem;
      color: #fde047;
    }

    .current-player-name {
      font-size: 1rem;
      font-weight: 700;
    }

    .legend h3 {
      font-size: 0.95rem;
      color: #38bdf8;
      margin-bottom: 6px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid #38bdf8;
      flex-shrink: 0;
    }

    /* --- ×œ×•×— --- */
    .board-wrapper {
      background: radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(3,7,18,0.98));
      border-radius: 16px;
      border: 3px solid #38bdf8;
      padding: 12px;
      box-shadow: 0 0 30px rgba(56,189,248,0.6);
      max-height: calc(100vh - 260px);
      display: flex;
      align-items: stretch;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: 1.2fr repeat(4, 1fr) 1.2fr;
      gap: 4px;
      width: 100%;
      max-width: 100%;
      height: 100%;
    }

    .cell {
      border-radius: 10px;
      border: 2px solid rgba(15,23,42,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      cursor: pointer;
      overflow: visible;
      padding: 4px;
      font-size: 0.85rem;
      color: #0f172a;
      text-align: center;
      transition: transform 0.15s ease, box-shadow 0.15s ease;

      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: rgba(15,23,42,0.6);
      background-blend-mode: multiply;
      min-height: 60px;
    }

    .cell:hover {
      transform: scale(1.04);
      box-shadow: 0 0 14px rgba(56,189,248,0.9);
      z-index: 5;
    }

    .cell-number {
      position: absolute;
      top: 3px;
      left: 4px;
      font-size: 0.7rem;
      color: #f9fafb;
      text-shadow: 0 0 4px rgba(0,0,0,0.9);
    }

    .cell-label {
      z-index: 1;
      padding: 2px 4px;
      background: rgba(15,23,42,0.6);
      border-radius: 6px;
      color: #e5f4ff;
    }

    .cell-icon {
      font-size: 1.3rem;
      margin-top: 2px;
      text-shadow: 0 0 4px rgba(0,0,0,0.8);
    }

    .cell.surprise {
      box-shadow: 0 0 12px rgba(251,191,36,0.9);
    }

    .cell.decision {
      box-shadow: 0 0 12px rgba(248,113,113,0.9);
    }

    .cell.quiz {
      box-shadow: 0 0 12px rgba(56,189,248,0.9);
    }

    .player-pieces {
      position: absolute;
      bottom: 4px;
      right: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      max-width: 95%;
      z-index: 2;
    }

    .player-piece {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 2px solid #020617;
      background: rgba(15,23,42,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      line-height: 1;
      color: #e5f4ff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    /* --- ××•×“×œ×™× --- */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(3,7,18,0.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 12px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      width: 100%;
      max-width: min(1200px, 96vw);
      max-height: 95vh;
      overflow-y: auto;
      background: radial-gradient(circle at top, #020617, #020617 40%, #0b1120 100%);
      border-radius: 18px;
      border: 3px solid #38bdf8;
      padding: 20px;
      position: relative;
      box-shadow: 0 0 35px rgba(56,189,248,0.9);
    }

    .modal-close {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ef4444;
      border: none;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      color: #fef2f2;
      font-size: 1.1rem;
      cursor: pointer;
      z-index: 10;
    }

    .modal-title {
      text-align: center;
      font-size: 1.6rem;
      margin-bottom: 8px;
      color: #38bdf8;
    }

    .modal-section-title {
      font-size: 1rem;
      margin: 8px 0 4px;
      color: #e5f4ff;
      font-weight: 600;
    }

    .modal-text {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 10px;
      color: #e5f4ff;
    }

    .info-image {
      width: 100%;
      max-height: 70vh;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid rgba(56,189,248,0.7);
      background: #020617;
      margin-bottom: 10px;
    }

    .quiz-container {
      margin-top: 12px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(15,23,42,0.95);
      border: 1px solid #38bdf8;
    }

    .quiz-question {
      font-size: 1rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .quiz-answers {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }

    .quiz-answer-btn {
      width: 100%;
      text-align: right;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #38bdf8;
      background: rgba(15,23,42,0.95);
      color: #e5f4ff;
      cursor: pointer;
      font-size: 0.95rem;
      transition: 0.15s;
    }

    .quiz-answer-btn:hover {
      background: rgba(56,189,248,0.15);
    }

    .quiz-answer-btn.correct {
      background: #22c55e;
      color: #022c22;
      border-color: #16a34a;
    }

    .quiz-answer-btn.wrong {
      background: #ef4444;
      color: #fef2f2;
      border-color: #b91c1c;
    }

    .quiz-feedback {
      font-size: 0.95rem;
      margin-top: 4px;
    }

    .quiz-feedback.correct {
      color: #4ade80;
    }

    .quiz-feedback.wrong {
      color: #fecaca;
    }

    .surprise-card {
      border-radius: 14px;
      padding: 12px;
      background: linear-gradient(135deg, #facc15, #f97316);
      color: #1f2933;
      margin: 8px 0;
      box-shadow: 0 0 20px rgba(250,204,21,0.9);
    }

    .surprise-action {
      margin-top: 6px;
      font-weight: 700;
      font-size: 1rem;
    }

    .authority-box {
      margin: 10px 0;
      padding: 10px;
      border-radius: 12px;
      background: rgba(30,64,175,0.9);
      border: 1px solid #6366f1;
    }

    .authority-label {
      font-size: 0.9rem;
      color: #c7d2fe;
    }

    .authority-name {
      font-size: 1rem;
      font-weight: 700;
    }

    .wheel-container {
      margin-top: 10px;
      text-align: center;
    }

    .wheel-pointer {
      width: 0;
      height: 0;
      border-left: 16px solid transparent;
      border-right: 16px solid transparent;
      border-top: 26px solid #ef4444;
      margin: 0 auto 4px;
    }

    .wheel {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      border: 4px solid #38bdf8;
      margin: 0 auto;
      background: conic-gradient(
        #22c55e 0deg 120deg,
        #fde047 120deg 240deg,
        #ef4444 240deg 360deg
      );
      position: relative;
      transition: transform 2s cubic-bezier(0.25, 0.1, 0.25, 1);
      box-shadow: 0 0 26px rgba(56,189,248,0.9);
    }

    .wheel-center {
      position: absolute;
      inset: 50%;
      transform: translate(-50%, -50%);
      width: 56px;
      height: 56px;
      border-radius: 999px;
      border: 3px solid #38bdf8;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #e5f4ff;
    }

    .spin-btn {
      margin-top: 8px;
      padding: 8px 24px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      color: #020617;
      cursor: pointer;
      font-weight: 700;
    }

    .spin-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .result-box {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      background: rgba(15,23,42,0.96);
      border: 1px solid #22c55e;
      display: none;
    }

    .result-box.active {
      display: block;
    }

    .result-title {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    /* --- ××¡×š ×¡×™×•× --- */
    .end-screen {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 16px;
      gap: 16px;
    }

    .end-card {
      max-width: 640px;
      width: 100%;
      background: rgba(15,23,42,0.96);
      border-radius: 18px;
      border: 2px solid #38bdf8;
      box-shadow: 0 0 30px rgba(56,189,248,0.8);
      padding: 16px;
    }

    .end-title {
      font-size: 2rem;
      color: #facc15;
      margin-bottom: 10px;
    }

    .end-image {
      width: 100%;
      max-height: 260px;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid #38bdf8;
      margin-bottom: 10px;
    }

    .ranking-list {
      list-style: none;
      text-align: right;
      margin-top: 6px;
    }

    .ranking-list li {
      padding: 4px 0;
      font-size: 1rem;
    }

    .small-note {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    @media (max-width: 960px) {
      .game-layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        order: 2;
      }
    }

    @media (max-width: 640px) {
      .board {
        gap: 3px;
      }

      .cell {
        font-size: 0.75rem;
      }

      .player-piece {
        width: 22px;
        height: 22px;
        font-size: 0.85rem;
      }

      .modal-content {
        padding: 12px;
      }
    }
  
/* ===== ×¦×™×¨ ×”×ª×§×“××•×ª (5 ×©×œ×‘×™×) â€“ ×¤×¨×™×¡×” ×¦×“×™×ª ×‘×¡×’× ×•×Ÿ "××˜×¨×•" ===== */
.modal-content.stage-layout{
  display:flex;
  flex-direction: row; /* RTL: ×”×¤×¨×™×˜ ×”×¨××©×•×Ÿ ×™×•×¤×™×¢ ××™××™×Ÿ */
  gap: 14px;
  align-items: stretch;
}
.modal-content.stage-layout .modal-close{
  position:absolute;
  top: 10px;
  left: 10px; /* ×‘-RTL ×”×›×¤×ª×•×¨ × ×•×— ××©×××œ */
  z-index: 5;
}
.stage-panel{
  flex: 0 0 140px;
  max-width: 140px;
  padding-top: 34px; /* ××§×•× ×œ×›×¤×ª×•×¨ ×¡×’×™×¨×” */
}
.modal-main{
  flex: 1 1 auto;
  min-width: 0;
  max-height: 74vh;
  overflow-y: auto;
  padding-inline-start: 4px;
}
.modal-content.stage-themed{
  border-top: 10px solid var(--stage-color, #2d6cdf);
}
.modal-content.stage-themed::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(135deg, color-mix(in srgb, var(--stage-color, #2d6cdf) 14%, transparent), transparent 60%);
  pointer-events:none;
}

.stage-metro{
  position: relative;
  padding: 8px 6px;
}
.stage-metro .metro-line{
  position:absolute;
  top: 10px;
  bottom: 10px;
  right: 50%;
  width: 4px;
  transform: translateX(50%);
  background: rgba(255,255,255,0.18);
  border-radius: 4px;
}
.stage-metro .metro-stations{
  position: relative;
  display:flex;
  flex-direction: column;
  gap: 10px;
}
.stage-metro .metro-station{
  display:flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  font-size: 12px;
  opacity: 0.92;
}
.stage-metro .metro-station .dot{
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: rgba(255,255,255,0.35);
  border: 2px solid rgba(255,255,255,0.55);
  box-shadow: 0 0 0 0 rgba(255,255,255,0);
  transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
  flex: 0 0 auto;
}
.stage-metro .metro-station .label{
  line-height: 1.15;
}
.stage-metro .metro-station.completed .dot{
  background: color-mix(in srgb, var(--stage-color, #2d6cdf) 65%, #fff);
  border-color: rgba(255,255,255,0.65);
}
.stage-metro .metro-station.current .dot{
  background: var(--stage-color, #2d6cdf);
  border-color: rgba(255,255,255,0.9);
  transform: scale(1.08);
  box-shadow: 0 0 0 6px color-mix(in srgb, var(--stage-color, #2d6cdf) 25%, transparent);
}
.stage-metro .metro-station.current .label{
  font-weight: 700;
}
@media (max-width: 680px){
  .stage-panel{ flex-basis: 92px; max-width: 92px; }
  .stage-metro .metro-station .label{ font-size: 11px; }
}

</style>
</head>
<body>

<!-- ××¡×š ×¤×ª×™×—×” -->
<div id="welcomeScreen" class="screen welcome-screen active">
  <div class="centered" style="text-align:center;">
    <h1 class="welcome-title">ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
    <p class="welcome-subtitle">××¡×¢ ××™× ×˜×¨××§×˜×™×‘×™ ×‘×ª×”×œ×™×š ××™×©×•×¨ ×ª×›× ×™×ª ×‘× ×™×™×Ÿ ×¢×™×¨</p>

    <img src="images/start.jpeg" alt="×¤×ª×™×—×ª ××©×—×§" class="welcome-image">

    <div style="margin-top:18px;">
      <button class="primary-btn" onclick="goToSetup()">×”×ª×—×œ ××©×—×§</button>
      </div>
    </div>
  </div>
</div>

<!-- ××¡×š ×”×’×“×¨×ª ×©×—×§× ×™× -->
<div id="setupScreen" class="screen setup-screen">
  <div class="centered">
    <div class="setup-header">
      <h2 class="setup-title">×”×’×“×¨×ª ×©×—×§× ×™×</h2>
      <p class="setup-sub">×”×•×¡×™×¤×• ×¢×“ 10 ×©×—×§× ×™×, ×‘×—×¨×• ×“××•×ª, ××™×Ÿ ×•×ª×¤×§×™×“</p>
    </div>

    <div id="playersSetup" class="players-setup"></div>

    <div style="text-align:center; margin:8px 0;">
      <button id="addPlayerBtn" class="add-player-btn" type="button" onclick="addPlayerCard()">
        â• ×”×•×¡×£ ×©×—×§×Ÿ
      </button>
    </div>

    <div class="setup-actions">
      <button id="beginGameBtn" class="primary-btn begin-game-btn" type="button" disabled onclick="beginGame()">
        ğŸ® ×”×ª×—×œ ××©×—×§!
      </button>
    </div>
  </div>
</div>

<!-- ××¡×š ××©×—×§ -->
<div id="gameScreen" class="screen game-screen">
  <div class="centered">
    <header class="game-header">
      <h1 class="game-title">ğŸ™ï¸ ××©×—×§ ×ª×›× ×•×Ÿ ×”×¢×™×¨</h1>
      <p class="subtitle">××¡×¢ ××™× ×˜×¨××§×˜×™×‘×™ ×‘×ª×”×œ×™×š ××™×©×•×¨ ×ª×›× ×™×ª ×‘× ×™×™×Ÿ ×¢×™×¨</p>
    </header>

    <div class="game-layout">
      <!-- ×¦×“ ×©×××œ: ×©×—×§× ×™× ×•×§×•×‘×™×™×” -->
      <aside class="sidebar">
        <section class="panel players-list">
          <h2>×©×—×§× ×™×</h2>
          <div id="playersListContent" class="players-list-content"></div>
        </section>

        <section class="panel">
          <div class="dice-container">
            <div id="dice" class="dice">ğŸ²</div>
            <button id="rollBtn" class="roll-btn" type="button">×”×˜×œ ×§×•×‘×™×™×”</button>
            <button id="soundToggle" class="sound-toggle" type="button" title="×¡××•× ×“">ğŸ”Š</button>
          </div>
          <div class="current-player-box">
            <div class="current-player-label">×ª×•×¨ ×©×œ:</div>
            <div id="currentPlayerName" class="current-player-name">-</div>
          </div>
        </section>

        <section class="panel legend">
          <h3>××§×¨×</h3>
          <div class="legend-item">
            <div class="legend-color" style="background:#38bdf8;"></div>
            <span>×©×œ×‘ 1: ×™×•×–××” ×•×”×ª× ×¢×”</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#6366f1;"></div>
            <span>×©×œ×‘ 2: ×”×›× ×ª ××¡××›×™×</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#22c55e;"></div>
            <span>×©×œ×‘ 3: ×¤×¨×¡×•× ×•×”×ª× ×’×“×•×™×•×ª</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#f97316;"></div>
            <span>×©×œ×‘ 4: ××—×•×–×™×ª ×•×¢×¨×¨</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#facc15;"></div>
            <span>×©×œ×‘ 5: ×ª×•×§×£ ×•×”×™×ª×¨×™×</span>
          </div>
          <div class="legend-item">
            <span>âš¡ ××©×‘×¦×ª ×”×¤×ª×¢×”</span>
          </div>
          <div class="legend-item">
            <span>âš–ï¸ ××©×‘×¦×ª ×”×—×œ×˜×”</span>
          </div>
          <div class="legend-item">
            <span>â“ ××©×‘×¦×ª ×™×“×¢ (×©××œ×”)</span>
          </div>
        </section>
      </aside>

      <!-- ×¦×“ ×™××™×Ÿ: ×œ×•×— -->
      <main class="board-wrapper">
        <div id="board" class="board"></div>
      </main>
    </div>
  </div>
</div>

<!-- ××¡×š ×¡×™×•× -->
<div id="endScreen" class="screen end-screen">
  <div class="end-card">
    <h2 class="end-title">ğŸ‰ ×›×œ ×”×ª×›× ×™×•×ª ××•×©×¨×•!</h2>
    <img src="images/end.jpeg" alt="×¡×™×•× ××©×—×§" class="end-image">
    <p class="modal-text">
      ×›×œ ×”×©×—×§× ×™× ×”×’×™×¢×• ×œ××©×‘×¦×ª 50. ×”× ×” ×˜×‘×œ×ª ×”××™×§×•××™× ×”×¡×•×¤×™×ª:
    </p>
    <ol id="rankingList" class="ranking-list"></ol>
    <p class="small-note">××¤×©×¨ ×œ×¨×¢× ×Ÿ ××ª ×”×“×¤×“×¤×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ ××©×—×§ ×—×“×©.</p>
  </div>
</div>

<!-- ××•×“×œ ××™×“×¢ / ××™×“×¢ + ×—×™×“×•×Ÿ -->
<div id="infoModal" class="modal">
  <div class="modal-content stage-layout stage-themed">
    <button class="modal-close" type="button" onclick="closeModal('infoModal')">âœ•</button>

<div class="stage-panel" aria-label="×¦×™×¨ ×ª×”×œ×™×š (5 ×©×œ×‘×™×)">
  <div class="stage-metro">
    <div class="metro-line"></div>
    <div class="metro-stations">
      <div class="metro-station" data-stage="1"><div class="dot"></div><div class="label">×™×•×–××”</div></div>
      <div class="metro-station" data-stage="2"><div class="dot"></div><div class="label">×”×’×©×”/×‘×“×™×§×”</div></div>
      <div class="metro-station" data-stage="3"><div class="dot"></div><div class="label">×”×¤×§×“×”/×¤×¨×¡×•×</div></div>
      <div class="metro-station" data-stage="4"><div class="dot"></div><div class="label">×”×ª× ×’×“×•×™×•×ª/××™×©×•×¨</div></div>
      <div class="metro-station" data-stage="5"><div class="dot"></div><div class="label">×ª×•×§×£/×™×™×©×•×</div></div>
    </div>
  </div>
</div>

    <div class="modal-main">
      <h2 id="infoTitle" class="modal-title"></h2>
    <img id="infoImage" class="info-image" src="" alt="×ª××•× ×” ×œ××©×‘×¦×ª" style="display:none;">
    <div class="modal-section-title">××” ×§×•×¨×” ×‘×©×œ×‘ ×–×”?</div>
    <div id="infoText" class="modal-text"></div>

      <div id="quizContainer" class="quiz-container" style="display:none;">
      <div class="modal-section-title">×©××œ×ª ×™×“×¢</div>
      <div id="quizQuestion" class="quiz-question"></div>
      <div id="quizAnswers" class="quiz-answers"></div>
      <div id="quizFeedback" class="quiz-feedback"></div>
    </div>
  </div>
</div>

<!-- ××•×“×œ ×”×¤×ª×¢×” -->
<div id="surpriseModal" class="modal">
  <div class="modal-content stage-layout stage-themed">
    <button class="modal-close" type="button" onclick="closeModal('surpriseModal')">âœ•</button>

<div class="stage-panel" aria-label="×¦×™×¨ ×ª×”×œ×™×š (5 ×©×œ×‘×™×)">
  <div class="stage-metro">
    <div class="metro-line"></div>
    <div class="metro-stations">
      <div class="metro-station" data-stage="1"><div class="dot"></div><div class="label">×™×•×–××”</div></div>
      <div class="metro-station" data-stage="2"><div class="dot"></div><div class="label">×”×’×©×”/×‘×“×™×§×”</div></div>
      <div class="metro-station" data-stage="3"><div class="dot"></div><div class="label">×”×¤×§×“×”/×¤×¨×¡×•×</div></div>
      <div class="metro-station" data-stage="4"><div class="dot"></div><div class="label">×”×ª× ×’×“×•×™×•×ª/××™×©×•×¨</div></div>
      <div class="metro-station" data-stage="5"><div class="dot"></div><div class="label">×ª×•×§×£/×™×™×©×•×</div></div>
    </div>
  </div>
</div>

    <div class="modal-main">
      <h2 class="modal-title">âš¡ ×§×œ×£ ×”×¤×ª×¢×”</h2>
      <div id="surpriseContent"></div>
    </div>
  </div>
</div>

<!-- ××•×“×œ ×”×—×œ×˜×” (×’×œ×’×œ) -->
<div id="decisionModal" class="modal">
  <div class="modal-content stage-layout stage-themed">
    <button class="modal-close" type="button" onclick="closeModal('decisionModal')">âœ•</button>

<div class="stage-panel" aria-label="×¦×™×¨ ×ª×”×œ×™×š (5 ×©×œ×‘×™×)">
  <div class="stage-metro">
    <div class="metro-line"></div>
    <div class="metro-stations">
      <div class="metro-station" data-stage="1"><div class="dot"></div><div class="label">×™×•×–××”</div></div>
      <div class="metro-station" data-stage="2"><div class="dot"></div><div class="label">×”×’×©×”/×‘×“×™×§×”</div></div>
      <div class="metro-station" data-stage="3"><div class="dot"></div><div class="label">×”×¤×§×“×”/×¤×¨×¡×•×</div></div>
      <div class="metro-station" data-stage="4"><div class="dot"></div><div class="label">×”×ª× ×’×“×•×™×•×ª/××™×©×•×¨</div></div>
      <div class="metro-station" data-stage="5"><div class="dot"></div><div class="label">×ª×•×§×£/×™×™×©×•×</div></div>
    </div>
  </div>
</div>

    <div class="modal-main">
      <h2 id="decisionTitle" class="modal-title"></h2>
    <div id="decisionText" class="modal-text"></div>

    <div class="authority-box">
      <div class="authority-label">×‘×¢×œ ×”×¡××›×•×ª:</div>
      <div id="authorityName" class="authority-name"></div>
    </div>

    <div class="wheel-container">
      <div class="wheel-pointer"></div>
      <div id="wheel" class="wheel">
        <div class="wheel-center">âš–ï¸</div>
      </div>
      <button id="spinBtn" class="spin-btn" type="button">×¡×•×‘×‘ ×’×œ×’×œ ×”×—×œ×˜×”</button>
    </div>

    <div id="resultBox" class="result-box">
      <div id="resultTitle" class="result-title"></div>
      <div id="resultText" class="modal-text"></div>
    </div>
  </div>
</div>

<script>
  // --------------------------------------------------
  // × ×ª×•× ×™×: ×œ×•×—, ×ª××•× ×•×ª, ×—×™×“×•× ×™×, ×”×—×œ×˜×•×ª, ×”×¤×ª×¢×•×ª
  // --------------------------------------------------
  // --------------------------------------------------
  // ×¡××•× ×“: ×× ×•×¢ ×§×˜×Ÿ (×œ×œ× ×§×‘×¦×™× ×—×™×¦×•× ×™×™×) + ×”×©×ª×§×”
  // --------------------------------------------------
  let soundEnabled = true;
  let audioCtx = null;

  function initAudio() {
    if (audioCtx) return;
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return;
    audioCtx = new Ctx();
  }

  function playTone(freq, durationMs, type = "sine", gainValue = 0.045) {
    if (!soundEnabled) return;
    initAudio();
    if (!audioCtx) return;

    // ×—×œ×§ ××”×“×¤×“×¤× ×™× ×“×•×¨×©×™× "×”×¤×¢×œ×”" ×¢"×™ ××—×•×•×” â€“ × × ×¡×” ×œ×—×“×©.
    if (audioCtx.state === "suspended") {
      audioCtx.resume().catch(() => {});
    }

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = type;
    osc.frequency.value = freq;

    const now = audioCtx.currentTime;
    const dur = durationMs / 1000;

    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.exponentialRampToValueAtTime(gainValue, now + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + dur);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(now);
    osc.stop(now + dur);
  }

  function playSound(name) {
    if (!soundEnabled) return;

    // ×“×¤×•×¡×™× ×§×¦×¨×™× ×•× ×¢×™××™× (×‘×œ×™ ××•×–×™×§×” ×¨×¦×™×¤×”)
    switch (name) {
      case "dice": {
        // "×˜×™×§×™×" ×¨× ×“×•××œ×™×™× ×§×¦×¨×™× ×©××¨×’×™×©×™× ×›××• ×§×•×‘×™×™×”
        const freqs = [520, 660, 780, 900];
        for (let i = 0; i < 6; i++) {
          setTimeout(() => playTone(freqs[Math.floor(Math.random() * freqs.length)], 45, "square", 0.03), i * 60);
        }
        break;
      }
      case "correct": {
        // ×¢×œ×™×” ×§×˜× ×”
        playTone(523, 90, "sine", 0.04);
        setTimeout(() => playTone(659, 110, "sine", 0.045), 95);
        setTimeout(() => playTone(784, 120, "sine", 0.05), 220);
        break;
      }
      case "wrong": {
        // ×™×¨×™×“×” ×§×˜× ×”
        playTone(392, 120, "sine", 0.04);
        setTimeout(() => playTone(311, 140, "sine", 0.045), 110);
        break;
      }
      case "bonus": {
        // "× ×™×¦× ×•×¥"
        playTone(880, 70, "triangle", 0.035);
        setTimeout(() => playTone(1175, 80, "triangle", 0.03), 80);
        setTimeout(() => playTone(988, 70, "triangle", 0.03), 170);
        break;
      }
      case "finish": {
        // ××§×•×¨×“ ×§×˜×Ÿ (3 ×ª×•×•×™×)
        playTone(523, 160, "sine", 0.035);
        playTone(659, 160, "sine", 0.03);
        playTone(784, 180, "sine", 0.03);
        setTimeout(() => playTone(1047, 240, "sine", 0.03), 170);
        break;
      }
    }
  }



  const boardImages = {
    1: "images/m1-01.jpeg",
    2: "images/m1-02.jpeg",
    3: "images/m1-03.jpeg",
    4: "images/m1-04.jpeg",
    5: "images/m1-05.jpeg",
    6: "images/m1-06.jpeg",
    7: "images/m1-07.jpeg",
    8: "images/m2-01.jpeg",
    9: "images/m2-02.jpeg",
    10: "images/m2-03.jpeg",
    11: "images/m2-04.jpeg",
    12: "images/m2-05.jpeg",
    13: "images/m2-06.jpeg",
    14: "images/m2-07.jpeg",
    15: "images/m2-08.jpeg",
    16: "images/m3-01.jpeg",
    17: "images/m3-02.jpeg",
    18: "images/m3-03.jpeg",
    19: "images/m3-04.jpeg",
    20: "images/m3-05.jpeg",
    21: "images/m3-06.jpeg",
    22: "images/m3-07.jpeg",
    23: "images/m3-08.jpeg",
    24: "images/m3-09.jpeg",
    25: "images/m4-01.jpeg",
    26: "images/m4-02.jpeg",
    27: "images/m4-03.jpeg",
    28: "images/m4-04.jpeg",
    29: "images/m4-05.jpeg",
    30: "images/m4-06.jpeg",
    31: "images/m4-07.jpeg",
    32: "images/m4-08.jpeg",
    33: "images/m4-09.jpeg",
    34: "images/m4-10.jpeg",
    35: "images/m4-11.jpeg",
    36: "images/m4-12.jpeg",
    37: "images/m5-01.jpeg",
    38: "images/m5-02.jpeg",
    39: "images/m5-03.jpeg",
    40: "images/m5-04.jpeg",
    41: "images/m5-05.jpeg",
    42: "images/m5-06.jpeg",
    43: "images/m5-07.jpeg",
    44: "images/m5-08.jpeg",
    45: "images/m5-09.jpeg",
    46: "images/m5-10.jpeg",
    47: "images/m5-11.jpeg",
    48: "images/m5-12.jpeg",
    49: "images/m5-13.jpeg",
    50: "images/m5-14.jpeg"
  };

  const boardData = [
    { num: 1,  stage: 1, type: "knowledge", title: "×™×•×–××” ×¨××©×•× ×™×ª", text: "×‘×©×œ×‘ ×–×” × ×•×œ×“ ×”×¨×¢×™×•×Ÿ ×œ×©×™× ×•×™ ×ª×›× ×•×Ÿ â€“ ×ª×•×¡×¤×ª ×–×›×•×™×•×ª, ×©×™× ×•×™ ×™×™×¢×•×“ ×§×¨×§×¢ ××• ×ª×›× ×•×Ÿ ××ª×—× ×—×“×©. ×”×™×•×–××” ×™×›×•×œ×” ×œ×”×’×™×¢ ××¨×©×•×ª, ××™×–× ×¤×¨×˜×™ ××• ×‘×¢×œ ××§×¨×§×¢×™×Ÿ." },
    { num: 2,  stage: 1, type: "quiz",    title: "×‘×“×™×§×ª ×ª×›× ×™×•×ª ×‘×ª×•×§×£", text: "×‘×•×“×§×™× ××™×œ×• ×ª×›× ×™×•×ª ×××•×©×¨×•×ª ×—×œ×•×ª ×¢×œ ×”××’×¨×©: ×™×™×¢×•×“×™ ×§×¨×§×¢, ×–×›×•×™×•×ª ×‘× ×™×™×”, ×’×•×‘×”, ×§×•×•×™ ×‘× ×™×™×Ÿ ×•××’×‘×œ×•×ª ×©×•× ×•×ª." },
    { num: 3,  stage: 1, type: "knowledge", title: "×™×™×¢×•×¥ ×¨××©×•× ×™", text: "×¤×’×™×©×” ×¢× ××“×¨×™×›×œ/×™×ª ××• ××ª×›× ×Ÿ/×ª ×¢×¨×™× ×œ×‘×—×™× ×ª ×”×™×ª×›× ×•×ª ×ª×›× ×•× ×™×ª ×•×”×’×“×¨×ª ×¢×§×¨×•× ×•×ª ×¨××©×•× ×™×™×." },
    { num: 4,  stage: 1, type: "surprise", title: "×”×¤×ª×¢×”!", text: "" },
    { num: 5,  stage: 1, type: "knowledge", title: "× ×™×¡×•×— ××˜×¨×•×ª", text: "×”×’×“×¨×ª ××˜×¨×•×ª ×”×ª×›× ×™×ª: ×©×™×¤×•×¨ × ×™×¦×•×œ ×”×§×¨×§×¢, ×¢×¨×‘×•×‘ ×©×™××•×©×™×, ×”×’×“×œ×ª ×”×™×¦×¢ ×“×™×•×¨, ×¤×™×ª×•×— ×ª×¢×¡×•×§×” ×•×¢×•×“." },
    { num: 6,  stage: 1, type: "quiz",    title: "×‘×“×™×§×ª ××¡××›×™ ××“×™× ×™×•×ª", text: "×‘×“×™×§×” ×©×œ ××¡××›×™ ××“×™× ×™×•×ª ×¢×™×¨×•× ×™×™× ×•×ª×›× ×™×•×ª ×¢×œ, ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ×”×›×™×•×•×Ÿ ×©×”×¢×™×¨ ×©×•××¤×ª ××œ×™×•." },
    { num: 7,  stage: 1, type: "knowledge", title: "×”×ª×§×©×¨×•×ª ×¢× ×™×•×¢×¦×™×", text: "×”×¦×•×•×ª ××’×™×™×¡ ×™×•×¢×¦×™× ××§×¦×•×¢×™×™× â€“ ×ª× ×•×¢×”, ×¡×‘×™×‘×”, × ×•×£, ×©×™××•×¨ ×•×¢×•×“ â€“ ×œ×”×›× ×ª × ×¡×¤×—×™× ××©×œ×™××™×." },

    { num: 8,  stage: 2, type: "quiz",    title: "×‘×—×™× ×ª ×—×œ×•×¤×•×ª", text: "×’×™×‘×•×© ×•×‘×—×™× ×ª ××¡×¤×¨ ×—×œ×•×¤×•×ª ×ª×›× ×•×Ÿ, ×”×©×•×•××” ×‘×™×Ÿ × ×¤×—×™×, ×—× ×™×•×ª, ×ª× ×•×¢×ª×™×•×ª ×•×¡×‘×™×‘×ª×™×•×ª." },
    { num: 9,  stage: 2, type: "knowledge", title: "×‘×—×™×¨×ª ×—×œ×•×¤×”", text: "×‘×—×™×¨×ª ×—×œ×•×¤×” ××•×¢×“×¤×ª ×”×××–× ×ª ×‘×™×Ÿ ×¦×•×¨×›×™ ×”×™×–×, ×”×¨×©×•×ª ×•×”×¦×™×‘×•×¨." },
    { num: 10, stage: 2, type: "knowledge", title: "×‘×“×™×§×” ×›×œ×›×œ×™×ª", text: "×”×›× ×ª ×‘×“×™×§×” ×›×œ×›×œ×™×ª ×•×©×××™×ª ×œ×”×¢×¨×›×ª ×›×“××™×•×ª ×”×¤×¨×•×™×§×˜ ×•×”×©×¤×¢×ª×• ×¢×œ ×©×•×•×™ ×”×§×¨×§×¢." },
    { num: 11, stage: 2, type: "quiz",    title: "×”×›× ×ª ×ª×©×¨×™×˜", text: "×”×›× ×ª ×ª×©×¨×™×˜ ×ª×›× ×™×ª ×œ×¤×™ × ×•×”×œ ××‘×\"×ª â€“ ×©×™××•×©×™×, ×’×‘×•×œ×•×ª, ×§×•×•×™ ×‘× ×™×™×Ÿ ×•×™×™×¢×•×“×™ ×§×¨×§×¢." },
    { num: 12, stage: 2, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 13, stage: 2, type: "quiz",    title: "× ×™×¡×•×— ×ª×§× ×•×Ÿ", text: "× ×™×¡×•×— ×ª×§× ×•×Ÿ ×”×ª×›× ×™×ª: ×”×•×¨××•×ª ×©×™××•×©, ×–×›×•×™×•×ª ×‘× ×™×™×”, ××’×‘×œ×•×ª ×•×”×•×¨××•×ª ×‘×™×¦×•×¢." },
    { num: 14, stage: 2, type: "knowledge", title: "××™×¡×•×£ × ×¡×¤×—×™×", text: "××™×¡×•×£ × ×¡×¤×—×™ ×ª× ×•×¢×”, × ×™×§×•×–, ×¡×‘×™×‘×”, ×©×™××•×¨, × ×•×£ ×•×¢×•×“ â€“ ×œ×¤×™ ×“×¨×™×©×•×ª ××•×¡×“ ×”×ª×›× ×•×Ÿ." },
    { num: 15, stage: 2, type: "decision",title: "×‘×“×™×§×” ××§×“××™×ª", text: "×”×•×•×¢×“×” ×”××§×•××™×ª ×‘×•×—× ×ª ×©×œ××•×ª ×—×•××¨ ×”×ª×›× ×™×ª ×•×”×ª×××ª×” ×œ××“×™× ×™×•×ª ×”×¢×™×¨×•× ×™×ª.", authority: "×•×¢×“×” ××§×•××™×ª" },

    { num: 16, stage: 3, type: "knowledge", title: "×‘×™×¦×•×¢ ×ª×™×§×•× ×™×", text: "×”×ª×›× ×™×ª ××ª×•×§× ×ª ×‘×”×ª×× ×œ×”×¢×¨×•×ª ×”×¨×©×•×ª ×”××§×•××™×ª ×•×”×™×•×¢×¦×™× ×”××§×¦×•×¢×™×™×." },
    { num: 17, stage: 3, type: "quiz",    title: "××™×—×•×“ × ×¡×¤×—×™×", text: "××™×—×•×“ ×›×œ × ×¡×¤×—×™ ×”×ª×›× ×™×ª ×œ×’×¨×¡×” ××—×ª ×¢×“×›× ×™×ª ×•××—×™×“×”." },
    { num: 18, stage: 3, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 19, stage: 3, type: "regular", title: "×—×ª×™××•×ª ×™×•×–××™×", text: "×—×ª×™××ª ×™×•×–××™× ×•×‘×¢×œ×™ ×¢× ×™×™×Ÿ ×œ×”×•×›×—×ª ×–×™×§×” ×œ××§×¨×§×¢×™×Ÿ ×•×œ××ª×Ÿ ×ª×•×§×£ ×œ×”×’×©×”." },
    { num: 20, stage: 3, type: "knowledge", title: "×”×’×©×” ×¨×©××™×ª", text: "×”×’×©×ª ×”×ª×›× ×™×ª ×œ×•×•×¢×“×” ×”××§×•××™×ª â€“ ××›××Ÿ ×× ×’× ×•× ×™ ×”×—×•×§ ××ª×—×™×œ×™× ×œ×”×™×¡×¤×¨." },
    { num: 21, stage: 3, type: "regular", title: "×¤×¨×¡×•× ×¨××©×•×Ÿ", text: "×¤×¨×¡×•× ×”×ª×›× ×™×ª ×œ×¢×™×•×Ÿ ×”×¦×™×‘×•×¨, ×”×¦×’×ª ×”××¡××›×™× ×œ×¦×™×‘×•×¨ ×”×¨×—×‘." },
    { num: 22, stage: 3, type: "decision",title: "×“×™×•×Ÿ ×¨××©×•×Ÿ ×‘×•×•×¢×“×” ×”××§×•××™×ª", text: "×”×¦×’×ª ×”×ª×›× ×™×ª, ×¢××“×ª ××”× ×“×¡ ×”×¢×™×¨ ×•×©×™×§×•×œ×™ ××“×™× ×™×•×ª.", authority: "×•×¢×“×” ××§×•××™×ª" },
    { num: 23, stage: 3, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 24, stage: 3, type: "decision",title: "×”×—×œ×˜×” ×¢×œ ×”×¤×§×“×”", text: "×”×—×œ×˜×” ×× ×œ×”×¤×§×™×“ ××ª ×”×ª×›× ×™×ª ×•×œ×”×•×¦×™××” ×œ×”×ª× ×’×“×•×™×•×ª.", authority: "×•×¢×“×” ××§×•××™×ª" },

    { num: 25, stage: 4, type: "quiz",    title: "×¤×¨×¡×•× ×”×¤×§×“×”", text: "×¤×¨×¡×•× ×”×•×“×¢×” ×‘×¨×©×•××•×ª ×•×‘×¢×™×ª×•× ×•×ª ×¢×œ ×”×¤×§×“×ª ×”×ª×›× ×™×ª â€“ ×ª×—×™×œ×ª ×ª×§×•×¤×ª ×”×”×ª× ×’×“×•×™×•×ª." },
    { num: 26, stage: 4, type: "knowledge", title: "×§×‘×œ×ª ×”×ª× ×’×“×•×™×•×ª", text: "×§×‘×œ×ª ×”×ª× ×’×“×•×™×•×ª ×‘×›×ª×‘ ×××–×¨×—×™×, ×¢××•×ª×•×ª ×•×’×•×¤×™× ××•×¡×“×™×™×." },
    { num: 27, stage: 4, type: "quiz",    title: "×¤×ª×™×—×ª ×ª×§×•×¤×ª ×”×”×ª× ×’×“×•×™×•×ª", text: "×¤×ª×™×—×ª ×ª×§×•×¤×” ×§×¦×•×‘×” ×©×‘×” ×”×¦×™×‘×•×¨ ×¨×©××™ ×œ×”×’×™×© ×”×ª× ×’×“×•×™×•×ª ×× ×•××§×•×ª." },
    { num: 28, stage: 4, type: "quiz",    title: "×”×’×©×ª ×”×ª× ×’×“×•×™×•×ª", text: "×”×ª× ×’×“×•×™×•×ª ××•×’×©×•×ª ×‘×›×ª×‘, ×× ×•××§×•×ª, ×•×œ×¢×™×ª×™× ×‘×œ×™×•×•×™ ×ª×¦×”×™×¨." },
    { num: 29, stage: 4, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 30, stage: 4, type: "decision",title: "×“×™×•×Ÿ ×‘×”×ª× ×’×“×•×™×•×ª", text: "×©××™×¢×ª ×”××ª× ×’×“×™× ×•×‘×—×™× ×ª ×—×•×•×ª ×“×¢×ª ××§×¦×•×¢×™×•×ª.", authority: "×•×¢×“×” ××§×•××™×ª" },
    { num: 31, stage: 4, type: "knowledge", title: "×”×¢×‘×¨×” ×œ××—×•×–×™×ª", text: "×”×¢×‘×¨×ª ×”×ª×›× ×™×ª ×œ×•×•×¢×“×” ×”××—×•×–×™×ª ×œ×”××©×š ×‘×—×™× ×” ×•×‘×§×¨×”." },
    { num: 32, stage: 4, type: "quiz",    title: "×‘×“×™×§×” ××—×•×–×™×ª", text: "×‘×“×™×§×” ×× ×”×ª×›× ×™×ª ××ª××™××” ×œ×ª×›× ×™×•×ª ×”××—×•×–×™×•×ª ×•×”××¨×¦×™×•×ª.", authority: "×•×¢×“×” ××—×•×–×™×ª" },
    { num: 33, stage: 4, type: "decision",title: "×“×™×•×Ÿ ×¨××©×•×Ÿ ×‘××—×•×–×™×ª", text: "×“×™×•×Ÿ ×¢×§×¨×•× ×™ ×‘×”×ª×××ª ×”×ª×›× ×™×ª ×œ××“×™× ×™×•×ª ×”××—×•×–×™×ª.", authority: "×•×¢×“×” ××—×•×–×™×ª" },
    { num: 34, stage: 4, type: "knowledge", title: "×ª×™×§×•× ×™×", text: "×ª×™×§×•× ×™× ×œ×ª×©×¨×™×˜, ×œ×ª×§× ×•×Ÿ ×•×œ× ×¡×¤×—×™× ×‘×”×ª×× ×œ×”× ×—×™×•×ª ×”××—×•×–×™×ª." },
    { num: 35, stage: 4, type: "quiz",    title: "×”×’×©×” ××—×•×“×©×ª", text: "×”×’×©×” ××—×•×“×©×ª ×œ××—×¨ ×‘×™×¦×•×¢ ×ª×™×§×•× ×™× ×©×¢×œ×• ×‘×“×™×•×Ÿ ×”×§×•×“×." },
    { num: 36, stage: 4, type: "decision",title: "×“×™×•×Ÿ ×”××©×š ×‘××—×•×–×™×ª", text: "×‘×“×™×§×” ×”×× ×”×ª×™×§×•× ×™× ×‘×•×¦×¢×• ×œ×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ ×”×•×•×¢×“×”.", authority: "×•×¢×“×” ××—×•×–×™×ª" },

    { num: 37, stage: 5, type: "regular", title: "×¤×¨×¡×•× ×œ×ª×•×§×£", text: "×”×ª×›× ×™×ª ××ª×¤×¨×¡××ª ×‘×¨×©×•××•×ª ×›×ª×›× ×™×ª ×‘×ª×•×§×£ â€“ ××–×œ ×˜×•×‘!" },
    { num: 38, stage: 5, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 39, stage: 5, type: "decision",title: "×•×¢×“×ª ×¢×¨×¨", text: "×•×¢×“×ª ×”×¢×¨×¨ ×‘×•×—× ×ª ××ª ×”×—×œ×˜×ª ××•×¡×“ ×”×ª×›× ×•×Ÿ ×•××›×¨×™×¢×”.", authority: "×•×¢×“×ª ×¢×¨×¨" },
    { num: 40, stage: 5, type: "knowledge", title: "×”×—×œ×˜×” ×¡×•×¤×™×ª ×œ××—×¨ ×¢×¨×¨", text: "× ×§×‘×¢×ª ×’×¨×¡×ª ×”×ª×›× ×™×ª ×©×ª××©×™×š ×”×œ××” ×›×ª×›× ×™×ª ××—×™×™×‘×ª." },
    { num: 41, stage: 5, type: "knowledge", title: "×”×¢×‘×¨×” ×œ×’×•×¨× ××¨×¦×™", text: "×‘××§×¨×™× ××¡×•×™××™× ×”×ª×›× ×™×ª ×¢×•×‘×¨×ª ×œ××™×©×•×¨ ×’×•×¨× ××¨×¦×™, ×œ××©×œ ×©×¨ ×”×¤× ×™×." },
    { num: 42, stage: 5, type: "decision",title: "×”×—×œ×˜×ª ×©×¨ ×”×¤× ×™×", text: "×‘×—×™× ×ª ×”×©×œ×›×•×ª ×¨×•×—×‘ ×•×©×™×§×•×œ×™ ×¢×œ.", authority: "×©×¨ ×”×¤× ×™×" },
    { num: 43, stage: 5, type: "regular", title: "×ª×™×§×•× ×™× ××—×¨×•× ×™×", text: "×ª×™×§×•× ×™× ××—×¨×•× ×™× ×œ×¤×™ ×“×¨×™×©×•×ª ×”×’×•×¨××™× ×”××•×¡××›×™×." },
    { num: 44, stage: 5, type: "knowledge", title: "×¤×¨×¡×•× ×œ××ª×Ÿ ×ª×•×§×£", text: "×¤×¨×¡×•× ×¡×•×¤×™ ×œ××ª×Ÿ ×ª×•×§×£ â€“ ×”×¢×“×›×•×Ÿ × ×›× ×¡ ×œ××¢×¨×›×•×ª." },
    { num: 45, stage: 5, type: "quiz",    title: "×¢×“×›×•×Ÿ GIS", text: "×¢×“×›×•×Ÿ ××¢×¨×›×•×ª ×”-GIS ×”×¢×™×¨×•× ×™×•×ª ×‘× ×ª×•× ×™ ×”×ª×›× ×™×ª ×”×××•×©×¨×ª." },
    { num: 46, stage: 5, type: "surprise",title: "×”×¤×ª×¢×”!", text: "" },
    { num: 47, stage: 5, type: "quiz",    title: "×‘×—×™× ×ª ×”×™×ª×¨×™×", text: "×‘×“×™×§×ª ×”×ª×××ª ×”×™×ª×¨×™ ×”×‘× ×™×™×” ×œ×ª×›× ×™×ª ×”×××•×©×¨×ª." },
    { num: 48, stage: 5, type: "knowledge", title: "××™×©×•×¨ ×¡×•×¤×™", text: "×”×ª×›× ×™×ª ××•×©×¨×” â€“ ××¤×©×¨ ×œ×”×ª×§×“× ×œ×‘×™×¦×•×¢ ×‘×©×˜×—." },
    { num: 49, stage: 5, type: "knowledge", title: "×”×¤×§×ª ×œ×§×—×™×", text: "×”×¤×§×ª ×œ×§×—×™× ××”×”×œ×™×š ×œ×¦×•×¨×š ×©×™×¤×•×¨ ×ª×”×œ×™×›×™× ×¢×ª×™×“×™×™×." },
    { num: 50, stage: 5, type: "regular", title: "ğŸ‰ ×¡×™×•×!", text: "×”×ª×›× ×™×ª × ×›× ×¡×” ×œ×ª×•×§×£ â€“ × ×™×ª×Ÿ ×œ×§×“× ×”×™×ª×¨×™× ×•×‘×™×¦×•×¢. ××–×œ ×˜×•×‘!" }
  ];

  
  // ×—×™×“×•× ×™× ×œ×¤×™ ×©×œ×‘×™× ×‘×ª×”×œ×™×š (1â€“12)
  const quizStages = {
    1: [
      {
        question: "××™ ×¨×©××™ ×œ×™×–×•× ×ª×›× ×™×ª ××ª××¨ ××§×•××™×ª ××• ××¤×•×¨×˜×ª?",
        answers: [
          "××©×¨×“ ×××©×œ×ª×™, ×•×¢×“×” ××§×•××™×ª, ×¨×©×•×ª ××§×•××™×ª, ×‘×¢×œ ×¢× ×™×™×Ÿ ×‘××§×¨×§×¢×™×Ÿ",
          "×¨×§ ×”××•×¢×¦×” ×”××¨×¦×™×ª",
          "×¨×§ ×¨×\"×™ ×•×‘×¢×œ×™ ×§×¨×§×¢ ×¤×¨×˜×™×™×",
          "×¨×§ ×”×•×•×¢×“×” ×”××—×•×–×™×ª"
        ],
        correctIndex: 0,
        explanation: "×ª×›× ×™×•×ª ××§×•××™×•×ª ×•××¤×•×¨×˜×•×ª ×™×›×•×œ×•×ª ×œ×”×™×•×ª ××§×•×“××•×ª ×¢×œ ×™×“×™ ×’×•×¤×™× ×¦×™×‘×•×¨×™×™× ×•×’× ×¢×œ ×™×“×™ ×‘×¢×œ×™ ×¢× ×™×™×Ÿ ×¤×¨×˜×™×™×."
      },
      {
        question: "××™ ×”×’×•×£ ×©××—×¨××™ ×œ×”×›×™×Ÿ ×ª×›× ×™×ª ××ª××¨ ××—×•×–×™×ª?",
        answers: [
          "×”×¨×©×•×ª ×”××§×•××™×ª",
          "×”×•×•×¢×“×” ×”××—×•×–×™×ª",
          "×¨×\"×™",
          "×•×¢×“×ª ×”×¢×¨×¨"
        ],
        correctIndex: 1,
        explanation: "×”×•×•×¢×“×” ×”××—×•×–×™×ª ×”×™× ×”×’×•×£ ×©×××•×Ÿ ×¢×œ ×”×›× ×ª ×ª×›× ×™×ª ××ª××¨ ××—×•×–×™×ª."
      },
      {
        question: "×‘××™×–×” ××¦×‘ ×‘×¢×œ ×§×¨×§×¢ ×¤×¨×˜×™ ×¨×©××™ ×œ×™×–×•× ×ª×›× ×™×ª?",
        answers: [
          "×¨×§ ×× ×”×§×¨×§×¢ ×¨×©×•××” ×‘×˜××‘×• ×¢×œ ×©××• ×‘×œ×‘×“",
          "×¨×§ ×× ×”×•×•×¢×“×” ×”××§×•××™×ª ××™×©×¨×” ××¨××©",
          "×›××©×¨ ×™×© ×œ×• ×–×™×§×” ××• ×¢× ×™×™×Ÿ ×‘××§×¨×§×¢×™×Ÿ",
          "×¨×§ ×× ×”×§×¨×§×¢ ×‘×‘×¢×œ×•×ª ××©×•×ª×¤×ª ×¢× ×¨×\"×™"
        ],
        correctIndex: 2,
        explanation: "×”×—×•×§ ×××¤×©×¨ ×’× ×œ×‘×¢×œ×™ ×¢× ×™×™×Ÿ (×œ× ×¨×§ ×‘×¢×œ×™× ×¨×©×•××™×) ×œ×™×–×•× ×ª×›× ×™×ª."
      },
      {
        question: "××™ ×”×’×•×£ ×©×××©×¨ ×‘×¡×•×¤×• ×©×œ ×“×‘×¨ ×ª×›× ×™×ª ××ª××¨ ××¨×¦×™×ª?",
        answers: [
          "×”×•×•×¢×“×” ×”××—×•×–×™×ª",
          "×¨×\"×™",
          "×”×××©×œ×”",
          "×”×•×•×¢×“×” ×”××§×•××™×ª"
        ],
        correctIndex: 2,
        explanation: "×ª×›× ×™×•×ª ×‘×¨××” ××¨×¦×™×ª ×××•×©×¨×•×ª ×¢×œ ×™×“×™ ×”×××©×œ×”, ×œ××—×¨ ×”××œ×¦×•×ª ××•×¡×“×•×ª ×”×ª×›× ×•×Ÿ."
      },
      {
        question: "××” × ×›×•×Ÿ ×œ×’×‘×™ ×™×•×–××ª ×ª×›× ×™×ª ×‘×¨××” ×”××§×•××™×ª?",
        answers: [
          "×¨×§ ×¨×©×•×ª ××§×•××™×ª ×¨×©××™×ª ×œ×™×–×•×",
          "×¨×§ ×‘×¢×œ×™ ×”×§×¨×§×¢ ×¨×©××™× ×œ×™×–×•×",
          "×™×›×•×œ×™× ×œ×™×–×•× ×’× ×’×•×¤×™× ×¦×™×‘×•×¨×™×™× ×•×’× ×‘×¢×œ×™ ×¢× ×™×™×Ÿ ×¤×¨×˜×™×™×",
          "×¨×§ ×”×•×•×¢×“×” ×”××—×•×–×™×ª ×¨×©××™×ª ×œ×™×–×•×"
        ],
        correctIndex: 2,
        explanation: "×ª×›× ×•×Ÿ ××§×•××™ ×”×•× ×¨×‘Ö¾×’×•×¨××™: ×¨×©×•×™×•×ª, ××©×¨×“×™ ×××©×œ×” ×•×‘×¢×œ×™ ×¢× ×™×™×Ÿ ×¤×¨×˜×™×™×."
      }
    ],

    2: [
      {
        question: "××” ×—×™×™×‘ ×‘×¢×œ ×¢× ×™×™×Ÿ ×‘×§×¨×§×¢ ×œ×”×¨××•×ª ×‘×¢×ª ×”×’×©×ª ×ª×›× ×™×ª?",
        answers: [
          "×ª×™×¢×•×“ ×©×œ ×”×¢×¡×§×” ×”××—×¨×•× ×” ×‘××§×¨×§×¢×™×Ÿ",
          "×–×™×§×” ××• ×–×›×•×ª ×›×œ×¤×™ ×”××§×¨×§×¢×™×Ÿ",
          "×”×ª×—×™×™×‘×•×ª ×œ×‘×¦×¢ ×‘× ×™×™×” ×ª×•×š 5 ×©× ×™×",
          "××™×©×•×¨ ×‘× ×§××™ ×œ××™××•×Ÿ"
        ],
        correctIndex: 1,
        explanation: "×–×™×§×” ×œ××§×¨×§×¢×™×Ÿ (×‘×¢×œ×•×ª, ×—×›×™×¨×”, ××•×¤×¦×™×” ×•×›×“') ×”×™× ×“×¨×™×©×ª ×™×¡×•×“ ×œ×”×’×©×ª ×ª×›× ×™×ª."
      },
      {
        question: "×œ××™ ××•×’×©×ª ×”×ª×›× ×™×ª ×‘×©×œ×‘ ×”×”×’×©×” ×”×¨×©××™?",
        answers: [
          "×œ××•×¢×¦×” ×”××¨×¦×™×ª",
          "×œ×¨×\"×™",
          "×œ××•×¡×“ ×”×ª×›× ×•×Ÿ ×”××•×¡××š (×œ××©×œ ×•×¢×“×” ××§×•××™×ª ××• ××—×•×–×™×ª)",
          "×œ××©×¨×“ ×”×¤× ×™× ×‘×œ×‘×“"
        ],
        correctIndex: 2,
        explanation: "×”×ª×›× ×™×ª ××•×’×©×ª ×œ××•×¡×“ ×”×ª×›× ×•×Ÿ ×©×™×© ×œ×• ×¡××›×•×ª ×œ××©×¨ ××•×ª×”."
      },
      {
        question: "××” *××™× ×•* ×—×œ×§ ××“×¨×™×©×•×ª ×‘×¡×™×¡×™×•×ª ×‘×”×’×©×ª ×ª×›× ×™×ª?",
        answers: [
          "×ª×©×¨×™×˜ ×ª×›× ×•× ×™ ×œ×¤×™ × ×•×”×œ ××‘×\"×ª",
          "×ª×§× ×•×Ÿ ××¤×•×¨×˜",
          "× ×¡×¤×—×™ ×ª× ×•×¢×”, ×¡×‘×™×‘×” ×•×ª×©×ª×™×•×ª ×œ×¤×™ ×”×¦×•×¨×š",
          "××™×©×•×¨ ×”×™×ª×¨ ×‘× ×™×™×” ×§×™×™×"
        ],
        correctIndex: 3,
        explanation: "×”×™×ª×¨ ×‘× ×™×™×” ×”×•× ×©×œ×‘ ×××•×—×¨ ×™×•×ª×¨, ××—×¨×™ ××™×©×•×¨ ×”×ª×›× ×™×ª, ×•×œ× ×—×œ×§ ××”×’×©×ª×”."
      },
      {
        question: "××”×• ×”×™×¢×“ ×”×¨××©×•× ×™ ×©×œ ×”×•×•×¢×“×” ×œ××—×¨ ×§×‘×œ×ª ×ª×›× ×™×ª?",
        answers: [
          "×œ×”×—×œ×™×˜ ××™×“ ×× ×œ××©×¨×” ××• ×œ×“×—×•×ª×”",
          "×œ×‘×—×•×Ÿ ×©×œ××•×ª ×”××¡××›×™× ×•×”×ª×××ª× ×œ×“×¨×™×©×•×ª ×”×—×•×§ ×•×”× ×•×”×œ",
          "×œ×”× ×¤×™×§ ×”×™×ª×¨ ×‘× ×™×™×” ×¨××©×•×Ÿ",
          "×œ×”×¢×‘×™×¨ ××ª ×”×ª×›× ×™×ª ××•×˜×•××˜×™×ª ×œ×©×¨ ×”×¤× ×™×"
        ],
        correctIndex: 1,
        explanation: "×§×•×“× ×‘×•×“×§×™× ×©×”×—×•××¨ ××œ× ×•×ª×§×™×Ÿ ×œ×¤× ×™ ×§×‘×œ×ª ×”×—×œ×˜×•×ª ××”×•×ª×™×•×ª."
      },
      {
        question: "××” ×§×•×‘×¢ ×× ×”×ª×›× ×™×ª ×ª×•×’×© ×œ×•×•×¢×“×” ××§×•××™×ª ××• ××—×•×–×™×ª?",
        answers: [
          "×¨×¦×•×Ÿ ×”×™×–×",
          "×’×•×“×œ ×”××’×¨×©",
          "×¡×•×’ ×”×ª×›× ×™×ª ×•×”×•×¨××•×ª ×”×—×•×§ ×œ×’×‘×™ ×¡××›×•×ª",
          "×’×•×‘×” ×”×‘× ×™×™×Ÿ ×”××ª×•×›× ×Ÿ"
        ],
        correctIndex: 2,
        explanation: "×”×¡××›×•×ª × ×§×‘×¢×ª ×œ×¤×™ ×¡×•×’ ×”×ª×›× ×™×ª (××§×•××™×ª/××—×•×–×™×ª/××¨×¦×™×ª), ×œ× ×œ×¤×™ ×’×—××”."
      }
    ],

    3: [
      {
        question: "××”×™ ××˜×¨×ª×” ×©×œ ×‘×“×™×§×” ×ª×›× ×•× ×™×ª ×œ××—×¨ ×”×”×’×©×”?",
        answers: [
          "×œ×§×‘×•×¢ ××ª ×’×•×‘×” ×”××’×¨×•×ª",
          "×œ×‘×—×•×Ÿ ×”×ª×××” ×œ×—×•×§, ×œ×ª×§× ×•×ª ×•×œ×ª×›× ×™×•×ª ×ª×§×¤×•×ª",
          "×œ×”× ×¤×™×§ ×”×™×ª×¨ ×‘× ×™×™×”",
          "×œ×‘×“×•×§ ××ª ×©××•×ª ×”×™×–××™×"
        ],
        correctIndex: 1,
        explanation: "×‘×“×™×§×” ×ª×›× ×•× ×™×ª ×‘×•×—× ×ª ×× ×”×ª×›× ×™×ª ×¢×•××“×ª ×‘×“×¨×™×©×•×ª ×”×—×•×§ ×•×‘×ª×›× ×™×•×ª ×”×ª×§×¤×•×ª."
      },
      {
        question: "××™ ×¢×©×•×™ ×œ×ª×ª ×—×•×•×ª ×“×¢×ª ×‘×©×œ×‘ ×”×‘×“×™×§×”?",
        answers: [
          "×¨×§ ××”× ×“×¡ ×”×¢×™×¨",
          "×¨×§ ×©×¨ ×”×¤× ×™×",
          "×™×•×¢×¦×™ ×ª×—×‘×•×¨×”, ×¡×‘×™×‘×”, ×ª×©×ª×™×•×ª, × ×•×£ ×•×¢×•×“",
          "×¨×§ ×©×××™ ××§×¨×§×¢×™×Ÿ"
        ],
        correctIndex: 2,
        explanation: "×”×‘×“×™×§×” × ×¢×–×¨×ª ×‘×™×•×¢×¦×™× ××§×¦×•×¢×™×™× ×‘×ª×—×•××™× ×©×•× ×™× ×œ×¤×™ ×¡×•×’ ×”×ª×›× ×™×ª."
      },
      {
        question: "××” ×§×•×¨×” ×× ×”×ª×›× ×™×ª ××™× ×” ×¢×•××“×ª ×‘×“×¨×™×©×•×ª ×‘×¡×™×¡×™×•×ª?",
        answers: [
          "×”×™× ××•×¤×§×“×ª ×‘×›×œ ××§×¨×”",
          "×”×™× × ×“×—×™×ª ××™×“ ×œ×œ× ××¤×©×¨×•×ª ×ª×™×§×•×Ÿ",
          "×”×™×–××™× × ×“×¨×©×™× ×œ×‘×¦×¢ ×ª×™×§×•× ×™× ×•×œ×”×’×™×© ×’×¨×¡×” ××ª×•×§× ×ª",
          "×”×™× ××•×¢×‘×¨×ª ××•×˜×•××˜×™×ª ×œ×¢×¨×›××” ×’×‘×•×”×” ×™×•×ª×¨"
        ],
        correctIndex: 2,
        explanation: "×‘×¨×•×‘ ×”××§×¨×™× × ×™×ª× ×ª ××¤×©×¨×•×ª ×œ×ª×§×Ÿ ×œ×™×§×•×™×™× ×œ×¤× ×™ ×“×—×™×™×” ××œ××”."
      },
      {
        question: "××” *××™× ×•* ×—×œ×§ ××©×œ×‘×™ ×”×§×œ×™×˜×” ×”×˜×›× ×™×ª?",
        answers: [
          "×‘×“×™×§×ª ×©×œ××•×ª ×”×ª×©×¨×™×˜ ×•×”×ª×§× ×•×Ÿ",
          "×•×™×“×•× ×§×™×•× ×›×œ ×”× ×¡×¤×—×™× ×”× ×“×¨×©×™×",
          "×“×™×•×Ÿ ×¤×•××‘×™ ×‘×”×©×ª×ª×¤×•×ª ×”×¦×™×‘×•×¨",
          "×¨×™×©×•× ×¤×¨×˜×™ ×”×™×–× ×•×”×‘×¢×œ×•×™×•×ª"
        ],
        correctIndex: 2,
        explanation: "×“×™×•×Ÿ ×¤×•××‘×™ ××ª×§×™×™× ×¨×§ ×œ××—×¨ ×”×¤×§×“×”, ×œ× ×‘×©×œ×‘ ×”×§×œ×™×˜×” ×”×˜×›× ×™×ª."
      },
      {
        question: "××” ×‘×•×“×§×™× ×‘×ª×™×§ ×”×ª×›× ×™×ª ×‘×©×œ×‘ ×”×§×œ×™×˜×”?",
        answers: [
          "×¨×§ ××ª ×’×‘×•×œ×•×ª ×”××’×¨×©",
          "×¨×§ ××ª ×§×•××ª ×”×§×¨×§×¢",
          "×©×œ××•×ª ×”××¡××›×™× ×•×”××—×™×“×•×ª ×©×œ×”×",
          "×¨×§ ××ª ×¦×‘×¢×™ ×”×”×“××™×”"
        ],
        correctIndex: 2,
        explanation: "×”×©×œ×‘ ×¢×•×¡×§ ×‘××™×›×•×ª ×•×‘×”×©×œ××ª ×”×—×•××¨, ×œ×¤× ×™ ×¢×•××§ ×ª×›× ×•× ×™."
      }
    ],

    4: [
      {
        question: "××” ××˜×¨×ª ×”×•×“×¢×” ×¢×œ *×”×›× ×ª* ×ª×›× ×™×ª?",
        answers: [
          "×œ××©×¨ ××ª ×”×ª×›× ×™×ª ×¡×•×¤×™×ª",
          "×œ×™×™×“×¢ ××ª ×”×¦×™×‘×•×¨ ×©×”×—×œ×” ×”×›× ×ª ×ª×›× ×™×ª ×—×“×©×”",
          "×œ×”×ª×—×™×œ ×‘×”×•×¦××ª ×”×™×ª×¨×™ ×‘× ×™×™×”",
          "×œ×‘×˜×œ ×ª×›× ×™×•×ª ×§×™×™××•×ª"
        ],
        correctIndex: 1,
        explanation: "×”×•×“×¢×ª ×”×›× ×” ××•×“×™×¢×” ×œ×¦×™×‘×•×¨ ×©×”×”×œ×™×š ×”×ª×›× ×•× ×™ ×™×•×¦× ×œ×“×¨×š."
      },
      {
        question: "×›×™×¦×“ ××ª×¤×¨×¡××ª ×”×•×“×¢×” ×¢×œ ×”×›× ×ª ×ª×›× ×™×ª?",
        answers: [
          "×¨×§ ×‘×¢×™×ª×•×Ÿ ××•×“×¤×¡",
          "×¨×§ ×‘××ª×¨ ×”××™× ×˜×¨× ×˜ ×©×œ ×”×•×•×¢×“×”",
          "×‘×¢×™×ª×•× ×•×ª, ×‘××ª×¨ ××™× ×˜×¨× ×˜ ×•×œ×¢×™×ª×™× ×’× ×‘×œ×•×— ××•×“×¢×•×ª ×‘×¨×©×•×ª",
          "×¨×§ ×‘××›×ª×‘ ××™×©×™ ×œ×›×œ ×ª×•×©×‘"
        ],
        correctIndex: 2,
        explanation: "×”×¨×¢×™×•×Ÿ ×”×•× ×œ×”× ×’×™×© ××ª ×”××™×“×¢ ×œ××¡×¤×¨ ×¨×‘ ×›×›×œ ×”××¤×©×¨ ×©×œ ×’×•×¨××™×."
      },
      {
        question: "××”×• ×”×”×‘×“×œ ×‘×™×Ÿ ×”×•×“×¢×” ×¢×œ ×”×›× ×ª ×ª×›× ×™×ª ×œ×‘×™×Ÿ ×”×•×“×¢×” ×¢×œ ×”×¤×§×“×”?",
        answers: [
          "××™×Ÿ ×”×‘×“×œ â€“ ×–×” ××•×ª×• ×©×œ×‘",
          "×‘×”×•×“×¢×ª ×”×›× ×” ×¢×“×™×™×Ÿ ×œ× × ×™×ª×Ÿ ×œ×”×’×™×© ×”×ª× ×’×“×•×™×•×ª",
          "×”×›× ×” ×”×™× ××™×©×•×¨ ×¡×•×¤×™ ×•×”×¤×§×“×” ×”×™× ×©×œ×‘ ××•×§×“× ×™×•×ª×¨",
          "×”×¤×§×“×” ××™× ×” ××—×™×™×‘×ª ×¤×¨×¡×•×"
        ],
        correctIndex: 1,
        explanation: "×”×ª× ×’×“×•×™×•×ª ××•×’×©×•×ª ×¨×§ ×œ××—×¨ ×”×¤×§×“×ª ×”×ª×›× ×™×ª, ×œ× ×‘×©×œ×‘ ×”×”×›× ×”."
      },
      {
        question: "××” ×›×•×œ×œ ×‘×“×¨×š ×›×œ×œ ×”×¤×¨×¡×•× ×¢×œ ×”×›× ×ª ×ª×›× ×™×ª?",
        answers: [
          "×¨×§ ×©× ×”×™×–×",
          "×ª×—×•× ×”×ª×›× ×™×ª ×•×¢×™×§×¨×™ ×”×©×™× ×•×™ ×”××•×¦×¢",
          "×œ×•×— ×–×× ×™× ×œ×‘×™×¦×•×¢ ×”×‘× ×™×™×” ×‘×¤×•×¢×œ",
          "×¨×©×™××” ×©×œ ×›×œ ×”×“×™×™×¨×™× ×‘××ª×—×"
        ],
        correctIndex: 1,
        explanation: "×”×¤×¨×¡×•× ×¦×¨×™×š ×œ×”×¡×‘×™×¨ ××” ××ª×•×›× ×Ÿ ×•××™×¤×”, ×œ× ××™ ×‘×“×™×•×§ ×’×¨ ×©×."
      },
      {
        question: "××ª×™ ×‘×“×¨×š ×›×œ×œ ××ª×¤×¨×¡××ª ×”×•×“×¢×” ×¢×œ ×”×›× ×”?",
        answers: [
          "×œ×¤× ×™ ×”×’×©×ª ×”×ª×›× ×™×ª ×œ×•×•×¢×“×”",
          "×œ××—×¨ ×§×œ×™×˜×” ×•×‘×“×™×§×” ×¨××©×•× ×™×ª ×©×œ ×”×—×•××¨",
          "×¨×§ ×œ××—×¨ ×”×”×¤×§×“×”",
          "×¨×§ ×œ××—×¨ ×§×‘×œ×ª ×ª×•×§×£"
        ],
        correctIndex: 1,
        explanation: "×”×•×“×¢×ª ×”×”×›× ×” ×”×™× ×©×œ×‘ ×‘×™× ×™×™× ×‘×™×Ÿ ×”×’×©×” ×œ×‘×™×Ÿ ×”×¤×§×“×”."
      }
    ]
  };

  // ××™×¤×•×™ ×‘×™×Ÿ ××¡×¤×¨ ××©×‘×¦×ª ×œ×‘×™×Ÿ ××¡×¤×¨ ×©×œ×‘ (1â€“12)
  const stageByCell = {
    2: 1,
    6: 2,
    8: 3,
    11: 4,
    13: 5,
    17: 6,
    25: 7,
    27: 8,
    28: 9,
    32: 10,
    35: 11,
    45: 12,
    47: 12
  };

  const defaultQuizEffect = {
    correct: { move: 2,  extraTurn: false, skipTurn: false },
    wrong:   { move: -1, extraTurn: false, skipTurn: false }
  };
  // ××©×‘×¦×•×ª ×™×“×¢ (×‘×•× ×•×¡ ×‘×œ×‘×“, ×‘×œ×™ ×§× ×¡ ×¢×œ ×˜×¢×•×ª)
  const KNOWLEDGE_BONUS_POINTS = 3;

  const stageKnowledge = {
    1: {
      extraText:
        "×”×ª×—×œ×” ×˜×•×‘×” ×‘×ª×‘\"×¢ ×”×™× ×—×¦×™ ××™×©×•×¨. ×‘×©×œ×‘ ×”×™×•×–××” ×•×”×‘×“×™×§×” ×”×¨××©×•× ×™×ª ×›×“××™ ×œ××¤×•×ª ×ª×›× ×™×•×ª ×ª×§×¤×•×ª, ××¡××›×™ ××“×™× ×™×•×ª, ××’×‘×œ×•×ª ×¡×‘×™×‘×ª×™×•×ª ×•×ª×©×ª×™×•×ª (××™×/×‘×™×•×‘/×—×©××œ/×“×¨×›×™×), ×•×œ×¡××Ÿ ×›×‘×¨ ×¢×›×©×™×• ×¡×™×›×•× ×™×: ×¡×ª×™×¨×•×ª ×¡×˜×˜×•×˜×•×¨×™×•×ª, ×©×™××•×©×™× ×œ× ×ª×•×××™×, ××• ×”×ª× ×’×“×•×™×•×ª ×¦×¤×•×™×•×ª. ×˜×™×¤: × ×¡×— ××˜×¨×•×ª ×ª×›× ×™×ª ×‘×©×¤×” '×¡×˜×˜×•×˜×•×¨×™×ª' ××“×™×“×” (×™×™×¢×•×“/×–×›×•×™×•×ª/×§×•×•×™ ×‘× ×™×™×Ÿ), ×œ× ×‘×©×¤×” ×©×™×•×•×§×™×ª.",
      bonusPool: [
        {
          question: "××” ×”×“×‘×¨ ×”×¨××©×•×Ÿ ×©×›×“××™ ×œ×‘×“×•×§ ×œ×¤× ×™ ×©××ª×—×™×œ×™× ×œ×©×¨×˜×˜ ×—×œ×•×¤×•×ª?",
          answers: [
            "××™×œ×• ×ª×›× ×™×•×ª ×××•×©×¨×•×ª ×—×œ×•×ª ×•××” ×”×Ÿ ×××¤×©×¨×•×ª/××•×¡×¨×•×ª",
            "××™×–×” ×¦×‘×¢ ×—×–×™×ª ×™×™×¨××” ×˜×•×‘",
            "×›××” ×™×¢×œ×” ×”×©×™×•×•×§",
            "×‘××™×–×” ×§×‘×œ×Ÿ ×œ×‘×—×•×¨"
          ],
          correctIndex: 0,
          explanation: "×ª×›× ×•×Ÿ ×‘×œ×™ ×‘×“×™×§×ª ××¦×‘ ×¡×˜×˜×•×˜×•×¨×™ ×”×•× ××ª×›×•×Ÿ ×œ×‘×–×‘×•×– ×–××Ÿ â€“ ×§×•×“× ××™×¤×•×™ ××¡×’×¨×ª ××—×™×™×‘×ª."
        },
        {
          question: "××” × ×™×¡×•×— ××˜×¨×” ×˜×•×‘ ×œ×ª×›× ×™×ª (×‘××•×¤×Ÿ ×›×œ×œ×™)?",
          answers: [
            "×œ×”×¤×•×š ××ª ×”×©×›×•× ×” ×œ×™×¤×” ×™×•×ª×¨",
            "×œ×”×’×“×™×œ ×–×›×•×™×•×ª ×‘× ×™×™×” ×•×œ×§×‘×•×¢ ×”×•×¨××•×ª ×‘×™× ×•×™ ×‘×¨×•×¨×•×ª ×‘××ª×—×",
            "×œ×”×¢×œ×•×ª ××ª ×¢×¨×š ×”×“×™×¨×•×ª",
            "×œ×”×•×¡×™×£ ××•×•×™×¨×” ×¦×¢×™×¨×”"
          ],
          correctIndex: 1,
          explanation: "××˜×¨×ª ×ª×›× ×™×ª ×¦×¨×™×›×” ×œ×”×™×•×ª ×ª×›× ×•× ×™×ª ×•××“×™×“×”: ×–×›×•×™×•×ª, ×™×™×¢×•×“×™×, ×”×•×¨××•×ª ×‘×™× ×•×™."
        },
        {
          question: "××™×–×” ×’×•×¨× ×™×•×–××” '×¤×¨×˜×™×ª' ×™×›×•×œ×” ×œ×”×’×™×¢ ××× ×•?",
          answers: [
            "×‘×¢×œ ×¢× ×™×™×Ÿ ×‘××§×¨×§×¢×™×Ÿ",
            "×¨×§ ×”×××©×œ×”",
            "×¨×§ ×‘×™×ª ×”××©×¤×˜",
            "×¨×§ ×•×¢×“×ª ×¢×¨×¨"
          ],
          correctIndex: 0,
          explanation: "×’× ×™×•×–××™× ×¤×¨×˜×™×™× ×™×›×•×œ×™× ×œ×§×“× ×ª×›× ×™×•×ª â€“ ×‘×›×¤×•×£ ×œ×”×œ×™×š ×•×œ×¡××›×•×™×•×ª."
        }
      ]
    },

    2: {
      extraText:
        "×‘×©×œ×‘ ×”×”×’×©×” ×•×”×§×œ×™×˜×”, ×”×©××œ×” ×”×™× ×¤×—×•×ª '×›××” ×–×” ×™×¤×”' ×•×™×•×ª×¨ '×”×× ×–×” ×§×‘×™×œ'. ×ª×™×§ ×ª×›× ×™×ª ×˜×•×‘ ×›×•×œ×œ ×ª×©×¨×™×˜ ×•×ª×§× ×•×Ÿ ×¢×§×‘×™×™×, × ×¡×¤×—×™× ×ª×•××›×™× ×œ×¤×™ ×”×¦×•×¨×š (×ª×—×‘×•×¨×”, × ×™×§×•×–, ×¡×‘×™×‘×”, ×ª×©×ª×™×•×ª), ×•×§×• ×¡×™×¤×•×¨ ××—×“ ×‘×¨×•×¨. ×˜×™×¤: ××™-×¢×§×‘×™×•×ª ×‘×™×Ÿ ×ª×©×¨×™×˜ ×œ×ª×§× ×•×Ÿ ×”×™× ××—×“ ×”×›×©×œ×™× ×”×©×›×™×—×™× ×©××—×–×™×¨×™× ×ª×›× ×™×ª ×œ×¡×‘×‘ ×ª×™×§×•× ×™×.",
      bonusPool: [
        {
          question: "××” × ×›×•×Ÿ ×œ×’×‘×™ ×ª×©×¨×™×˜ ×•×ª×§× ×•×Ÿ?",
          answers: [
            "×”× ×©× ×™ ××¡××›×™× ×¢×¦×××™×™× ×©××™×Ÿ ×‘×™× ×™×”× ×§×©×¨",
            "×”× ×—×™×™×‘×™× ×œ×”×™×•×ª ×¢×§×‘×™×™× ×•×œ×ª××•×š ×–×” ×‘×–×”",
            "×¨×§ ×”×ª×©×¨×™×˜ ××—×™×™×‘",
            "×¨×§ ×”×ª×§× ×•×Ÿ ××—×™×™×‘"
          ],
          correctIndex: 1,
          explanation: "×ª×©×¨×™×˜ ×•×ª×§× ×•×Ÿ ×”× ×–×•×’ ××—×™×™×‘ â€“ ×¡×ª×™×¨×” ×‘×™× ×™×”× ××™×™×¦×¨×ª ×‘×¢×™×” ×¡×˜×˜×•×˜×•×¨×™×ª."
        },
        {
          question: "×œ××” ×—×©×•×‘ '×ª×™×§ ×ª×›× ×™×ª' ××¡×•×“×¨ ×›×‘×¨ ×‘×”×’×©×”?",
          answers: [
            "×›×“×™ ×œ×¦××¦× ×¡×‘×‘×™ ×”×©×œ××•×ª ×•×ª×™×§×•× ×™×",
            "×›×“×™ ×œ×”×¨×©×™× ×‘×¤×•× ×˜",
            "×›×“×™ ×œ×§×¦×¨ ××ª ×©×œ×‘ ×”×‘×™×¦×•×¢ ×‘××ª×¨",
            "×›×“×™ ×œ×”×¢×œ×•×ª ××—×™×¨ ××›×™×¨×”"
          ],
          correctIndex: 0,
          explanation: "×ª×™×§ ××¡×•×“×¨ ××§×¦×¨ ×ª×”×œ×™×š: ×¤×—×•×ª ×—×¡×¨×™× = ×¤×—×•×ª ×¢×¦×™×¨×•×ª."
        },
        {
          question: "××™×–×” × ×¡×¤×— × ×¤×•×¥ ×‘××™×•×—×“ ×‘×ª×›× ×™×•×ª ×¢×™×¨×•× ×™×•×ª?",
          answers: [
            "× ×¡×¤×— ×ª× ×•×¢×”/×ª×—×‘×•×¨×”",
            "× ×¡×¤×— ××•×¤× ×”",
            "× ×¡×¤×— ××•×–×™×§×”",
            "× ×¡×¤×— ××˜×‘×—"
          ],
          correctIndex: 0,
          explanation: "×”×©×¤×¢×•×ª ×¢×œ ×ª× ×•×¢×”, ×—× ×™×” ×•× ×’×™×©×•×ª ×”×Ÿ ×›××¢×˜ ×ª××™×“ ×—×œ×§ ××”×‘×“×™×§×”."
        }
      ]
    },

    3: {
      extraText:
        "×‘×“×™×•×Ÿ ×œ×”×¤×§×“×” ×•×‘×¤×¨×¡×•×, ×”××¢×¨×›×ª ×‘×¢×¦× ××•××¨×ª: '×–×• ×”×¦×¢×” ×¨×¦×™× ×™×ª â€“ ×”×¦×™×‘×•×¨ ××•×–××Ÿ ×œ×”×’×™×‘'. ×–×” ×©×œ×‘ ×§×¨×™×˜×™ ×œ× ×™×”×•×œ ×¡×™×›×•× ×™×: ×œ×”×›×™×Ÿ ××¢× ×” ××§×¦×•×¢×™ ×œ×©××œ×•×ª ×¦×¤×•×™×•×ª, ×•×œ×•×•×“× ×©×”××¡××›×™× ×‘×¨×•×¨×™× ×œ×¦×™×‘×•×¨ ×•×œ× ×¨×§ ×œ×™×•×¢×¦×™×. ×˜×™×¤: ×©×§×™×¤×•×ª ×˜×•×‘×” (××¡××›×™× ×§×¨×™××™×, ×ª××¦×™×ª ×‘×¨×•×¨×”) ××¤×—×™×ª×” ×”×ª× ×’×“×•×™×•×ª ×©× ×•×œ×“×•×ª ××—×•×¡×¨ ×”×‘× ×”.",
      bonusPool: [
        {
          question: "××” ×”××©××¢×•×ª ×©×œ '×”×¤×§×“×”' (×‘××•×¤×Ÿ ×›×œ×œ×™)?",
          answers: [
            "××™×©×•×¨ ×¡×•×¤×™ ×©×œ ×”×ª×›× ×™×ª",
            "×¤×ª×™×—×ª ×”×ª×›× ×™×ª ×œ×¢×™×•×Ÿ ×¦×™×‘×•×¨×™ ×•×œ×”×ª× ×’×“×•×™×•×ª",
            "×”×•×¦××ª ×”×™×ª×¨ ×‘× ×™×™×”",
            "×¡×’×™×¨×ª ×”×ª×›× ×™×ª ×œ×¦×™×‘×•×¨"
          ],
          correctIndex: 1,
          explanation: "×”×¤×§×“×” ×”×™× '×©×—×¨×•×¨ ×œ×¦×™×‘×•×¨' â€“ ×¢×“×™×™×Ÿ ×œ× ×ª×•×§×£ ×¡×•×¤×™."
        },
        {
          question: "×œ××” ×¤×¨×¡×•× × ×›×•×Ÿ ×—×©×•×‘?",
          answers: [
            "×›×“×™ ×©×”×¦×™×‘×•×¨ ×™×“×¢ ×•×™×© ×œ×• ××¤×©×¨×•×ª ×œ×”×’×™×‘ ×‘×–××Ÿ",
            "×›×“×™ ×œ×”×—×œ×™×£ ××ª ×”×“×™×•×Ÿ ×‘×•×•×¢×“×”",
            "×›×“×™ ×œ×× ×•×¢ ×›×œ ×”×ª× ×’×“×•×ª",
            "×›×“×™ ×œ××¡×•×¨ ×¢×™×•×Ÿ ×‘××¡××›×™×"
          ],
          correctIndex: 0,
          explanation: "×¤×¨×¡×•× ×”×•× ×ª× ××™ ×œ×©×§×™×¤×•×ª ×•×œ×–×›×•×ª ×”×”×ª× ×’×“×•×ª."
        },
        {
          question: "××” ×˜×™×¤ ×˜×•×‘ ×œ×¤× ×™ ×¤×¨×¡×•× ×”×¤×§×“×”?",
          answers: [
            "×œ×”×¡×ª×™×¨ × ×¡×¤×—×™× ×›×“×™ ×œ×× ×•×¢ ×‘×™×§×•×¨×ª",
            "×œ×”×›×™×Ÿ ×ª××¦×™×ª ×‘×”×™×¨×” ×©×œ ×¢×™×§×¨×™ ×”×©×™× ×•×™ ×•×”×©×œ×›×•×ª×™×•",
            "×œ×”×•×¨×™×“ ××ª ×¨×–×•×œ×•×¦×™×™×ª ×”×ª×©×¨×™×˜",
            "×œ×”××ª×™×Ÿ ×œ×¡×™×•× ×ª×§×•×¤×ª ×”×”×ª× ×’×“×•×™×•×ª"
          ],
          correctIndex: 1,
          explanation: "×ª××¦×™×ª ×˜×•×‘×” ××™×™×©×¨×ª ×¦×™×¤×™×•×ª ×•××§×˜×™× ×” ×¨×¢×©."
        }
      ]
    },

    4: {
      extraText:
        "×‘×”×ª× ×’×“×•×™×•×ª ×•×©××™×¢×”, ×”×“×™×•×Ÿ × ×¢ ×‘×™×Ÿ '×–×›×•×ª ×”×˜×™×¢×•×Ÿ' ×œ×‘×™×Ÿ '×ª×›× ×•×Ÿ ×œ×˜×•×‘×ª ×”×›×œ×œ'. ×˜×™×¢×•×Ÿ ×—×–×§ × ×©×¢×Ÿ ×¢×œ ×¢×•×‘×“×•×ª (×ª×©×ª×™×•×ª, ×ª×—×‘×•×¨×”, ×¦×œ, ×¨×¢×©), ×•×¢×œ ×”×ª×××” ×œ××¡××›×™ ××“×™× ×™×•×ª ×•×ª×›× ×™×•×ª ×¢×œ. ×˜×™×¤: ×ª×’×•×‘×•×ª ××ª×•×›× × ×•×ª ××¨××© ×œ×™×•×¢×¦×™× ×•×œ××ª× ×’×“×™× ×—×•×¡×›×•×ª ×–××Ÿ ×•×××¤×©×¨×•×ª ×ª×™×§×•× ×™× ×××•×§×“×™× ×‘××§×•× ×¡×—×¨×•×¨.",
      bonusPool: [
        {
          question: "××” ×”×•×¤×š ×”×ª× ×’×“×•×ª ×œ×™×¢×™×œ×” ×™×•×ª×¨?",
          answers: [
            "×¡×™×¡×××•×ª ×›×œ×œ×™×•×ª",
            "×˜×™×¢×•×Ÿ ×¢×•×‘×“×ª×™ ×•×ª×›× ×•× ×™ ×× ×•××§",
            "×¨×§ ×”×¨×‘×” ×—×ª×™××•×ª",
            "×”×“××™×” ×™×¤×”"
          ],
          correctIndex: 1,
          explanation: "××•×¡×“ ×”×ª×›× ×•×Ÿ ×©×•×§×œ ×˜×™×¢×•× ×™× ××§×¦×•×¢×™×™×, ×œ× ×¨×§ ×¨×’×©."
        },
        {
          question: "××” ×”×•×•×¢×“×” ×™×›×•×œ×” ×œ×”×—×œ×™×˜ ××—×¨×™ ×©××™×¢×ª ×”×ª× ×’×“×•×™×•×ª?",
          answers: [
            "×¨×§ ×œ××©×¨ ×‘×œ×™ ×©×™× ×•×™",
            "×¨×§ ×œ×“×—×•×ª",
            "×œ××©×¨, ×œ××©×¨ ×‘×©×™× ×•×™×™× ××• ×œ×¡×¨×‘",
            "×¨×§ ×œ×”×¢×‘×™×¨ ×œ×‘×™×ª ××©×¤×˜"
          ],
          correctIndex: 2,
          explanation: "×œ×•×•×¢×“×” ×™×© ×’××™×©×•×ª: ×œ×¢×™×ª×™× ×”×ª× ×’×“×•×ª ××•×‘×™×œ×” ×œ×©×™× ×•×™ × ×§×•×“×ª×™ ×‘××§×•× ×“×—×™×™×”."
        },
        {
          question: "×œ××” ×œ×¤×¢××™× ××× ×™× ×—×•×§×¨?",
          answers: [
            "×›×™ ××™×Ÿ ×•×¢×“×”",
            "×›×©×™×© ××•×¨×›×‘×•×ª/×¨×™×‘×•×™ ×”×ª× ×’×“×•×™×•×ª ×•×¦×¨×™×š ×‘×™×¨×•×¨ ××¡×•×“×¨",
            "×›×“×™ ×œ×§×¦×¨ ×ª×”×œ×™×š ×ª××™×“",
            "×›×“×™ ×œ×‘×˜×œ ×”×ª× ×’×“×•×™×•×ª"
          ],
          correctIndex: 1,
          explanation: "×—×•×§×¨ ××¡×™×™×¢ ×œ× ×ª×— ×˜×¢× ×•×ª ×¨×‘×•×ª ×•×œ×”××œ×™×¥ ×‘××•×¤×Ÿ ××§×¦×•×¢×™."
        }
      ]
    },

    5: {
      extraText:
        "××™×©×•×¨, ××ª×Ÿ ×ª×•×§×£ ×•×™×™×©×•× ×”× × ×§×•×“×ª ×”××¢×‘×¨ ×'×¨×¢×™×•×Ÿ' ×œ'×›×œ×œ×™× ××—×™×™×‘×™×'. ××—×¨×™ ×ª×•×§×£, ×”×ª×›× ×™×ª ×”×•×¤×›×ª ×‘×¡×™×¡ ×œ×”×™×ª×¨×™× â€“ ××‘×œ ×¢×“×™×™×Ÿ × ×“×¨×© ×ª×›× ×•×Ÿ ××¤×•×¨×˜ ×©×¢×•××“ ×‘×”×•×¨××•×ª (× ×’×™×©×•×ª, ×‘×˜×™×—×•×ª, ×ª× ×•×¢×”, ×ª×©×ª×™×•×ª). ×˜×™×¤: ×¨×‘×™× × ×•×¤×œ×™× ×›××Ÿ ×›×™ ××’×œ×™× ×©×”×”×™×ª×›× ×•×ª ×”×”× ×“×¡×™×ª ×œ× × ×‘×“×§×” ××¡×¤×™×§ ××•×§×“× (× ×™×§×•×–, ×—× ×™×•×ª, ×§×™×¨×•×ª ×ª××š).",
      bonusPool: [
        {
          question: "××” ×××¤×©×¨ '×ª×•×§×£' ×œ×ª×›× ×™×ª ××‘×—×™× ×ª ×”××©×š ×”×“×¨×š?",
          answers: [
            "×¤×ª×™×—×ª ×”×ª× ×’×“×•×™×•×ª",
            "×‘×¡×™×¡ ×¡×˜×˜×•×˜×•×¨×™ ×œ×”×•×¦××ª ×”×™×ª×¨×™× ×‘×”×ª×× ×œ×”×•×¨××•×ª ×”×ª×›× ×™×ª",
            "×¡×’×™×¨×ª ××¤×©×¨×•×ª ×œ×‘×™×¦×•×¢",
            "×‘×™×˜×•×œ ×›×œ ××“×™× ×™×•×ª"
          ],
          correctIndex: 1,
          explanation: "×¨×§ ×ª×›× ×™×ª ×ª×§×¤×” ×™×›×•×œ×” ×œ×©××© ×‘×¡×™×¡ ××©×¤×˜×™ ×œ×”×™×ª×¨×™ ×‘× ×™×™×”."
        },
        {
          question: "××” × ×›×•×Ÿ ×œ×’×‘×™ ×”×™×ª×¨ ×‘× ×™×™×” ×œ××—×¨ ×ª×•×§×£ ×ª×›× ×™×ª?",
          answers: [
            "×”×™×ª×¨ × ×™×ª×Ÿ ××•×˜×•××˜×™×ª ×‘×œ×™ ×‘×“×™×§×•×ª",
            "×¢×“×™×™×Ÿ ×‘×•×“×§×™× ×”×ª×××” ×œ×ª×›× ×™×ª ×•×œ×“×¨×™×©×•×ª ××§×¦×•×¢×™×•×ª × ×•×¡×¤×•×ª",
            "×”×™×ª×¨ × ×™×ª×Ÿ ×¨×§ ×¢×œ ×™×“×™ ×©×¨ ×”×¤× ×™×",
            "××™×Ÿ ×¦×•×¨×š ×‘×™×•×¢×¦×™×"
          ],
          correctIndex: 1,
          explanation: "×ª×›× ×™×ª ×ª×§×¤×” ×”×™× ×ª× ××™, ××‘×œ ×œ× '×¤×˜×•×¨' ××‘×“×™×§×•×ª ×¨×™×©×•×™."
        },
        {
          question: "××™×–×” '×›×©×œ' × ×¤×•×¥ ××ª×’×œ×” ×××•×—×¨ ××“×™?",
          answers: [
            "×‘×—×™×¨×ª ×¦×‘×¢ ×œ×•×’×•",
            "×”×™×ª×›× ×•×ª ×”× ×“×¡×™×ª ×©×œ × ×™×§×•×–/×—× ×™×”/×§×™×¨×•×ª ×ª××š",
            "×‘×—×™×¨×ª ×©× ×œ×¤×¨×•×™×§×˜",
            "×¡×’× ×•×Ÿ ×”×¤×•× ×˜ ×‘×ª×§× ×•×Ÿ"
          ],
          correctIndex: 1,
          explanation: "×”× ×“×¡×” ×•×ª×©×ª×™×•×ª ×”×Ÿ ××” ×©×¢×•×¦×¨ ×”×™×ª×¨×™× â€“ ×›×“××™ ×œ×‘×“×•×§ ××•×§×“×."
        }
      ]
    }
  };


  // --------------------------------------------------
  // ×¨××–×™× (×©×œ×‘ C): ×¨××– ×›×œ×œ×™ ×©××™× ×• ×ª×œ×•×™ ×‘××¦×’×ª
  // ×©×™××•×© ×‘×¨××– ××¤×—×™×ª ×—×œ×§ ××”× ×™×§×•×“ ×”××¤×©×¨×™ ×¢×œ ×ª×©×•×‘×” × ×›×•× ×”
  // --------------------------------------------------
  const HINT_PENALTY_MULTIPLIER = 0.7; // 30%- ×¤×—×•×ª × ×§×•×“×•×ª ×›××©×¨ ××©×ª××©×™× ×‘×¨××–

  const stageHintTemplates = {
    1: "×ª×—×©×‘×•: ××™ ×‘×›×œ×œ ××•×¡××š '×œ×”× ×™×¢' ×ª×”×œ×™×š ×¡×˜×˜×•×˜×•×¨×™? ×œ×¨×•×‘ ×”×ª×©×•×‘×” ×”×™× ×’×•×£/×’×•×¨× ××•×¡××š, ×œ× ×©×œ×‘ ×˜×›× ×™.",
    2: "×ª×—×©×‘×• ×¢×œ ×“×¨×™×©×•×ª ×¡×£: ××” ×—×™×™×‘ ×œ×”×™×•×ª ×›×“×™ ×©×ª×›× ×™×ª ×‘×›×œ×œ '×ª×™×›× ×¡ ×œ××¢×¨×›×ª' ×‘×¦×•×¨×” ×ª×§×™× ×”.",
    3: "×–×” ×©×œ×‘ ×©×œ ×‘×“×™×§×”/×‘×§×¨×”. ×—×¤×©×• ×ª×©×•×‘×” ×©××“×‘×¨×ª ×¢×œ ×”×ª×××” ×œ×ª×›× ×™×•×ª ×ª×§×¤×•×ª, ×—×•×§, ×•× ×¡×¤×—×™× ××§×¦×•×¢×™×™×.",
    4: "×¤×¨×¡×•×/×©×§×™×¤×•×ª: ××” ××•×“×™×¢×™× ×•×œ××™, ×œ×¤× ×™ ×©××ª××¤×©×¨×ª ×”×ª× ×’×“×•×ª.",
    5: "×”×—×œ×˜×ª ××•×¡×“ ×”×ª×›× ×•×Ÿ: '××” ×¢×•×©×™× ×¢× ×–×” ×¢×›×©×™×•?'â€”×”×¤×§×“×”/×“×—×™×™×”/×ª× ××™×.",
    6: "×¤×¨×¡×•× ×”×¤×§×“×”: ××™×¤×” ××¤×¨×¡××™× ×•××” ×—×™×™×‘ ×œ×”×•×¤×™×¢ ×›×“×™ ×œ×¤×ª×•×— ×—×œ×•×Ÿ ×œ×”×ª× ×’×“×•×™×•×ª.",
    7: "×”×ª× ×’×“×•×™×•×ª: ××™ ×™×›×•×œ, ××™×š ××’×™×©×™×, ×•××”×• ×—×œ×•×Ÿ ×”×–××Ÿ.",
    8: "×©×™××•×¢ ×”×ª× ×’×“×•×™×•×ª: ×“×™×•×Ÿ ×¤×•××‘×™/×—×•×§×¨/×”×›×¨×¢×” ××§×¦×•×¢×™×ª.",
    9: "×”×—×œ×˜×” ××—×¨×™ ×”×ª× ×’×“×•×™×•×ª: ××™×©×•×¨/×©×™× ×•×™×™×/×¡×™×¨×•×‘â€”×•×”×× ×”×¤×§×“×” ××‘×˜×™×—×” ××™×©×•×¨ (×¨××–: ×œ×).",
    10: "××‘×˜ ××“×™× ×ª×™ ×¨×—×‘: ××ª×™ ×©×¨ ×”×¤× ×™× × ×›× ×¡ ×œ×ª××•× ×” ×•××” ×”×•× *×œ×* ×¢×•×©×”.",
    11: "×ª×•×§×£: ×‘×œ×™ ×¤×¨×¡×•× ×¨×©××™ ××™×Ÿ ×ª×•×§×£ ××©×¤×˜×™. ×—×¤×©×• × ×™×¡×•×— ×©××“×‘×¨ ×¢×œ '×›× ×™×¡×” ×œ×ª×•×§×£'.",
    12: "×”×™×ª×¨: ×ª×›× ×™×ª ×‘×ª×•×§×£ ×”×™× ×ª× ××™ ×‘×¡×™×¡, ××‘×œ ×¢×“×™×™×Ÿ ×‘×•×“×§×™× ×”×™×‘×˜×™× ××§×¦×•×¢×™×™× × ×•×¡×¤×™×."
  };

  function getHintTextForQuestion(q, stage) {
    // ×× ×‘×¢×ª×™×“ ×ª×¨×¦×” ×œ×”×•×¡×™×£ ×¨××– ×¡×¤×¦×™×¤×™ ×œ×©××œ×”: q.hint = "..."
    if (q && typeof q.hint === "string" && q.hint.trim()) return q.hint.trim();
    return stageHintTemplates[stage] || "×ª×—×©×‘×• ×¢×œ ×”×¢×™×§×¨×•×Ÿ: ×¡××›×•×ª, ×¤×¨×¡×•×, ×—×œ×•×Ÿ ×–××Ÿ, ××• ×”×—×œ×˜×ª ××•×¡×“ ×ª×›× ×•×Ÿâ€”××” ×”×›×™ ××ª××™× ×œ× ×™×¡×•×—?";
  }



const decisionData = {
    15: {
      title: "×‘×“×™×§×” ××§×“××™×ª",
      text: "×”×•×•×¢×“×” ×”××§×•××™×ª ×‘×•×—× ×ª ××ª ×©×œ××•×ª ×—×•××¨ ×”×ª×›× ×™×ª, ×”×ª×××ª×” ×œ××“×™× ×™×•×ª ×”×¢×™×¨×•× ×™×ª ×•×”×× ×™×© ×”×¦×“×§×” ×œ×”××©×™×š ×‘×§×™×“×•××”.",
      authority: "×•×¢×“×” ××§×•××™×ª",
      outcomes: [
        { result: "×“×—×™×™×”", move: -5 },
        { result: "×ª×™×§×•× ×™× × ×¨×—×‘×™×", move: -2 },
        { result: "×”×¢×‘×¨×” ×œ×“×™×•×Ÿ ×”×¤×§×“×”", move: 2 }
      ]
    },
    22: {
      title: "×“×™×•×Ÿ ×¨××©×•×Ÿ ×‘×•×•×¢×“×” ×”××§×•××™×ª",
      text: "×”×¦×’×ª ×”×ª×›× ×™×ª, ×¢××“×ª ××”× ×“×¡ ×”×¢×™×¨ ×•×©×™×§×•×œ×™ ××“×™× ×™×•×ª.",
      authority: "×•×¢×“×” ××§×•××™×ª",
      outcomes: [
        { result: "×“×—×™×™×”", move: -4 },
        { result: "×”×¤×§×“×” ×‘×ª× ××™×", move: 1 },
        { result: "×”×¤×§×“×” ××œ××”", move: 3 }
      ]
    },
    24: {
      title: "×”×—×œ×˜×” ×¢×œ ×”×¤×§×“×”",
      text: "×”×›×¨×¢×” ×× ×œ×¤×¨×¡× ××ª ×”×ª×›× ×™×ª ×œ×¢×™×•×Ÿ ×”×¦×™×‘×•×¨.",
      authority: "×•×¢×“×” ××§×•××™×ª",
      outcomes: [
        { result: "×“×—×™×™×”", move: -3 },
        { result: "×”×¤×§×“×” ×‘×ª× ××™×", move: 1 },
        { result: "×”×¤×§×“×” ××œ××”", move: 2 }
      ]
    },
    30: {
      title: "×“×™×•×Ÿ ×‘×”×ª× ×’×“×•×™×•×ª",
      text: "×©××™×¢×ª ×˜×¢× ×•×ª ×”×¦×™×‘×•×¨ ×•×‘×—×™× ×ª ×—×•×•×ª ×“×¢×ª ××§×¦×•×¢×™×•×ª.",
      authority: "×•×¢×“×” ××§×•××™×ª",
      outcomes: [
        { result: "×§×‘×œ×ª ×”×ª× ×’×“×•×ª", move: -3 },
        { result: "×©×™× ×•×™ ×”×ª×›× ×™×ª", move: -1 },
        { result: "×“×—×™×™×ª ×”×”×ª× ×’×“×•×™×•×ª", move: 2 }
      ]
    },
    33: {
      title: "×“×™×•×Ÿ ×¨××©×•×Ÿ ×‘××—×•×–×™×ª",
      text: "×‘×—×™× ×ª ×”×ª×××ª ×”×ª×›× ×™×ª ×œ××“×™× ×™×•×ª ×”××—×•×–×™×ª ×•×œ×ª×›× ×™×•×ª ×¢×œ.",
      authority: "×•×¢×“×” ××—×•×–×™×ª",
      outcomes: [
        { result: "×“×—×™×™×”", move: -5 },
        { result: "×ª×™×§×•× ×™×", move: -2 },
        { result: "××™×©×•×¨ ×¢×§×¨×•× ×™", move: 3 }
      ]
    },
    36: {
      title: "×“×™×•×Ÿ ×”××©×š ×‘××—×•×–×™×ª",
      text: "×‘×“×™×§×ª ×‘×™×¦×•×¢ ×”×ª×™×§×•× ×™× ×©× ×“×¨×©×• ×‘×“×™×•×Ÿ ×”×§×•×“×.",
      authority: "×•×¢×“×” ××—×•×–×™×ª",
      outcomes: [
        { result: "×“×—×™×™×”", move: -4 },
        { result: "×ª×™×§×•× ×™× × ×•×¡×¤×™×", move: -1 },
        { result: "××™×©×•×¨ ×‘×ª× ××™×", move: 2 }
      ]
    },
    39: {
      title: "×•×¢×“×ª ×¢×¨×¨",
      text: "×•×¢×“×ª ×”×¢×¨×¨ ×‘×•×—× ×ª ××ª ×”×—×œ×˜×ª ××•×¡×“ ×”×ª×›× ×•×Ÿ ×•××›×¨×™×¢×”.",
      authority: "×•×¢×“×ª ×¢×¨×¨",
      outcomes: [
        { result: "×“×—×™×™×ª ×”×¢×¨×¨", move: -3 },
        { result: "×§×‘×œ×” ×—×œ×§×™×ª", move: 1 },
        { result: "×§×‘×œ×ª ×”×¢×¨×¨", move: 3 }
      ]
    },
    42: {
      title: "×”×—×œ×˜×ª ×©×¨ ×”×¤× ×™×",
      text: "×‘×—×™× ×ª ×”×©×œ×›×•×ª ×¨×•×—×‘ ×•×©×™×§×•×œ×™ ×¢×œ.",
      authority: "×©×¨ ×”×¤× ×™×",
      outcomes: [
        { result: "×“×—×™×™×”", move: -4 },
        { result: "×”×—×–×¨×” ×œ×“×™×•×Ÿ × ×•×¡×£", move: -2 },
        { result: "××™×©×•×¨", move: 3 }
      ]
    }
  };

  const surpriseCards = {
    1: [
      { title: "×”×™×•×¢×¥ ×–××™×Ÿ ×”×©×‘×•×¢", text: "×”×™×•×¢×¥ ×©×œ×š ×–××™×Ÿ ×•××¤× ×” ×–××Ÿ ×œ×ª×›× ×™×ª.", move: 2, extraTurn: false, skipTurn: false },
      { title: "××“×™× ×™×•×ª ×—×“×©×” ××™×˜×™×‘×”", text: "××“×™× ×™×•×ª ×—×“×©×” ××©×¤×¨×ª ××ª ×ª× ××™ ×”×ª×›× ×•×Ÿ.", move: 3, extraTurn: false, skipTurn: false },
      { title: "×©×›×Ÿ ×ª×•××š", text: "×©×›×Ÿ ×ª×•××š ×©×•×œ×— ××›×ª×‘ ×—×™×•×‘×™.", move: 1, extraTurn: false, skipTurn: false },
      { title: "×¢×™×›×•×‘ ×‘×™×•×–××”", text: "××—×“ ×”×©×•×ª×¤×™× ××ª×¢×›×‘ ×‘×—×ª×™××”.", move: 0, extraTurn: false, skipTurn: true }
    ],
    2: [
      { title: "× ×¡×¤×— ×ª× ×•×¢×” ×××•×©×¨", text: "× ×¡×¤×— ×”×ª× ×•×¢×” ××•×©×¨ ×œ×œ× ×”×¢×¨×•×ª.", move: 3, extraTurn: false, skipTurn: false },
      { title: "×ª×§×œ×” ×‘×§×•×‘×¥", text: "×§×•×‘×¥ DWG ×”×ª×§×œ×§×œ â€“ ×¦×¨×™×š ×œ×ª×§×Ÿ.", move: -1, extraTurn: false, skipTurn: false },
      { title: "×¨×¤×¨× ×˜ ×—×“×©", text: "×¨×¤×¨× ×˜ ×—×“×© × ×›× ×¡ ×œ×ª××•× ×” ×•××§×“× ×¢× ×™×™× ×™×.", move: 2, extraTurn: false, skipTurn: false },
      { title: "×“×¨×™×©×” ×œ×”×“××™×” × ×•×¡×¤×ª", text: "×”×¢×™×¨×™×™×” ×“×•×¨×©×ª ×”×“××™×” × ×•×¡×¤×ª.", move: 0, extraTurn: false, skipTurn: true }
    ],
    3: [
      { title: "×©×›× ×™× ×ª×•××›×™×", text: "×”×©×›× ×™× ×©×•×œ×—×™× ××›×ª×‘ ×ª××™×›×”.", move: 3, extraTurn: false, skipTurn: false },
      { title: "×”×ª× ×’×“×•×™×•×ª ×¨×‘×•×ª", text: "×”×¨×‘×” ×”×ª× ×’×“×•×™×•×ª ×“×•××•×ª ××•×’×©×•×ª.", move: -2, extraTurn: false, skipTurn: false },
      { title: "××›×ª×‘ ×ª××™×›×” ××”×× ×”×œ×ª", text: "×× ×”×œ/×ª ×”××™× ×”×œ×ª ×”×¢×™×¨×•× ×™×ª ×ª×•××›/×ª ×‘×ª×›× ×™×ª.", move: 2, extraTurn: false, skipTurn: false },
      { title: "×“×™×•×Ÿ ×¡×•×¢×¨", text: "×”×“×™×•×Ÿ ×‘×•×•×¢×“×” ×”××§×•××™×ª ×¡×•×¢×¨ ×•××ª××¨×š.", move: 0, extraTurn: false, skipTurn: true }
    ],
    4: [
      { title: "××—×•×–×™×ª ××ª×œ×”×‘×ª", text: "×”×•×•×¢×“×” ×”××—×•×–×™×ª ××ª×¨×©××ª ×œ×—×™×•×‘ ××”×ª×›× ×™×ª.", move: 4, extraTurn: false, skipTurn: false },
      { title: "×¡×§×¨ × ×•×¡×£", text: "× ×“×¨×© ×¡×§×¨ × ×•×¡×£ (×ª× ×•×¢×”/×¡×‘×™×‘×”).", move: 0, extraTurn: false, skipTurn: true },
      { title: "×—×•×§×¨ ×¢×¨×¨", text: "×—×•×§×¨ ×”×¢×¨×¨ ××¦×™×¢ ××¡×§× ×•×ª ×œ×˜×•×‘×ª×š.", move: 2, extraTurn: false, skipTurn: false },
      { title: "×˜×¢×•×ª ×‘× ×¡×¤×—", text: "×˜×¢×•×ª ×‘× ×¡×¤×— ××ª×’×œ×” ×‘×©×œ×‘ ×××•×—×¨.", move: -2, extraTurn: false, skipTurn: false }
    ],
    5: [
      { title: "××™×©×•×¨ ×œ×œ× ×”×¢×¨×•×ª", text: "×”×•×•×¢×“×” ×××©×¨×ª ×œ×œ× ×“×¨×™×©×•×ª × ×•×¡×¤×•×ª.", move: 2, extraTurn: false, skipTurn: false },
      { title: "×¢×“×›×•×Ÿ GIS ××•×¦×œ×—", text: "×”-GIS ××ª×¢×“×›×Ÿ ×—×œ×§, ×œ×œ× ×ª×§×œ×•×ª.", move: 3, extraTurn: false, skipTurn: false },
      { title: "×§×¨×™×¡×ª ××¢×¨×›×ª", text: "×§×¨×™×¡×ª ××¢×¨×›×ª ×¨×’×¢ ×œ×¤× ×™ ×¤×¨×¡×•× ×œ×ª×•×§×£.", move: -1, extraTurn: false, skipTurn: false },
      { title: "×‘×¨×›×•×ª ×©×›× ×™×", text: "×”×©×›× ×™× ××‘×¨×›×™× ×¢×œ ×”×ª×›× ×™×ª ×”×—×“×©×”.", move: 2, extraTurn: false, skipTurn: false }
    ]
  };

  const characterOptions = [
    { icon: "ğŸ‘·", name: "××“×¨×™×›×œ/×™×ª" },
    { icon: "ğŸ›ï¸", name: "××ª×›× ×Ÿ/×ª ×¢×¨×™×" },
    { icon: "ğŸ‘¨â€ğŸ”§", name: "××”× ×“×¡/×ª ××–×¨×—×™/×ª" },
    { icon: "ğŸ’¼", name: "×™×–×/×™×ª" },
    { icon: "ğŸ“", name: "××•×“×“/×ª" },
    { icon: "ğŸ—ºï¸", name: "×× ×œ×™×¡×˜/×™×ª GIS" },
    { icon: "ğŸŒ±", name: "×™×•×¢×¥/×ª ×¡×‘×™×‘×”" },
    { icon: "ğŸ“Š", name: "×× ×”×œ/×ª ×¤×¨×•×™×§×˜" },
    { icon: "âš–ï¸", name: "×¢×•\"×“ ×ª×›× ×•×Ÿ ×•×‘× ×™×”" },
    { icon: "ğŸ‘¥", name: "× ×¦×™×’/×ª ×¦×™×‘×•×¨" }
  ];

  // --------------------------------------------------
  // ××¦×‘ ××©×—×§
  // --------------------------------------------------
  let players = [];
  let currentPlayerIndex = 0;
  let isRolling = false;
  let playerCardCounter = 0;
  let finishOrder = [];
  let questionStartTime = null; // ×œ××“×™×“×ª ×–××Ÿ ×ª×’×•×‘×” ×‘×©××œ×•×ª

  // ×¤×¢×•×œ×” ×©××—×›×” ×œ×¡×’×™×¨×ª ××•×“×œ
  let pendingModalId = null;
  let pendingAction = null;

  // --------------------------------------------------
  // × ×™×•×•×˜ ××¡×›×™×
  // --------------------------------------------------
  function showScreen(screenId) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(screenId).classList.add("active");
  }

  function goToSetup() {
    showScreen("setupScreen");
    if (playerCardCounter === 0) {
      addPlayerCard();
    }
  }

  // --------------------------------------------------
  // ×”×’×“×¨×ª ×©×—×§× ×™×
  // --------------------------------------------------
  function addPlayerCard() {
    if (playerCardCounter >= 10) return;
    playerCardCounter++;

    const container = document.getElementById("playersSetup");
    const card = document.createElement("div");
    card.className = "player-setup-card";
    card.dataset.playerId = String(playerCardCounter);

    const charHtml = characterOptions.map((char, idx) => `
      <div class="character-option"
           data-char="${idx}"
           onclick="selectCharacter(event, ${playerCardCounter}, ${idx})">
        ${char.icon}
      </div>
    `).join("");

    card.innerHTML = `
      <h3>×©×—×§×Ÿ ${playerCardCounter}</h3>
      <div class="form-group">
        <label>×©× ×”×©×—×§×Ÿ/×™×ª:</label>
        <input type="text" class="player-name-input" placeholder="×”×›× ×™×¡×• ×©×">
      </div>
      <div class="form-group">
        <label>××™×Ÿ:</label>
</div>
      <div class="form-group">
        <label>×‘×—×¨×• ×“××•×ª:</label>
        <div class="character-grid">
          ${charHtml}
        </div>
        <div id="charName${playerCardCounter}" class="character-name">×‘×—×¨×• ×“××•×ª</div>
      </div>
      ${playerCardCounter > 1 ? `
        <button type="button" class="remove-player-btn"
                onclick="removePlayerCard(${playerCardCounter})">×”×¡×¨ ×©×—×§×Ÿ</button>
      ` : ""}
    `;

    container.appendChild(card);
    checkBeginButton();
  }

  function removePlayerCard(playerId) {
    const card = document.querySelector(`.player-setup-card[data-player-id="${playerId}"]`);
    if (card) {
      card.remove();
      checkBeginButton();
    }
  }

  function selectGender(event, playerId, gender) {
    const card = document.querySelector(`.player-setup-card[data-player-id="${playerId}"]`);
    if (!card) return;
    card.dataset.gender = gender;
    card.querySelectorAll(".gender-btn").forEach(btn => btn.classList.remove("selected"));
    event.currentTarget.classList.add("selected");
    checkBeginButton();
  }

  function selectCharacter(event, playerId, charIndex) {
    const card = document.querySelector(`.player-setup-card[data-player-id="${playerId}"]`);
    if (!card) return;
    card.dataset.character = String(charIndex);
    card.querySelectorAll(".character-option").forEach(opt => opt.classList.remove("selected"));
    event.currentTarget.classList.add("selected");
    const label = document.getElementById(`charName${playerId}`);
    if (label) label.textContent = characterOptions[charIndex].name;
    checkBeginButton();
  }

  function checkBeginButton() {
    const cards = document.querySelectorAll(".player-setup-card");
    let allValid = cards.length > 0;

    cards.forEach(card => {
      const nameInput = card.querySelector(".player-name-input");
      const name = nameInput ? nameInput.value.trim() : "";
      const charIndex = card.dataset.character;
      if (!name || charIndex === undefined) {
        allValid = false;
      }
    });

    document.getElementById("beginGameBtn").disabled = !allValid;
  }

  document.addEventListener("input", (e) => {
    if (e.target.classList.contains("player-name-input")) {
      checkBeginButton();
    }
  });

  function beginGame() {
    const cards = document.querySelectorAll(".player-setup-card");
    players = [];
    finishOrder = [];
    currentPlayerIndex = 0;

    cards.forEach(card => {
      const name = card.querySelector(".player-name-input").value.trim();
      const charIndex = parseInt(card.dataset.character, 10);
      players.push({
        name,
        character: characterOptions[charIndex],
        position: 0,
        finished: false,
        skipNextTurn: false,
        score: 0,
        wrongCount: 0,
        answeredCount: 0
      });
    });

    initBoard();
    updatePlayersList();
    updateCurrentPlayer();
    updateBoard();

    showScreen("gameScreen");
  }

  // --------------------------------------------------
  // ×œ×•×—
  // --------------------------------------------------
  function initBoard() {
    const board = document.getElementById("board");
    board.innerHTML = "";

    boardData.forEach(cell => {
      const cellDiv = document.createElement("div");
      cellDiv.classList.add("cell", `stage${cell.stage}`);
      if (cell.type === "surprise") cellDiv.classList.add("surprise");
      if (cell.type === "decision") cellDiv.classList.add("decision");
      if (cell.type === "quiz") cellDiv.classList.add("quiz");
      cellDiv.dataset.cellNum = String(cell.num);

      const imgPath = boardImages[cell.num];
      if (imgPath) {
        cellDiv.style.backgroundImage = `url('${imgPath}')`;
      }

      const label = document.createElement("div");
      label.className = "cell-label";
      label.textContent = cell.title;

      const numSpan = document.createElement("div");
      numSpan.className = "cell-number";
      numSpan.textContent = cell.num;

      const icon = document.createElement("div");
      icon.className = "cell-icon";
      if (cell.type === "surprise") icon.textContent = "âš¡";
      else if (cell.type === "decision") icon.textContent = "âš–ï¸";
      else if (cell.type === "quiz") icon.textContent = "â“";
      else icon.textContent = "";

      const piecesDiv = document.createElement("div");
      piecesDiv.className = "player-pieces";
      piecesDiv.id = `pieces${cell.num}`;

      cellDiv.appendChild(numSpan);
      cellDiv.appendChild(label);
      cellDiv.appendChild(icon);
      cellDiv.appendChild(piecesDiv);

      cellDiv.addEventListener("click", () => {
        // ×§×œ×™×§ ×œ××™×“×” ×‘×œ×‘×“ â€“ ×œ× ××–×™×– ×©×—×§× ×™×
        playSound("bonus");
        showInfoOrQuiz(cell, false);
      });

      board.appendChild(cellDiv);
    });
  }

  function updateBoard() {
    document.querySelectorAll(".player-pieces").forEach(p => p.innerHTML = "");

    players.forEach(player => {
      const cellNum = player.position + 1;
      const container = document.getElementById(`pieces${cellNum}`);
      if (!container) return;
      const piece = document.createElement("div");
      piece.className = "player-piece";
      piece.textContent = player.character.icon;
      container.appendChild(piece);
    });

    players.forEach((player, idx) => {
      const item = document.getElementById(`playerItem${idx}`);
      if (item) {
        const posDiv = item.querySelector(".player-pos");
        posDiv.textContent = player.finished ?
          "×¡×™×™× âœ”ï¸" :
          `××©×‘×¦×ª ${player.position + 1}`;
      }
    });
  }

  // --------------------------------------------------
  // ×¨×©×™××ª ×©×—×§× ×™× ×•×ª×•×¨
  // --------------------------------------------------
  function updatePlayersList() {
    const container = document.getElementById("playersListContent");
    container.innerHTML = "";

    players.forEach((player, idx) => {
      const item = document.createElement("div");
      item.className = "player-item";
      item.id = `playerItem${idx}`;

      const avatar = document.createElement("div");
      avatar.className = "player-avatar";
      avatar.textContent = player.character.icon;

      const infoBox = document.createElement("div");
      infoBox.style.flex = "1";

      const nameLine = document.createElement("div");
      nameLine.className = "player-info-line";
      nameLine.textContent = player.name;

      const roleLine = document.createElement("div");
      roleLine.className = "player-role";
      roleLine.textContent = player.character.name;

      const posLine = document.createElement("div");
      posLine.className = "player-pos";
      posLine.textContent = `××©×‘×¦×ª ${player.position + 1}`;

      const scoreLine = document.createElement("div");
      scoreLine.className = "player-score";
      scoreLine.textContent = `× ×™×§×•×“: ${player.score || 0} | ×˜×¢×•×™×•×ª: ${player.wrongCount || 0}`;

      infoBox.appendChild(nameLine);
      infoBox.appendChild(roleLine);
      infoBox.appendChild(posLine);
      infoBox.appendChild(scoreLine);

      item.appendChild(avatar);
      item.appendChild(infoBox);

      container.appendChild(item);
    });
  }

  function updateCurrentPlayer() {
    document.querySelectorAll(".player-item").forEach(i => i.classList.remove("current"));
    const currentItem = document.getElementById(`playerItem${currentPlayerIndex}`);
    if (currentItem) currentItem.classList.add("current");

    const current = players[currentPlayerIndex];
    document.getElementById("currentPlayerName").textContent = current.name;
  }

  function nextPlayer(extraTurn = false) {
    if (checkAllFinished()) {
      showEndScreen();
      return;
    }

    if (extraTurn) {
      updateCurrentPlayer();
      return;
    }

    let loops = 0;
    do {
      currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
      const p = players[currentPlayerIndex];

      if (p.finished) {
        loops++;
        continue;
      }

      if (p.skipNextTurn) {
        p.skipNextTurn = false;
        loops++;
        continue;
      }

      break;
    } while (loops <= players.length);

    updateCurrentPlayer();
  }

  function checkAllFinished() {
    return players.every(p => p.finished);
  }

  
  function showEndScreen() {
    playSound("finish");
    const list = document.getElementById("rankingList");
    list.innerHTML = "";

    // ×“×™×¨×•×’: 1) × ×™×§×•×“ (×’×‘×•×” ×™×•×ª×¨), 2) ×¤×—×•×ª ×˜×¢×•×™×•×ª, 3) ××™ ×©×¡×™×™× ××•×§×“× ×™×•×ª×¨, 4) ××™ ×©×”×ª×§×“× ×™×•×ª×¨
    const finishRank = new Map();
    finishOrder.forEach((playerIdx, i) => finishRank.set(playerIdx, i));

    const ranked = players.map((_, idx) => idx).sort((a, b) => {
      const pa = players[a];
      const pb = players[b];

      const sa = pa.score || 0;
      const sb = pb.score || 0;
      if (sb !== sa) return sb - sa;

      const wa = pa.wrongCount || 0;
      const wb = pb.wrongCount || 0;
      if (wa !== wb) return wa - wb;

      const fa = finishRank.has(a) ? finishRank.get(a) : 9999;
      const fb = finishRank.has(b) ? finishRank.get(b) : 9999;
      if (fa !== fb) return fa - fb;

      return (pb.position || 0) - (pa.position || 0);
    });

    ranked.forEach((idx, rank) => {
      const li = document.createElement("li");
      const player = players[idx];
      const score = player.score || 0;
      const wrong = player.wrongCount || 0;

      // ××¦×™×’×™× ×’× × ×§×•×“×•×ª ×•×˜×¢×•×™×•×ª
      li.textContent = `${rank + 1}. ${player.name} â€“ ${player.character.name} | × ×™×§×•×“: ${score} | ×˜×¢×•×™×•×ª: ${wrong}`;
      list.appendChild(li);
    });

    showScreen("endScreen");
  }


  // --------------------------------------------------
  // ×”×˜×œ×ª ×§×•×‘×™×™×” ×•×ª× ×•×¢×”
  // --------------------------------------------------
  const rollBtn = document.getElementById("rollBtn");
  const diceEl = document.getElementById("dice");
  const soundToggleBtn = document.getElementById("soundToggle");
  if (soundToggleBtn) {
    soundToggleBtn.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
      // × ×™×¡×™×•×Ÿ "×œ×”×“×œ×™×§" ××ª ×”××•×“×™×• ×‘×”×§×œ×§×” ×”×¨××©×•× ×”
      if (soundEnabled) {
        initAudio();
        if (audioCtx && audioCtx.state === "suspended") {
          audioCtx.resume().catch(() => {});
        }
      }
    });
  }


  rollBtn.addEventListener("click", () => {
    if (isRolling) return;

    if (checkAllFinished()) {
      showEndScreen();
      return;
    }

    const current = players[currentPlayerIndex];
    if (current.finished) {
      nextPlayer(false);
      return;
    }

    isRolling = true;
    playSound("dice");
    rollBtn.disabled = true;
    diceEl.classList.add("rolling");

    let count = 0;
    const rolling = setInterval(() => {
      diceEl.textContent = Math.floor(Math.random() * 6) + 1;
      count++;
      if (count > 10) {
        clearInterval(rolling);
        const finalRoll = Math.floor(Math.random() * 6) + 1;
        diceEl.textContent = finalRoll;
        diceEl.classList.remove("rolling");

        setTimeout(() => {
          movePlayer(finalRoll);
          isRolling = false;
          rollBtn.disabled = false;
        }, 300);
      }
    }, 80);
  });

  function movePlayer(steps) {
    const player = players[currentPlayerIndex];
    if (player.finished) {
      nextPlayer(false);
      return;
    }

    player.position = Math.min(player.position + steps, 49);
    updateBoard();

    if (player.position === 49 && !player.finished) {
      player.finished = true;
      finishOrder.push(currentPlayerIndex);
      playSound("finish");
    }

    const cell = boardData[player.position];
    handleCellAfterMove(cell);
  }

  function handleCellAfterMove(cell) {
    if (checkAllFinished()) {
      showEndScreen();
      return;
    }

    if (!cell) {
      nextPlayer(false);
      return;
    }

    if (cell.type === "surprise") {
      showSurprise(cell.stage);
    } else if (cell.type === "decision") {
      showDecision(cell.num, cell.stage);
    } else if (cell.type === "quiz") {
      showInfoOrQuiz(cell, true);
    } else {
      showInfoOnly(cell, true);
    }
  }

  // --------------------------------------------------
  // ×¢×–×¨: ×ª×™××•×¨ ×ª×–×•×–×”/×ª×•×¨
  // --------------------------------------------------
  function describeEffect(effect) {
    const parts = [];
    if (effect.move > 0) {
      parts.push(`×”×©×—×§× /×™×ª ××ª×§×“×/×ª ${effect.move} ××©×‘×¦×•×ª.`);
    } else if (effect.move < 0) {
      parts.push(`×”×©×—×§× /×™×ª ×—×•×–×¨/×ª ${Math.abs(effect.move)} ××©×‘×¦×•×ª ×œ××—×•×¨.`);
    }
    if (effect.extraTurn) {
      parts.push("×”×©×—×§× /×™×ª ××§×‘×œ/×ª ×ª×•×¨ × ×•×¡×£.");
    }
    if (effect.skipTurn) {
      parts.push("×”×©×—×§× /×™×ª ××¤×¡×™×“/×” ××ª ×”×ª×•×¨ ×”×‘×.");
    }
    if (!parts.length) {
      parts.push("××™×§×•× ×”×©×—×§×Ÿ/×™×ª ×¢×œ ×”×œ×•×— ××™× ×• ××©×ª× ×”.");
    }
    return parts.join(" ");
  }

  // --------------------------------------------------
  // ××•×“×œ ××™×“×¢ ×‘×œ×‘×“
  // --------------------------------------------------
  
  function showKnowledgeModal(cell, fromMove) {
    playSound("bonus");
    const modal = document.getElementById("infoModal");
    applyStageTheme("infoModal", cell.stage || 1);
    const titleEl = document.getElementById("infoTitle");
    const textEl = document.getElementById("infoText");
    const imgEl = document.getElementById("infoImage");
    const quizContainer = document.getElementById("quizContainer");

    // ×›×•×ª×¨×ª + ×˜×§×¡×˜ (××•×¨×—×‘)
    titleEl.textContent = `××©×‘×¦×ª ${cell.num} â€“ ${cell.title}`;
    const sk = stageKnowledge[cell.stage];
    const extra = sk ? sk.extraText : "";
    const base = cell.text || "";
    textEl.textContent = (base ? base + "\n\n" : "") + extra;

    // ×ª××•× ×ª ×”××©×‘×¦×ª (××•×ª×” ×ª××•× ×” ×›××• ×‘×œ×•×—)
    const imgPath = boardImages[cell.num];
    if (imgPath) {
      imgEl.src = imgPath;
      imgEl.style.display = "block";
    } else {
      imgEl.style.display = "none";
    }

    // ×©××œ×ª ×‘×•× ×•×¡ (×œ×œ× ×§× ×¡) â€“ ××•×¤×™×¢×” ×‘×ª×•×š ××•×ª×• ×§×•× ×˜×™×™× ×¨ ×©×œ ×”×§×•×•×™×–
    quizContainer.style.display = "block";
    const qEl = document.getElementById("quizQuestion");
    const aEl = document.getElementById("quizAnswers");
    const fEl = document.getElementById("quizFeedback");

    aEl.innerHTML = "";
    fEl.textContent = "";
    fEl.className = "quiz-feedback";

    const pool = sk && sk.bonusPool && sk.bonusPool.length ? sk.bonusPool : null;
    if (!pool) {
      qEl.textContent = "×™×“×¢ ×–×” ×›×•×—. ×××©×™×›×™× ×”×œ××”!";
      modal.classList.add("active");
      return;
    }

    const q = pool[Math.floor(Math.random() * pool.length)];
    qEl.textContent = "×©××œ×ª ×‘×•× ×•×¡ (×‘×œ×™ ×§× ×¡ ×¢×œ ×˜×¢×•×ª): " + q.question;

    // ×–××Ÿ ×ª×’×•×‘×” â€“ × ×©×ª××© ×‘×–×” ×¨×§ ×›×“×™ ×œ× ×œ×”×¢× ×™×§ ×™×•×ª×¨ ×× ×™×§×•×“ ×”×‘×•× ×•×¡ ×”××§×¡×™××œ×™
    let startTime = Date.now();
    let answered = false;

    // ×¢×¨×‘×•×‘ ×ª×©×•×‘×•×ª
    const indices = q.answers.map((_, i) => i);
    for (let i = indices.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }

    indices.forEach((answerIndex, displayIdx) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "quiz-answer-btn";
      const letters = ["×", "×‘", "×’", "×“"];
      const letter = letters[displayIdx] || "";
      btn.textContent = `${letter}. ${q.answers[answerIndex]}`;
      btn.dataset.answerIndex = String(answerIndex);

      btn.addEventListener("click", () => {
        if (answered) return;
        answered = true;

        const correct = answerIndex === q.correctIndex;

        
        playSound(correct ? "correct" : "wrong");
const buttons = aEl.querySelectorAll(".quiz-answer-btn");
        buttons.forEach((b) => {
          b.disabled = true;
          const idx = parseInt(b.dataset.answerIndex, 10);
          if (idx === q.correctIndex) b.classList.add("correct");
          if (idx === answerIndex && !correct) b.classList.add("wrong");
        });

        const rt = (Date.now() - startTime) / 1000;

        if (correct) {
          // ×‘×•× ×•×¡ ×§×‘×•×¢ â€“ ××™×Ÿ ×§× ×¡, ×•××™×Ÿ ×ª×–×•×–×”
          addScoreToCurrentPlayer(KNOWLEDGE_BONUS_POINTS);
          fEl.textContent =
            `×™×¤×”! ×§×™×‘×œ×ª ×‘×•× ×•×¡ ×™×“×¢ +${KNOWLEDGE_BONUS_POINTS} × ×§×³ (×–××Ÿ: ${rt.toFixed(1)} ×©× ×³). ` +
            (q.explanation || "");
          fEl.classList.add("correct");
        } else {
          fEl.textContent =
            `×œ× × ×•×¨× â€“ ×‘××©×‘×¦×ª ×™×“×¢ ××™×Ÿ ×§× ×¡. (×–××Ÿ: ${rt.toFixed(1)} ×©× ×³). ` +
            (q.explanation || "");
          fEl.classList.add("wrong");
        }

        // ×œ× ××©×¤×™×¢ ×¢×œ ×ª×•×¨/×ª×–×•×–×” â€“ ×¨×§ × ×™×§×•×“/××™×“×¢
        pendingModalId = null;
        pendingAction = null;
      });

      aEl.appendChild(btn);
    });

    modal.classList.add("active");
  }


  // ××•×¡×™×£ × ×™×§×•×“ ×œ×©×—×§×Ÿ ×”× ×•×›×—×™ ×•××¨×¢× ×Ÿ ××ª ×œ×•×— ×”×©×—×§× ×™×
  function addScoreToCurrentPlayer(points) {
    const player = players[currentPlayerIndex];
    if (!player) return;

    const p = Number(points) || 0;
    player.score = (player.score || 0) + p;

    // ×¨×™×¢× ×•×Ÿ UI
    updatePlayersList();
  }


function showInfoOnly(cell, fromMove) {
    // ××©×‘×¦×ª ×™×“×¢: ××¦×™×’×” ×”×¨×—×‘×” + ×©××œ×ª ×‘×•× ×•×¡ (×œ×œ× ×§× ×¡ ×¢×œ ×˜×¢×•×ª)
    if (cell.type === "knowledge") {
      showKnowledgeModal(cell, fromMove);
      return;
    }

    const modal = document.getElementById("infoModal");
    applyStageTheme("infoModal", cell.stage || 1);
    const titleEl = document.getElementById("infoTitle");
    const textEl = document.getElementById("infoText");
    const imgEl = document.getElementById("infoImage");
    const quizContainer = document.getElementById("quizContainer");

    titleEl.textContent = `××©×‘×¦×ª ${cell.num} â€“ ${cell.title}`;
    textEl.textContent = cell.text || "";
    quizContainer.style.display = "none";
    document.getElementById("quizAnswers").innerHTML = "";
    document.getElementById("quizFeedback").textContent = "";

    const imgPath = boardImages[cell.num];
    if (imgPath) {
      imgEl.src = imgPath;
      imgEl.style.display = "block";
    } else {
      imgEl.style.display = "none";
    }

    modal.classList.add("active");

    if (fromMove) {
      pendingModalId = "infoModal";
      pendingAction = () => {
        if (!checkAllFinished()) {
          nextPlayer(false);
        } else {
          showEndScreen();
        }
      };
    }
  }

  // --------------------------------------------------
  // ××•×“×œ ××™×“×¢ + ×—×™×“×•×Ÿ
  // --------------------------------------------------
  
  function showInfoOrQuiz(cell, fromMove) {
    const triggeredByMove = !!fromMove;

    // ×× ××™×Ÿ ××™×¤×•×™ ××¤×•×¨×© ×œ××©×‘×¦×ª â€“ × ×’×–×•×¨ ×©×œ×‘ ×œ×¤×™ ×”×ª×§×“××•×ª ×‘×œ×•×— (12 ×©×œ×‘×™× ×œ××•×¨×š 50 ××©×‘×¦×•×ª)
    const inferredStage = Math.min(12, Math.max(1, Math.ceil((cell.num / 50) * 12)));
    const stage = stageByCell[cell.num] || inferredStage;
    const questions = quizStages[String(stage)] || null;

    // ×”×•×’× ×•×ª: ×¢×œ ××©×‘×¦×ª ×§×•×•×™×– ×ª××™×“ ×©×•××œ×™×. ×¢×œ ××©×‘×¦×ª ×¨×’×™×œ×” â€“ ×œ×¤×¢××™× (Knowledge Quiz) ×›×“×™ ×œ×¤×–×¨ ×©××œ×•×ª ×‘×™×Ÿ ×©×—×§× ×™×.
    const KNOWLEDGE_QUIZ_CHANCE = 0.35;
    const isMandatoryQuiz = cell.type === "quiz";
    const isKnowledgeQuiz = triggeredByMove && cell.type === "regular" && Math.random() < KNOWLEDGE_QUIZ_CHANCE;

    const isQuiz = (isMandatoryQuiz || isKnowledgeQuiz) && questions && questions.length;

    if (!isQuiz) {
      showInfoOnly(cell, fromMove);
      return;
    }

    const modal = document.getElementById("infoModal");
    applyStageTheme("infoModal", cell.stage || 1);
    const titleEl = document.getElementById("infoTitle");
    const textEl = document.getElementById("infoText");
    const imgEl = document.getElementById("infoImage");
    const quizContainer = document.getElementById("quizContainer");

    

    titleEl.textContent = `××©×‘×¦×ª ${cell.num} â€“ ${cell.title}`;
    textEl.textContent = cell.text || "";

    const imgPath = boardImages[cell.num];
    if (imgPath) {
      imgEl.src = imgPath;
      imgEl.style.display = "block";
    } else {
      imgEl.style.display = "none";
    }

    quizContainer.style.display = "block";

    const qEl = document.getElementById("quizQuestion");
    const aEl = document.getElementById("quizAnswers");
    const fEl = document.getElementById("quizFeedback");

    const randomIndex = Math.floor(Math.random() * questions.length);
    const q = questions[randomIndex];

    // ×”×ª×—×œ×ª ××“×™×“×ª ×–××Ÿ ×ª×’×•×‘×” ×œ×©××œ×”
    questionStartTime = Date.now();

    // ×¨××–×™×: ×œ×›×œ ×©××œ×” ××¤×©×¨ ×œ×”×©×ª××© ×‘×¨××–, ××‘×œ ×–×” ××¤×—×™×ª × ×§×•×“×•×ª ×¢×œ ×ª×©×•×‘×” × ×›×•× ×”
    let hintUsed = false;

    // ×‘×•× ×™× UI ×œ×¨××– ×‘××•×¤×Ÿ ×“×™× ××™ (×›×“×™ ×œ× ×œ×©×‘×•×¨ HTML ×§×™×™×)
    let hintBar = document.getElementById("hintBar");
    if (!hintBar) {
      hintBar = document.createElement("div");
      hintBar.id = "hintBar";
      hintBar.style.marginTop = "10px";
      hintBar.style.display = "flex";
      hintBar.style.gap = "10px";
      hintBar.style.alignItems = "center";
      hintBar.style.justifyContent = "flex-start";

      const hintBtn = document.createElement("button");
      hintBtn.id = "hintBtn";
      hintBtn.type = "button";
      hintBtn.className = "primary-btn";
      hintBtn.style.padding = "10px 16px";
      hintBtn.style.fontSize = "1rem";
      hintBtn.textContent = "ğŸ’¡ ×¨××– (××¤×—×™×ª × ×™×§×•×“)";

      const hintText = document.createElement("div");
      hintText.id = "hintText";
      hintText.style.padding = "10px 12px";
      hintText.style.borderRadius = "12px";
      hintText.style.border = "1px solid rgba(56,189,248,0.35)";
      hintText.style.background = "rgba(2,6,23,0.45)";
      hintText.style.flex = "1";
      hintText.style.display = "none";

      hintBar.appendChild(hintBtn);
      hintBar.appendChild(hintText);

      // × ×©×ª×•×œ ××ª ×–×” ×‘×ª×•×š ×”-quizContainer, ××¢×œ ×”×ª×©×•×‘×•×ª
      quizContainer.insertBefore(hintBar, aEl);
    }

    // ××™×¤×•×¡ ××¦×‘ ×”×¨××– ×œ×›×œ ×©××œ×”
    const hintBtnEl = document.getElementById("hintBtn");
    const hintTextEl = document.getElementById("hintText");
    if (hintBtnEl && hintTextEl) {
      hintBtnEl.disabled = false;
      hintTextEl.style.display = "none";
      hintTextEl.textContent = "";

      hintBtnEl.onclick = () => {
        hintUsed = true;
        hintBtnEl.disabled = true;
        hintTextEl.textContent = getHintTextForQuestion(q, stage);
        hintTextEl.style.display = "block";
      };
    }

    qEl.textContent = q.question;
    aEl.innerHTML = "";
    fEl.textContent = "";
    fEl.className = "quiz-feedback";

    const indices = q.answers.map((_, i) => i);
    for (let i = indices.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }

    indices.forEach((answerIndex, displayIdx) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "quiz-answer-btn";
      const letters = ["×", "×‘", "×’", "×“"];
      const letter = letters[displayIdx] || "";
      btn.textContent = `${letter}. ${q.answers[answerIndex]}`;
      btn.dataset.answerIndex = String(answerIndex);
      btn.addEventListener("click", () => {
        handleQuizAnswerNew(answerIndex, triggeredByMove);
      });
      aEl.appendChild(btn);
    });

    modal.classList.add("active");

    function handleQuizAnswerNew(chosenIndex, cameFromMove) {
      const correct = chosenIndex === q.correctIndex;

      playSound(correct ? "correct" : "wrong");

      const buttons = aEl.querySelectorAll(".quiz-answer-btn");
      buttons.forEach((b) => {
        b.disabled = true;
        const idx = parseInt(b.dataset.answerIndex, 10);
        if (idx === q.correctIndex) {
          b.classList.add("correct");
        }
        if (idx === chosenIndex && !correct) {
          b.classList.add("wrong");
        }
      });


      // --- × ×™×§×•×“ (×©×œ×‘ A): ×™×“×¢ + ××™× ×™××•× ×˜×¢×•×™×•×ª ---
      // ×¨×§ ×× ×–×• ×©××œ×” ×©× ×¢× ×™×ª ×›×—×œ×§ ×××”×œ×š ××©×—×§ (×›×œ×•××¨: ×”×’×¢×” ×¢× ×§×•×‘×™×™×”)
      if (cameFromMove) {
        const current = players[currentPlayerIndex];
        current.answeredCount = (current.answeredCount || 0) + 1;

        // ×–××Ÿ ×ª×’×•×‘×” ×‘×©× ×™×•×ª (×©×¢×•×Ÿ '×©×§×˜' ×××—×•×¨×”)
        const responseTimeSec = questionStartTime ? (Date.now() - questionStartTime) / 1000 : null;

        let earnedPoints = 0;
        if (correct) {
          if (responseTimeSec !== null && responseTimeSec <= 5) {
            earnedPoints = 10;
          } else if (responseTimeSec !== null && responseTimeSec <= 10) {
            earnedPoints = 7;
          } else {
            earnedPoints = 4;
          }

          // ×× ×”×©×ª××©×• ×‘×¨××– â€“ ××¤×—×™×ª×™× × ×™×§×•×“ ×¢×œ ×ª×©×•×‘×” × ×›×•× ×”
          if (hintUsed) {
            earnedPoints = Math.max(1, Math.round(earnedPoints * HINT_PENALTY_MULTIPLIER));
          }

          current.score = (current.score || 0) + earnedPoints;
        } else {
          current.wrongCount = (current.wrongCount || 0) + 1;
        }

        // ××¦×™×’×™× ×¤×™×“×‘×§ ×¢×œ ×–××Ÿ/× ×§×•×“×•×ª (×‘×œ×™ ×˜×™×™××¨ ×¢×œ ×”××¡×š)
        if (correct && responseTimeSec !== null) {
          const timeText = ` (×–××Ÿ: ${responseTimeSec.toFixed(1)} ×©× ×³, × ×™×§×•×“: +${earnedPoints}${hintUsed ? " â€” ×¢× ×¨××–" : ""})`;
          fEl.textContent = (fEl.textContent || "") + timeText;
        }

        // ××™×¤×•×¡ ×©×¢×•×Ÿ ×œ×©××œ×” ×”×‘××”
        questionStartTime = null;

        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×¦×“
        updatePlayersList();
        updateCurrentPlayer();
      }
      const effect = correct ? defaultQuizEffect.correct : defaultQuizEffect.wrong;
      const effectDescription = describeEffect(effect);

      if (correct) {
        fEl.textContent = "× ×›×•×Ÿ! " + (q.explanation || "") + " " + effectDescription;
        fEl.classList.add("correct");
      } else {
        fEl.textContent = "×œ× ××“×•×™×§. " + (q.explanation || "") + " " + effectDescription;
        fEl.classList.add("wrong");
      }

      if (isKnowledgeQuiz) {
        fEl.textContent = (fEl.textContent || "") + " (×‘×•× ×•×¡ ×™×“×¢ â€“ ×‘×œ×™ ×ª×–×•×–×”)";
      }

      if (!cameFromMove) {
        pendingModalId = null;
        pendingAction = null;
        return;
      }
      if (isMandatoryQuiz) {
        applyQuizEffect(effect);
      }
    }
  }


function applyQuizEffect(effect) {
  const player = players[currentPlayerIndex];
  const moved = !!(effect.move && effect.move !== 0);

  if (moved) {
    player.position = Math.max(0, Math.min(player.position + effect.move, 49));
    if (player.position === 49 && !player.finished) {
      player.finished = true;
      finishOrder.push(currentPlayerIndex);
    }
    updateBoard();
  }

  if (checkAllFinished()) {
    pendingModalId = "infoModal";
    pendingAction = () => showEndScreen();
    return;
  }

  pendingModalId = "infoModal";
  pendingAction = () => {
    // ×× ×–×–× ×• ×‘×¢×§×‘×•×ª ×”×§×•×•×™×– â€“ ××ª× ×”×’×™× ×›××™×œ×• × ×—×ª× ×• ×‘××©×‘×¦×ª ×”×—×“×©×”
    if (moved) {
      const newCell = boardData[player.position];
      handleCellAfterMove(newCell);
      return;
    }

    if (effect.skipTurn) {
      player.skipNextTurn = true;
      nextPlayer(false);
    } else if (effect.extraTurn) {
      nextPlayer(true);
    } else {
      nextPlayer(false);
    }
  };
}

  // --------------------------------------------------
  // ×¡×’×™×¨×ª ××•×“×œ×™×
  // --------------------------------------------------
  function closeModal(id) {
    const modal = document.getElementById(id);
    if (modal) modal.classList.remove("active");

    if (pendingModalId === id && typeof pendingAction === "function") {
      const action = pendingAction;
      pendingModalId = null;
      pendingAction = null;
      action();
    }
  }

  // --------------------------------------------------
  // ×§×œ×¤×™ ×”×¤×ª×¢×”
  // --------------------------------------------------
  function showSurprise(stage) {
    const cards = surpriseCards[stage] || [];
    if (!cards.length) {
      nextPlayer(false);
      return;
    }

    const card = cards[Math.floor(Math.random() * cards.length)];

    // ×¡××•× ×“ ×œ×¤×™ ×¡×•×’ ×”×›×¨×˜×™×¡
    if (card.move > 0) playSound("correct");
    else if (card.move < 0) playSound("wrong");
    else playSound("bonus");
    applyStageTheme("surpriseModal", stage || 1);
    const container = document.getElementById("surpriseContent");

    const movementDescription = describeEffect(card);

    container.innerHTML = `
      <div class="surprise-card">
        <h3>${card.title}</h3>
        <p>${card.text}</p>
        <div class="surprise-action">
          ${movementDescription}
        </div>
      </div>
    `;

    document.getElementById("surpriseModal").classList.add("active");

    const player = players[currentPlayerIndex];

    if (card.move && card.move !== 0) {
      player.position = Math.max(0, Math.min(player.position + card.move, 49));
      if (player.position === 49 && !player.finished) {
        player.finished = true;
        finishOrder.push(currentPlayerIndex);
      }
      playSound("finish");
      playSound("finish");
      updateBoard();
    }

    pendingModalId = "surpriseModal";
pendingAction = () => {
  if (checkAllFinished()) {
    showEndScreen();
    return;
  }

  // ×× ×”×›×¨×˜×™×¡ ×”×–×™×– ××•×ª× ×• â€“ × ×•×—×ª×™× ×¢×œ ×”××©×‘×¦×ª ×”×—×“×©×” ×›××™×œ×• ×–×• ×ª×•×¦××” ×©×œ ×§×•×‘×™×™×”
  if (card.move && card.move !== 0) {
    const newCell = boardData[player.position];
    handleCellAfterMove(newCell);
    return;
  }

  if (card.skipTurn) {
    player.skipNextTurn = true;
    nextPlayer(false);
  } else if (card.extraTurn) {
    nextPlayer(true);
  } else {
    nextPlayer(false);
  }
};
  }

  // --------------------------------------------------
  // ××©×‘×¦×•×ª ×”×—×œ×˜×” â€“ ×’×œ×’×œ
  // --------------------------------------------------
  function showDecision(cellNum, stage) {
    const data = decisionData[cellNum];
    if (!data) {
      nextPlayer(false);
      return;
    }

    applyStageTheme("decisionModal", stage || 1);

    const titleEl = document.getElementById("decisionTitle");
    const textEl = document.getElementById("decisionText");
    const authorityEl = document.getElementById("authorityName");
    const wheelEl = document.getElementById("wheel");
    const spinBtn = document.getElementById("spinBtn");
    const resultBox = document.getElementById("resultBox");
    const resultTitle = document.getElementById("resultTitle");
    const resultText = document.getElementById("resultText");

    titleEl.textContent = data.title;
    textEl.textContent = data.text;
    authorityEl.textContent = data.authority;
    wheelEl.style.transform = "rotate(0deg)";
    resultBox.classList.remove("active");
    resultText.textContent = "";
    spinBtn.disabled = false;

    document.getElementById("decisionModal").classList.add("active");

    spinBtn.onclick = () => {
      spinBtn.disabled = true;
      const rotation = 720 + Math.floor(Math.random() * 360);
      wheelEl.style.transform = `rotate(${rotation}deg)`;

      setTimeout(() => {
        const angle = rotation % 360;
        let index;
        if (angle >= 0 && angle < 120) index = 0;
        else if (angle >= 120 && angle < 240) index = 1;
        else index = 2;

        const outcome = data.outcomes[index];
        resultTitle.textContent = outcome.result;

        if (outcome.move > 0) playSound("correct");
        else if (outcome.move < 0) playSound("wrong");
        else playSound("bonus");

        let moveText;
        if (outcome.move > 0) moveText = `×”×©×—×§× /×™×ª ××ª×§×“×/×ª ${outcome.move} ××©×‘×¦×•×ª.`;
        else if (outcome.move < 0) moveText = `×”×©×—×§× /×™×ª ×—×•×–×¨/×ª ${Math.abs(outcome.move)} ××©×‘×¦×•×ª ×œ××—×•×¨.`;
        else moveText = "××™×§×•× ×”×©×—×§×Ÿ/×™×ª ×¢×œ ×”×œ×•×— ××™× ×• ××©×ª× ×”.";

        resultText.textContent = moveText;
        resultBox.classList.add("active");

        const player = players[currentPlayerIndex];

        if (outcome.move && outcome.move !== 0) {
          player.position = Math.max(0, Math.min(player.position + outcome.move, 49));
          if (player.position === 49 && !player.finished) {
            player.finished = true;
            finishOrder.push(currentPlayerIndex);
          }
          updateBoard();
        }

        if (checkAllFinished()) {
          pendingModalId = "decisionModal";
          pendingAction = () => {
            showEndScreen();
          };
        } else {
          pendingModalId = "decisionModal";
          pendingAction = () => {
            if (outcome.move && outcome.move !== 0) {
              const newCell = boardData[player.position];
              handleCellAfterMove(newCell);
              return;
            }
            nextPlayer(false);
          };
        }
      }, 2200);
    };
  }

  // --------------------------------------------------
  // ×”×ª×—×œ×”
  // --------------------------------------------------
  // ××¡×š ×¤×ª×™×—×” ×›×‘×¨ ×¤×¢×™×œ ×‘-HTML

  // ====== ×©×œ×‘×™× (5) â€“ ×ª×¦×•×’×ª "××˜×¨×•" ×‘××•×“××œ×™× ======
  const stageMeta = {
    1: { name: "×™×•×–××”",            color: "#3b82f6" },
    2: { name: "×”×’×©×”/×‘×“×™×§×”",       color: "#8b5cf6" },
    3: { name: "×”×¤×§×“×”/×¤×¨×¡×•×",      color: "#f59e0b" },
    4: { name: "×”×ª× ×’×“×•×™×•×ª/××™×©×•×¨",   color: "#ef4444" },
    5: { name: "×ª×•×§×£/×™×™×©×•×",       color: "#22c55e" }
  };

  function applyStageTheme(modalId, stage) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    const content = modal.querySelector(".modal-content");
    if (!content) return;

    const meta = stageMeta[stage] || stageMeta[1];
    content.style.setProperty("--stage-color", meta.color);

    const stations = modal.querySelectorAll(".metro-station");
    stations.forEach((s) => {
      const sStage = parseInt(s.dataset.stage || "0", 10);
      s.classList.remove("completed", "current");
      if (!stage || !sStage) return;
      if (sStage < stage) s.classList.add("completed");
      if (sStage === stage) s.classList.add("current");
    });
  }

</script>
</body>
</html>
